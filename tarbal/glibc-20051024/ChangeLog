2005-10-23  Ulrich Drepper  <drepper@redhat.com>

	* rt/mqueue.h: Cleanups.

2005-10-22  Roland McGrath  <roland@redhat.com>

	[BZ #1254]
	* sysdeps/mach/hurd/getpeername.c (__getpeername): Fix last change.
	From Samuel Thibault <samuel.thibault@ens-lyon.org>.

2005-10-17  Thomas Schwinge  <tschwinge@gnu.org>

	[BZ #1252]
	* hurd/intr-msg.c (_hurd_intr_rpc_mach_msg): Don't use ?: as lvalue.
	* sysdeps/mach/hurd/ioctl.c (__ioctl): Likewise.

2005-10-20  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/ibm1364.h (__ucs4_to_ibm1364sb): Fix one mapping.
	* iconvdata/ibm1388.h (__ucs4_to_ibm1388sb): Likewise.
	* iconvdata/testdata/IBM1364: Add missing valid input.
	* iconvdata/testdata/IBM1388: Likewise.
	* iconvdata/testdata/IBM1364..UTF8: Adjust appropriately.
	* iconvdata/testdata/IBM1388..UTF8: Likewise.
	Patch by Masahide Washizawa <washi@jp.ibm.com>.

2005-08-23  GOTO Masanori  <gotom@debian.or.jp>

	[BZ #1498]
	* sysdeps/alpha/remqu.S: Return the correct result when the same
	dividend and divisor are provided, and they're negative numbers.
	* sysdeps/alpha/divqu.S: Likewise.

2005-10-18  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h (TESTS):
	Define.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/ucontext_i.h (TESTS):
	Likewise.

2005-10-19  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/Makefile (modules): Add IBM1364, IBM1371, IBM1388, IBM1390,
	and IBM1399.
	(distribute): Add ibm1364.c, ibm1364.h, ibm1371.c, ibm1371.h,
	ibm1388.c, ibm1388.h, ibm1390.c, ibm1390.h, ibm1399.c, and ibm1399.h.
	* iconvdata/TESTS: Add entries for IBM1364, IBM1371, IBM1388, IBM1390,
	and IBM1399.
	* iconvdata/gconv-modules: Likewise.
	* iconvdata/ibm1364.c: New file.
	* iconvdata/ibm1364.h: New file.
	* iconvdata/ibm1371.c: New file.
	* iconvdata/ibm1371.h: New file.
	* iconvdata/ibm1388.c: New file.
	* iconvdata/ibm1388.h: New file.
	* iconvdata/ibm1390.c: New file.
	* iconvdata/ibm1390.h: New file.
	* iconvdata/ibm1399.c: New file.
	* iconvdata/ibm1399.h: New file.
	* iconvdata/testdata/IBM1364: New file.
	* iconvdata/testdata/IBM1364..UTF8: New file.
	* iconvdata/testdata/IBM1371: New file.
	* iconvdata/testdata/IBM1371..UTF8: New file.
	* iconvdata/testdata/IBM1388: New file.
	* iconvdata/testdata/IBM1388..UTF8: New file
	* iconvdata/testdata/IBM1390: New file.
	* iconvdata/testdata/IBM1390..UTF8: New file.
	* iconvdata/testdata/IBM1399: New file.
	* iconvdata/testdata/IBM1399..UTF8: New file.
	Original patch by Masahide Washizawa <washi@jp.ibm.com>.

2005-10-17  Roland McGrath  <roland@redhat.com>

	* elf/dl-load.c (MAP_COPY): When undefined, define to
	MAP_PRIVATE|MAP_DENYWRITE instead of just MAP_PRIVATE.
	(_dl_map_object_from_fd): Don't use MAP_DENYWRITE explicitly.

2005-10-17  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/ucontext_i.h (SC_STSZ, TESTS):
	Define.
	* sysdeps/unix/sysv/linux/s390/s390-64/ucontext_i.h (SC_STSZ, TESTS):
	Likewise.

2005-10-17  Ulrich Drepper  <drepper@redhat.com>

	* libio/oldfileops.c (_IO_old_file_xsputn): Fix last patch.
	Return EOF not 0.

	* sysdeps/unix/sysv/linux/readonly-area.c (__readonly_area): Also
	allow EACCES errors when opening /proc for now.

	* wctype/wcfuncs.c: Don't use expensive wide char lookups in isw*
	functions if character is in ASCII range.
	* wctype/wcfuncs_l.c: Likewise.

2005-05-03  Robert Millan  <robertmh@gnu.org>

	* abi-tags (.*-.*-knetbsd.*-gnu.*): New match, with ABI value 4.
	* elf/cache.c (print_entry): Match the kNetBSD ABI tag.

2005-10-16  Alfred M. Szmidt  <ams@gnu.org>

	* sysdeps/generic/bits/mman.h
	[__USE_GNU] (MREMAP_MAYMOVE, REMAP_FIXED): New macros.

2005-10-16  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/unix/sysv/linux/sh/makecontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh3/getcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh4/getcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh3/setcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh4/setcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh3/swapcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh4/swapcontext.S: New file.
	* sysdeps/unix/sysv/linux/sh/sh3/ucontext_i.h: New file.
	* sysdeps/unix/sysv/linux/sh/sh4/ucontext_i.h: New file.
	* sysdeps/unix/sysv/linux/sh/sys/ucontext.h: Removed.
	* sysdeps/unix/sysv/linux/sh/sh3/sys/ucontext.h: New file.
	* sysdeps/unix/sysv/linux/sh/sh4/sys/ucontext.h: New file.

2005-09-13  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1228]
	* include/limits.h (LLONG_MIN, LLONG_MAX, ULLONG_MAX): Make sure these
	are defined for -D_GNU_SOURCE or -D_ISOC99_SOURCE even when not
	-std=c99.

2005-10-16  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/unix/sysv/linux/sh/bits/mman.h: Define MREMAP_FIXED.

2005-08-05  Alfred M. Szmidt  <ams@gnu.org>

	[BZ #1252]
	* sysdeps/mach/hurd/setitimer.c (restart_itimer): Move static fn
	forward decl out of function body.
	* sysdeps/mach/hurd/profil.c: Likewise.

2005-10-16  Roland McGrath  <roland@frob.com>

	[BZ #1254]
	* sysdeps/mach/hurd/getpeername.c (__getpeername): Respect *LEN
	byte limit when setting ADDR->sa_family.
	Reported by Samuel Thibault <samuel.thibault@ens-lyon.org>.

	[BZ #1253]
	* sysdeps/mach/hurd/dl-sysdep.h
	[SHARED] (DL_ARGV_NOT_RELRO): New macro.

	[BZ #1253]
	* sysdeps/mach/hurd/i386/init-first.c (init): Make cast kosher.
	(_hurd_stack_setup): Don't declare with arguments and ellipsis.
	Use __builtin_frame_address and __builtin_return_address.
	(_dl_init_first): Likewise.

	[BZ #1249]
	* sysdeps/mach/hurd/i386/init-first.c (_cthread_init_routine): Declare
	as weak extern.
	(init): Check for it being undefined.

2005-10-16  Daniel Jacobowitz  <dan@codesourcery.com>
	    Roland McGrath  <roland@redhat.com>

	* Makerules [module-names] (extra-modules-build): New variable.
	($(extra-modules-build:%=$(objpfx)%.so)): New static pattern rule.
	Depend on libc.so and libc_nonshared.a.
	* dlfcn/Makefile ($(test-modules)): Remove static pattern rule.
	* elf/Makefile (modules-names-nobuild): New variable, add filtmod1.
	($(test-modules)): Remove static pattern rule.

2005-10-15  Thomas Schwinge  <tschwinge@gnu.org>

	* include/dirent.h: Include <stdbool.h>.
	* sysdeps/mach/hurd/fdopendir.c: Include <fcntl.h>.
	(fdopendir): Correct argument to _hurd_fd_get().
	* sysdeps/mach/hurd/opendir.c (__opendir): Remove stray `}'.

2005-08-20  Paul Eggert  <eggert@cs.ucla.edu>

	[BZ #1224]
	* posix/regcomp.c (init_word_char, duplicate_node_closure,
	fetch_token, peek_token_bracket, build_range_exp,
	build_collating_symbol): Remove forward decls; no longer needed
	now that we use prototypes.

2005-10-15  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1221]
	* posix/regex_internal.h: Remove last traces of
	RE_NO_INTERNAL_PROTOTYPES.

	[BZ #968]
	* string/strxfrm_l.c (STRXFRM): Fix exit conditions of two loops.

	* sysdeps/unix/fdopendir.c (fdopendir): Make sure descriptor
	allows reading.

	* wcsmbs/tst-mbrtowc2.c: Use de_DE.UTF-8 instead of en_US.UTF-8.
	* wcsmbs/Makefile: Define tst-mbrtowc2-ENV.

	* posix/regexec.c: Finish prototyping of static functions.
	* posix/regex_internal.c: Likewise.

2005-10-14  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/opendir.c (_hurd_fd_opendir): New function, broken
	out of ...
	(__opendir): ... here.  Call it.
	* sysdeps/mach/hurd/fdopendir.c: New file.

2005-10-14  Ulrich Drepper  <drepper@redhat.com>

	[BZ #865]
	* math/tgmath.h: Correctly determine result type for
	__TGMATH_BINARY_REAL_ONLY,
	__TGMATH_TERNARY_FIRST_SECOND_REAL_ONLY,
	__TGMATH_TERNARY_REAL_ONLY, and __TGMATH_BINARY_REAL_IMAG.

2005-09-17  Andreas Jaeger  <aj@suse.de>

	[BZ #865]
	* math/test-tgmath-int.c: New file.
	* math/Makefile (tests): Add test-tgmath-int.

2005-10-14  Ulrich Drepper  <drepper@redhat.com>

	[BZ #804]
	* malloc/tst-mtrace.sh: Work around for bootstraping.

	* locale/programs/ld-collate.c (collate_output): Fix counting of
	elements.  Don't limit table size.  Use correct secondary hash
	function.
	* locale/localeinfo.h (LIMAGIC): Change value returned for LC_COLLATE.
	* posix/fnmatch_loop.c: Adjust for changed secondary hash function.
	* posix/regcomp.c: Likewise.

	* time/asctime.c (asctime_internal): Use __snprintf instead of
	snprintf to avoid PLT entry.

	* sysdeps/unix/opendir.c (__opendir): Pass extra argument to
	__alloc_dir.
	(__alloc_dir): Only close descriptor on error if new parameter is true.
	* sysdeps/unix/fdopendir.c (fdopendir): Pass extra argument to
	__alloc_dir.  Don't close fd on error.
	* include/dirent.h (__alloc_dir): Adjust prototype.

	* stdlib/Makefile (tests): Add tst-ucontext-off.
	* stdlib/tst-ucontext-off.c: New file.
	* sysdeps/unix/sysv/linux/x86_64/ucontext_i.h (TESTS): Define.
	* sysdeps/unix/sysv/linux/i386/ucontext_i.h (TESTS): Likewise.

	[BZ #1468]
	* sysdeps/unix/sysv/linux/x86_64/ucontext_i.h: Fix values for
	oFPREGS, oSIGMASK, oFPREGSMEM, and oMXCSR.
	Patch by Nicholas Miell <nmiell@comcast.net>.

	[BZ #1460]
	* time/asctime.c (asctime_internal): New function, derived from
	asctime_r.  Takes additional parameter which is the buffer length.
	Use snprintf instead sprintf, if it overflows, fail.
	(asctime_r): Call asctime_internal with 26 as buffer length.
	(asctime): Call asctime_internal with length of internal buffer.
	* time/Makefile (tests): Add bug-asctime_r.
	* time/bug-asctime_r.c: New file.

	[BZ #1459]
	* time/asctime.c (__asctime_r): Check for tm_year computation to
	overflow and fail in this case.
	* time/Makefile (tests): Add bug-asctime.
	* time/bug-asctime.c: New file.

	[BZ #1458]
	* sysdeps/unix/sysv/linux/i386/bits/mman.h: Define MREMAP_FIXED.
	* sysdeps/unix/sysv/linux/ia64/bits/mman.h: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/bits/mman.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/bits/mman.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/mman.h: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/bits/mman.h: Likewise.
	* misc/sys/mman.h: Add ellipsis after last parameter of mremap and
	adjust leading comment.
	* sysdeps/unix/sysv/linux/syscalls.list: Add pointer parameter to
	mremap syscall.
	* include/sys/mman.h (__mremap): Add ellipsis.
	* malloc/memusage.c: Adjust mremap wrapper for optional additional
	parameter.

2005-10-13  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1405]
	* libio/iogetdelim.c (_IO_getdelim): Fix truncation of return
	value.  Avoid overflow in computation.

	[BZ #1373]
	* argp/argp.h: Remove __NTH for __argp_usage inline function.

2005-08-26  Paul Eggert  <eggert@cs.ucla.edu>

	[BZ #1248]
	* posix/regex_internal.h (bitset_not, bitset_merge, bitset_not_merge,
	bitset_mask, re_string_allocate, re_string_construct,
	re_string_reconstruct, re_string_destruct, re_string_elem_size_at,
	re_string_char_size_at, re_string_wchar_at, re_string_peek_byte_case,
	re_string_fetch_byte_case, re_node_set_alloc, re_node_set_init_1,
	re_node_set_init_2, re_node_set_init_copy, re_node_set_add_intersect,
	re_node_set_init_union, re_node_set_merge, re_node_set_insert,
	re_node_set_insert_last, re_node_set_compare, re_node_set_contains,
	re_node_set_remove_at, re_dfa_add_node, re_acquire_state,
	re_acquire_state_context): Remove unnecessary forward decls.
	(re_string_char_size_at, re_string_wchar_at, re_string_elem_size_at):
	Put __attribute at function definition, now that the function decl
	has been removed.
	* posix/regex_internal.c (re_string_peek_byte_case,
	re_string_fetch_byte_case, re_node_set_compare, re_node_set_contains):
	Likewise.

2005-08-23  Paul Eggert  <eggert@cs.ucla.edu>

	[BZ #1231]
	* posix/regex_internal.c (re_string_skip_chars, register_state,
	calc_state_hash): Remove forward decls.
	* posix/regexec.c (acquire_init_state_context, check_halt_node_context,
	proceed_next_node, pop_fail_stack, sub_epsilon_src_nodes,
	clean_state_log_if_needed): Likewise.

2005-10-13  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex.c: No need to use K&R definitions for static functions.
	* posix/regex_internal.c: Likewise.
	* posix/regcomp.c: Likewise.

	[BZ #1466]
	* sysdeps/generic/s_csqrt.c (__csqrt): For zero real part, return
	principal square root.
	* sysdeps/generic/s_csqrtf.c (__csqrtf): Likewise.
	* sysdeps/generic/s_csqrtl.c (__csqrtl): Likewise.
	* math/libm-test.inc (csqrt_test): Add test for returning
	principal value.

	* include/features.h: Define _POSIX_C_SOURCE to 200112 for
	_XOPEN_SOURCE == 600.

2005-10-12  Ulrich Drepper  <drepper@redhat.com>

	* malloc/malloc.c (_int_free): Fail if block size is obviously wrong.

	* include/malloc.h: Remove _int_new_arena prototype.
	* malloc/arena.c (_int_new_arena): Move definition ahead of
	arena_get2 and make static.

	Correctly implement M_MXFAST.
	* malloc/malloc.c (struct malloc_state): Replace max_fast with flags
	fields.
	(global_max_fast): New variable.
	(set_max_fast): Change to not require arena parameter and to modify
	global_max_fast.  Change all callers.
	(get_max_fast): New macro.  Use this instead of directly accessing
	now removed max_fast arena member.
	(have_fastchunks): Use flags instead of max_fast.
	(clear_fastchunks): Likewise.
	(set_fastchunks): Likewise.
	(contiguous): Likewise.
	(noncontiguous): Likewise.
	(set_noncontiguous): Likewise.
	(set_contiguous): Likewise.
	(malloc_init_state): Explicitly set FASTCHUNKS_BIT.  Call set_max_fast
	only for main arena.
	* malloc/hooks.c (public_sET_STATe): Adjust set_max_fast use.

2005-10-10  Daniel Jacobowitz  <dan@codesourcery.com>

	* sysdeps/generic/bits/byteswap.h (__bswap_constant_16): New macro.
	(__bswap_16): Use it.
	(__bswap_constant_32): New macro.
	(__bswap_32): Use it.

2005-10-10  Ulrich Drepper  <drepper@redhat.com>

	* malloc/arena.c (ptmalloc_unlock_all2): Reset atfork_recursive_cntr.

2005-10-08  Jakub Jelinek  <jakub@redhat.com>

	* nss/getent.c (hosts_keys): Pass INADDRSZ as size rather
	than IN6ADDRSZ to AF_INET gethostbyaddr.

2005-10-07  Roland McGrath  <roland@redhat.com>

	[BZ #1438]
	* include/features.h: Make tests on _FORTIFY_SOURCE and __OPTIMIZE__
	friendly to -Wundef.
	(__USE_FORTIFY_LEVEL): Always define it, to 0 if nothing else.

2005-10-06  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/readonly-area.c: Allow fopen to fail because
	the file does not exist.

2005-10-05  Simon Josefsson  <jas@extundo.com>

	[BZ #1423]
	* crypt/md5.h (MD5_DIGEST_SIZE, MD5_BLOCK_SIZE): New macros.

2005-10-05  Roland McGrath  <roland@redhat.com>

	* crypt/Makefile (distribute): Remove duplicate defn.

	* sysdeps/generic/ldsodefs.h (struct audit_ifaces):
	Use ARCH_PLTENTER_MEMBERS and ARCH_PLTEXIT_MEMBERS macros if defined.
	* elf/tst-auditmod1.c: Include <tst-audit.h> to define more
	architecture-specific code.
	* sysdeps/generic/tst-audit.h: New file.
	* elf/Makefile (distribute): Add it.

2005-10-05  Daniel Jacobowitz  <dan@codesourcery.com>

	* elf/elf.h (R_ARM_TLS_DTPMOD32, R_ARM_TLS_DTPOFF32,
	R_ARM_TLS_TPOFF32, R_ARM_TLS_GD32, R_ARM_TLS_LDM32,
	R_ARM_TLS_LDO32, R_ARM_TLS_IE32, R_ARM_TLS_LE32): New macros.

2005-10-03  Roland McGrath  <roland@redhat.com>

	* sysdeps/powerpc/nofpu: Directory removed, saved in ports repository.

2005-09-30  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex.h: Pretty printing.
	Clean up namespace a bit.

2005-09-30  Jakub Jelinek  <jakub@redhat.com>

	* posix/regexec.c (update_cur_sifted_state, check_arrival,
	check_arrival_add_next_nodes): Avoid using uninitialized variable.

	* malloc/memusage.c (dest): Fix a bunch of warnings on 32-bit arches.

	* sysdeps/i386/fpu/libm-test-ulps: Update for GCC 4.0.x.

2005-09-29  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/Makefile (modules): Add IBM803, IBM901, IBM902, IBM921,
	IBM1008, IBM1008_420, IBM1097, IBM1112, IBM1123, IBM1130, IBM1140,
	IBM1141, IBM1142, IBM1143, IBM1144, IBM1145, IBM1146, IBM1147, IBM1148,
	IBM1149, IBM1166, IBM1167, IBM4517, IBM4899, IBM4909, IBM4971,
	IBM5347, IBM9030, IBM9066, IBM9448, IBM12712, IBM16804.
	(distribute): Add ibm803.c, ibm803.h, ibm901.c, ibm901.h, ibm902.c,
	ibm902.h, ibm921.c, ibm921.h, ibm1008.c, ibm1008.h, ibm1008_420.c,
	ibm1097.c, ibm1097.h, ibm1112.c, ibm1112.h, ibm1123.c, ibm1123.h,
	ibm1130.c, ibm1130.h, ibm1140.c, ibm1140.h, ibm1141.c, ibm1141.h,
	ibm1142.c, ibm1142.h, ibm1143.c, ibm1143.h, ibm1144.c, ibm1144.h,
	ibm1145.c, ibm1145.h, ibm1146.c, ibm1146.h, ibm1147.c, ibm1147.h,
	ibm1148.c, ibm1148.h, ibm1149.c, ibm1149.h, ibm1166.c, ibm1166.h,
	ibm1167.c, ibm1167.h, ibm4517.c, ibm4517.h, ibm4899.c, ibm4899.h,
	ibm4909.c, ibm4909.h, ibm4971.c, ibm4971.h, ibm5347.c, ibm5347.h,
	ibm9030.c, ibm9030.h, ibm9066.c, ibm9066.h, ibm9448.c, ibm9448.h,
	ibm12712.c, ibm12712.h, ibm16804.c, ibm16804.h.
	* iconvdata/TESTS: Add entries for new modules.
	* iconvdata/gconv-modules: Likewise.
	* iconvdata/ibm803.c: New file.
	* iconvdata/ibm803.h: New file.
	* iconvdata/ibm901.c: New file.
	* iconvdata/ibm901.h: New file.
	* iconvdata/ibm902.c: New file.
	* iconvdata/ibm902.h: New file.
	* iconvdata/ibm921.c: New file.
	* iconvdata/ibm921.h: New file.
	* iconvdata/ibm1008.c: New file.
	* iconvdata/ibm1008.h: New file.
	* iconvdata/ibm1008_420.c: New file.
	* iconvdata/ibm1097.c: New file.
	* iconvdata/ibm1097.h: New file.
	* iconvdata/ibm1112.c: New file.
	* iconvdata/ibm1112.h: New file.
	* iconvdata/ibm1123.c: New file.
	* iconvdata/ibm1123.h: New file.
	* iconvdata/ibm1130.c: New file.
	* iconvdata/ibm1130.h: New file.
	* iconvdata/ibm1140.c: New file.
	* iconvdata/ibm1140.h: New file.
	* iconvdata/ibm1141.c: New file.
	* iconvdata/ibm1141.h: New file.
	* iconvdata/ibm1142.c: New file.
	* iconvdata/ibm1142.h: New file.
	* iconvdata/ibm1143.c: New file.
	* iconvdata/ibm1143.h: New file.
	* iconvdata/ibm1144.c: New file.
	* iconvdata/ibm1144.h: New file.
	* iconvdata/ibm1145.c: New file.
	* iconvdata/ibm1145.h: New file.
	* iconvdata/ibm1146.c: New file.
	* iconvdata/ibm1146.h: New file.
	* iconvdata/ibm1147.c: New file.
	* iconvdata/ibm1147.h: New file.
	* iconvdata/ibm1148.c: New file.
	* iconvdata/ibm1148.h: New file.
	* iconvdata/ibm1149.c: New file.
	* iconvdata/ibm1149.h: New file.
	* iconvdata/ibm1166.c: New file.
	* iconvdata/ibm1166.h: New file.
	* iconvdata/ibm1167.c: New file.
	* iconvdata/ibm1167.h: New file.
	* iconvdata/ibm4517.c: New file.
	* iconvdata/ibm4517.h: New file.
	* iconvdata/ibm4899.c: New file.
	* iconvdata/ibm4899.h: New file.
	* iconvdata/ibm4909.c: New file.
	* iconvdata/ibm4909.h: New file.
	* iconvdata/ibm4971.c: New file.
	* iconvdata/ibm4971.h: New file.
	* iconvdata/ibm5347.c: New file.
	* iconvdata/ibm5347.h: New file.
	* iconvdata/ibm9030.c: New file.
	* iconvdata/ibm9030.h: New file.
	* iconvdata/ibm9066.c: New file.
	* iconvdata/ibm9066.h: New file.
	* iconvdata/ibm9448.c: New file.
	* iconvdata/ibm9448.h: New file.
	* iconvdata/ibm12712.c: New file.
	* iconvdata/ibm12712.h: New file.
	* iconvdata/ibm16804.c: New file.
	* iconvdata/ibm16804.h: New file.
	* iconvdata/testdata/IBM803: New file.
	* iconvdata/testdata/IBM803..UTF8: New file.
	* iconvdata/testdata/IBM901: New file.
	* iconvdata/testdata/IBM901..UTF8: New file.
	* iconvdata/testdata/IBM902: New file.
	* iconvdata/testdata/IBM902..UTF8: New file.
	* iconvdata/testdata/IBM921: New file.
	* iconvdata/testdata/IBM921..UTF8: New file.
	* iconvdata/testdata/IBM1008: New file.
	* iconvdata/testdata/IBM1008..UTF8: New file.
	* iconvdata/testdata/IBM1097: New file.
	* iconvdata/testdata/IBM1097..UTF8: New file.
	* iconvdata/testdata/IBM1112: New file.
	* iconvdata/testdata/IBM1112..UTF8: New file.
	* iconvdata/testdata/IBM1123: New file.
	* iconvdata/testdata/IBM1123..UTF8: New file.
	* iconvdata/testdata/IBM1130: New file.
	* iconvdata/testdata/IBM1130..UTF8: New file.
	* iconvdata/testdata/IBM1140: New file.
	* iconvdata/testdata/IBM1140..UTF8: New file.
	* iconvdata/testdata/IBM1141: New file.
	* iconvdata/testdata/IBM1141..UTF8: New file.
	* iconvdata/testdata/IBM1142: New file.
	* iconvdata/testdata/IBM1142..UTF8: New file.
	* iconvdata/testdata/IBM1143: New file.
	* iconvdata/testdata/IBM1143..UTF8: New file.
	* iconvdata/testdata/IBM1144: New file.
	* iconvdata/testdata/IBM1144..UTF8: New file.
	* iconvdata/testdata/IBM1145: New file.
	* iconvdata/testdata/IBM1145..UTF8: New file.
	* iconvdata/testdata/IBM1146: New file.
	* iconvdata/testdata/IBM1146..UTF8: New file.
	* iconvdata/testdata/IBM1147: New file.
	* iconvdata/testdata/IBM1147..UTF8: New file.
	* iconvdata/testdata/IBM1148: New file.
	* iconvdata/testdata/IBM1148..UTF8: New file.
	* iconvdata/testdata/IBM1149: New file.
	* iconvdata/testdata/IBM1149..UTF8: New file.
	* iconvdata/testdata/IBM1166: New file.
	* iconvdata/testdata/IBM1166..UTF8: New file.
	* iconvdata/testdata/IBM1167: New file.
	* iconvdata/testdata/IBM1167..UTF8: New file.
	* iconvdata/testdata/IBM4517: New file.
	* iconvdata/testdata/IBM4517..UTF8: New file.
	* iconvdata/testdata/IBM4899: New file.
	* iconvdata/testdata/IBM4899..UTF8: New file.
	* iconvdata/testdata/IBM4909: New file.
	* iconvdata/testdata/IBM4909..UTF8: New file.
	* iconvdata/testdata/IBM4971: New file.
	* iconvdata/testdata/IBM4971..UTF8: New file.
	* iconvdata/testdata/IBM5347: New file.
	* iconvdata/testdata/IBM5347..UTF8: New file.
	* iconvdata/testdata/IBM9030: New file.
	* iconvdata/testdata/IBM9030..UTF8: New file.
	* iconvdata/testdata/IBM9066: New file.
	* iconvdata/testdata/IBM9066..UTF8: New file.
	* iconvdata/testdata/IBM9448: New file.
	* iconvdata/testdata/IBM9448..UTF8: New file.
	* iconvdata/testdata/IBM12712: New file.
	* iconvdata/testdata/IBM12712..UTF8: New file.
	* iconvdata/testdata/IBM16804: New file.
	* iconvdata/testdata/IBM16804..UTF8: New file.
	Patch by Masahide WASHIZAWA <washi@jp.ibm.com>.

	* iconvdata/run-iconv-test.sh: Run ASCII->encoding->ASCII suntzus
	test only if $subset is N.

2005-09-29  Roland McGrath  <roland@redhat.com>

	[BZ #1392]
	* posix/sys/wait.h [!__GNUC__ || __cplusplus] (__WAIT_INT): Use const.

2005-09-29  Alfred M. Szmidt  <ams@gnu.org>

	* elf/rtld.c [DL_ARGV_NOT_RELRO] (_dl_argc, _dl_skip_args):
	Don't use attribute_relro.

2005-09-29  Roland McGrath  <roland@redhat.com>

	[BZ #1392]
	* posix/sys/wait.h (__WAIT_INT): Rewrite using an initializer,
	in case __typeof yields a const-qualified type.

2005-09-28  Ulrich Drepper  <drepper@redhat.com>

	* dirent/dirent.h: Declare fdopendir.
	* dirent/Versions: Export fdopendir for GLIBC_2.4.
	* dirent/Makefile (routines): Add fdopendir.
	(tests): Add tst-fdopendir.
	* dirent/tst-fdopendir.c: New file.
	* include/dirent.h: Declare __alloc_dir.
	* sysdeps/generic/fdopendir.c: New file.
	* sysdeps/unix/fdopendir.c: New file.
	* sysdeps/unix/opendir.c: Split off back part of opendir into new
	function __alloc_dir.

2005-09-26  Steven Munroe  <sjmunroe@us.ibm.com>

	[BZ #1384]
	* sysdeps/powerpc/fpu/libm-test-ulps: Adjust expected y1, y1f, yn,
	ynf results.

2005-09-06  Paul Eggert  <eggert@cs.ucla.edu>
            Ulrich Drepper  <drepper@redhat.com>

	[BZ #1302]
	Change bitset word type from unsigned int to unsigned long int,
	as this has better performance on typical 64-bit hosts.  Change
	bitset type name to bitset_t.
	* posix/regcomp.c (build_equiv_class, build_charclass):
	(build_range_exp, build_collating_symbol):
	Prefer bitset_t to re_bitset_ptr_t in prototypes, when the actual
	argument is a bitset.  This is merely a style issue, but it makes
	it clearer that an entire array is expected.
	(re_compile_fastmap_iter, init_dfa, init_word_char, optimize_subexps,
	lower_subexp): Adjust for new bitset_t definition.
	(lower_subexp, parse_bracket_exp, built_charclass_op): Likewise.
	* posix/regex_internal.h (bitset_set, bitset_clear, bitset_contain,
	bitset_not, bitset_merge, bitset_set_all, bitset_mask): Likewise.
	* posix/regexec.c (check_dst_limits_calc_pos_1,
	check_subexp_matching_top, build_trtable, group_nodes_into_DFAstates):
	Likewise.
	* posix/regcomp.c (utf8_sb_map): Don't assume initializer
	== 0xffffffff.
	* posix/regex_internal.h (BITSET_WORD_BITS): Renamed from UINT_BITS.
	All uses changed.
	(BITSET_WORDS): Renamed from BITSET_UINTS.  All uses changed.
	(bitset_word_t): New type, replacing 'unsigned int' for bitset uses.
	All uses changed.
	(BITSET_WORD_MAX): New macro.
	(bitset_set, bitset_clear, bitset_contain, bitset_empty,
	(bitset_set_all, bitset_copy):  Adjust for bitset_t change.
	(bitset_empty, bitset_copy):
	Prefer sizeof (bitset_t) to multiplying it out ourselves.
	(bitset_not_merge): Remove; unused.
	(bitset_contain): Return bool, not unsigned int with one bit on.
	All callers changed.
	* posix/regexec.c (build_trtable): Don't assume bitset_t has no
	stricter alignment than re_node_set; do this by defining a new
	internal type struct dests_alloc and using it to allocate memory.

2005-09-27  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1230]
	* stdlib/strtod_l.c (STRNCASECMP): Always use C locale object.
	(TOLOWER_C): Define.  Use it when recognizing inf and nan.
	* stdlib/Makefile (tests): Add bug-strtod2.
	* stdlib/bug-strtod2.c: New file.

2005-09-21  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>

	[BZ #1361]
	* argp/argp-fmtstream.h [HAVE_CONFIG_H]: Do not #include <config.h>.
	* argp/argp-eexst.c, argp/argp-fmtstream.c, argp/argp-fs-xinl.c,
	argp/argp-xinl.c: Fix up whitespace.

2005-09-27  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1158]
	* stdlib/cxa_atexit.c (__new_exitfn): Rewrite to preserve order in
	which the functions were registered.
	* dlfcn/Makefile: Add rules to build and run bug-atexit1 and
	bug-atexit2.
	* dlfcn/bug-atexit1.c: New file.
	* dlfcn/bug-atexit1-lib.c: New file.
	* dlfcn/bug-atexit2.c: New file.
	* dlfcn/bug-atexit2-lib.c: New file.

	[BZ #1078]
	* libio/fileops.c (_IO_new_file_xsputn): Determine amount of
	available space in non-line-buffered buffer correctly.
	* libio/oldfileops.c (_IO_old_file_xsputn): Likewise.
	* stdio-common/Makefile (tests): Add tst-fwrite.
	* stdio-common/tst-fwrite.c: New file.

2005-09-26  Ulrich Drepper  <drepper@redhat.com>

	[BZ #838]
	* malloc/arena.c (ptmalloc_lock_all): If global lock already taken
	by the same thread, just bump the counter.
	(ptmalloc_unlock_all): If counter for recursive locks hasn't reached
	zero, don't do anything else.
	* malloc/Makefile (tests): Add tst-mallocfork.
	* malloc/tst-mallocfork.c: New file.

	[BZ #808]
	* malloc/malloc.c (_int_realloc): Make error message clearer.

	[BZ #713]
	* libio/iofgets.c: Treat N==1 correctly.
	* libio/iofgets_u.c: Likewise.
	* libio/iofgetws.c: Likewise.
	* libio/iofgetws_u.c: Likewise.
	* stdio-common/Makefile (tests): Add tst-fgets.
	* stdio-common/tst-fgets.c: New file.

2005-01-11  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #652]
	* posix/getconf.c: Add new option -a to print the names of
	the current system configuration variables to stdout.
	Based on patch from Josh Aas <josha@sgi.com>.

2005-09-26  Ulrich Drepper  <drepper@redhat.com>

	[BZ #644]
	* sysdeps/posix/getaddrinfo.c (fls): New function.
	(gaih_inet): Don't use ffs, use fls.  Convert address to native byte
	order first.
	* posix/Makefile (tests): Add tst-rfc3484.
	* posix/tst-rfc3484.c: New file.

	[BZ #627]
	* libio/iofclose.c (_IO_new_fclose): Unlock the internal lock
	before destroying it as part of the _IO_FINISH call.
	* libio/oldiofclose.c (_IO_old_fclose): Likewise.

	[BZ #524]
	* sysdeps/posix/getaddrinfo.c (match_prefix): Fix matching loop if
	number of bits is multiple of 8.
	Patch by Fredrik Tolf <fredrik@dolda2000.com>.

	[BZ #516]
	* elf/dl-load.c: Report failed loading due to ELF class mismatch
	with better words.

	[BZ #162]
	* manual/llio.texi (Waiting for I/O): Correct description of read
	conditions reported by select.

2005-09-24  Jakub Jelinek  <jakub@redhat.com>

	* inet/getnetgrent_r.c (innetgr): Call endfct even if result != 0.
	Return 1 only if result == 1.  Patch by Benoit Capelle.

2005-09-25  Ulrich Drepper  <drepper@redhat.com>

	[BZ #278]
	* manual/stdio.texi (Hook Functions): Correct type of position
	parameter of seeker and fix fallout of the change in the text.

	[BZ #714]
	* iconv/loop.c [!STORE_REST] (SINGLE): Correctly record number of
	left-over bytes and store them correctly.
	* wcsmbs/tst-mbrtowc2.c: New file.
	* wcsmbs/Makefile (tests): Add tst-mbrtowc2.

2005-09-24  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/i386/signal.S: Removed, saved in ports repository.
	* sysdeps/unix/sysv/i386/sigreturn.S: Likewise.

2005-09-24  Ulrich Drepper  <drepper@redhat.com>

	[BZ #545]
	* locale/iso-639.def: More updates from the current spec.

	* locale/programs/ld-address.c (address_finish): Produce better
	error messages for invalid lang_ab use.

	* locale/iso-639.def: Add a few updates from current spec.

2005-09-23  Ulrich Drepper  <drepper@redhat.com>

	[BZ #704]
	* locale/iso-4217.def: Replace MGF with MGA.

	* iconvdata/jis0208.c (__jisx0208_from_ucs4_lat1): Reduce size of
	array.
	* iconvdata/jis0208.h (ucs4_to_jisx0208): Adjust access.

2004-08-13  GOTO Masanori  <gotom@debian.or.jp>

	[BZ #395]
	* iconvdata/jis0208.c: Remove 0x005C mapping from
	__jisx0208_from_ucs4_lat1.
	Reported by Fumitoshi UKAI <ukai@debian.or.jp>

2005-09-23  Ulrich Drepper  <drepper@redhat.com>

	[BZ #394]
	* libio/fmemopen.c (fmemopen_write): Return 0 instead of -1 if
	nothing can be written.
	* libio/iofopncook.c (_IO_cookie_write): If something went wrong,
	set error bit.

2005-09-22  Ulrich Drepper  <drepper@redhat.com>

	[BZ #281]
	* posix/regex.h: Define RE_TRANSLATE_TYPE as unsigned char *.
	* posix/regcomp.c: Remove unnecessary uses of
	unsigned RE_TRANSLATE_TYPE.
	* posix/regex_internal.h: Likewise.
	* posix/regex_internal.c: Likewise.
	* posix/regexexec.c: Likewise.
	Based on a patch by Stepan Kasal <kasal@ucw.cz>.

	[BZ #1035]
	* locale/iso-4217.def: Replace TRL entry with TRY for new Turkish Lira.

	[BZ #1363]
	* nscd/nscd_getpw_r.c (nscd_getpw_r): Remove incorrectly C&Ped
	free call in code handling detection of GC runs.

2005-09-22  Roland McGrath  <roland@redhat.com>

	* elf/dl-tsd.c (__libc_dl_error_tsd): Use attribute_tls_model_ie for
	static __thread variable.
	From Alexandre Oliva <aoliva@redhat.com>

	* Makefile ($(objpfx)c++-types-check.out): Use $<, not $^, in command.
	Reported by Alexandre Oliva <aoliva@redhat.com>.

2005-09-20  Jakub Jelinek  <jakub@redhat.com>

	* nscd/dbg_log.c (init_logfile): Use fopen64 rather than fopen.

2005-09-20  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/lddlibc4.c (main): Use execv, not execl.

	[BZ #1346]
	* elf/dl-load.c (_dl_map_object_from_fd) [HAVE_Z_RELRO]: Do relro
	magic on __stack_prot only if [SHARED].  Skip mprotect if __stack_prot
	lies outside the page-rounded-down relro region.

2005-09-19  Richard Henderson  <rth@redhat.com>

	[BZ #1358]
	* sysdeps/unix/alpha/sysdep.h (inline_syscall1): Copy argument(s)
	to a temporary first.
	(inline_syscall2, inline_syscall3, inline_syscall4): Likewise.
	(inline_syscall5, inline_syscall6): Likewise.

	* sysdeps/alpha/ldiv.S (lldiv): Add alias.

2005-09-17  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1010]
	* sysdeps/unix/sockatmark.c (sockatmark): Use SIOCATMARK correctly.

	[BZ #1053]
	* debug/xtrace.sh: Add missing escape character in -? match.
	Patch by Peter Breitenlohner <peb@mppmu.mpg.de>.

	[BZ #1051]
	* wctype/wctype.h: Remove stray __END_NAMESPACE_C99.
	* stdlib/stdlib.h: Use __END_NAMESPACE_STD instead of
	__END_NAMESPACE_C99 in one place.
	* scripts/begin-end-check.pl: New file.
	Patch by Ralph Loader <suckfish@ihug.co.nz>.
	* Makefile: Add rules to run scripts/begin-end-check.pl.

2005-09-17  Andreas Jaeger  <aj@suse.de>

	* timezone/zdump.c: Include ctype.h.

2005-09-16  Andreas Jaeger  <aj@suse.de>

	[BZ #1047]
	* sysdeps/unix/sysv/linux/mips/getpagesize.c: New file.

2005-09-16  Maciej W. Rozycki  <macro@linux-mips.org>

	[BZ #933]
	* sysdeps/unix/sysv/linux/mips/brk.c (__brk): Load the number of
	the syscall immediately before invocation.
	* sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S (__ioctl): Likewise.
	* sysdeps/unix/sysv/linux/mips/mips64/syscall.S (syscall): Likewise.

	* sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S (__ioctl): Use
	macros to handle GP.
	* sysdeps/unix/sysv/linux/mips/mips64/syscall.S (syscall):
	Likewise.  Update inaccurate comments.

2005-09-13  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/posix/spawni.c (__spawni): Automatically recognize some
	more cases when we can use vfork.

2005-08-29  Thomas Schwinge  <schwinge@nic-nac-project.de>

	[BZ #1261]
	* manual/memory.texi (Hooks for Malloc): Correct prototype of
	my_init_hook and definition of my_free_hook.

2005-09-12  Roland McGrath  <roland@redhat.com>

	[BZ #1331]
	* malloc/obstack.h [!__STDC__] (obstack_int_grow_fast): Fix misnamed
	macro argument.
	Reported by Matej Vela <vela@debian.org>.

2005-09-12  Jakub Jelinek  <jakub@redhat.com>

	* malloc/malloc.c (struct malloc_chunk): Fix comment typo.
	(public_cALLOc): For mmapped chunks and perturb_byte != 0,
	don't clear SIZE_SZ bytes more than should be cleared.

2005-09-09  Jakub Jelinek  <jakub@redhat.com>

	* inet/getnetgrent_r.c: Include assert.
	(setup): Remove FUNC_NAME and ALL arguments, assume they are always
	"setnetgrent" and 1.
	(endnetgrent_hook): New function.
	(internal_endnetgrent): Use it.
	(__internal_setnetgrent_reuse): Use it.  Adjust setup caller.
	If status is NSS_STATUS_SUCCESS, yet action is continue, call
	endnetgrent hook.
	(internal_getnetgrent_r): Use __nss_lookup_function rather than
	setup.  Recompute getfct pointer after successful
	__internal_setnetgrent_reuse.  Don't use __nss_next.
	(innetgr): Use __nss_lookup_function instead of __nss_lookup.
	Adjust setup caller.
	* nss/nss_files/files-netgrp.c (_nss_files_endnetgrent): Always clear
	data_size and cursor.  Add libnss_files_hidden_proto and
	libnss_files_hidden_def.
	(_nss_files_setnetgrent): Call _nss_files_endnetgrent on failure.
	* nis/nss_nis/nis-netgrp.c (internal_endnetgrent): Always clear
	data_size and cursor.
	(_nss_nis_setnetgrent): Don't call internal_endnetgrent.
	(_nss_nis_getnetgrent_r): Remove result->cursor == NULL handling.
	* nis/nss_nisplus/nisplus-netgrp.c (internal_endnetgrent): Always clear
	data_size and position.
	(_nss_nisplus_setnetgrent): Don't call internal_endnetgrent.

2005-09-09  Ulrich Drepper  <drepper@redhat.com>

	* nss/getent.c (netgroup_keys): Call endnetgrent.
	(main): Call mtrace.

	* nss/nss_files/files-netgrp.c (_nss_files_setnetgrent): We don't
	need locking for the stream.  Use feof_unlocked.

2005-09-09  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1318]
	* locale/loadarchive.c (_nl_load_locale_from_archive): Free
	normalized_codeset even if p was already normalized.
	Reported by Jaroslav Snajdr <jsnajdr@kerio.com>.

2005-09-08  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/dl-sysdep.c (_dl_important_hwcaps): Decode DSOCAPS
	properly, first byte is bit number in mask.  Skip disabled caps.

2005-07-11  Derek R. Price  <derek@ximbiot.com>

	[BZ #1061]
	* sysdeps/generic/glob.c (glob): Only a 0 return from
	getlogin_r means success, according to POSIX 1003.2.

2005-06-23  Paul Eggert  <eggert@cs.ucla.edu>

	[BZ #1033]
	* time/mktime.c: Import from gnulib.
	The following macros are now consistent with other gnulib code.
	This does not change mktime's behavior.
	(TYPE_IS_INTEGER): New macro.
	(time_t_is_integer): Use it.
	(TYPE_TWOS_COMPLEMENT): New macro.
	(twos_complement_arithmetic): Use it.
	(TYPE_ONES_COMPLEMENT): New macro.
	(TYPE_MINIMUM, TYPE_MAXIMUM): Now supports signed-magnitude.
	mktime doesn't use this, but the code now matches other gnulib code.
	(ranged_convert): Pacify GCC 4.0 in a different way, which
	generates a few bytes less code.
	(ranged_convert, __mktime_internal): When calling a function via a
	pointer P, use P () rather than (*P) (), as we now assume C89 or
	better.

2005-09-07  Alexandre Oliva  <aoliva@redhat.com>

	* timezone/test-tz.c: Update to match tzdata2005m.
	* timezone/tst-timezone.c: Likewise.

2005-09-07  Ulrich Drepper  <drepper@redhat.com>

	* posix/regexec.c (find_recover_state): Remove unnecessary
	initialization.
	(transit_state_bkref): Make DFA a const pointer.
	(get_subexp): Likewise.
	(check_arrival): Likewise.
	(update_cur_sifted_state): Likewise.
	(re_search_internal): Likewise.
	(prune_impossible_nodes): Likewise.
	(acquire_init_state_context): Likewise.
	(proceed_next_node): Likewise.
	(set_regs): Likewise.
	(free_fail_stack_return): Likewise.
	(check_arrival_expand_ecl): Mark DFA parameter as const.
	(check_arrival_expand_ecl_sub): Likewise.
	(check_subexp_limits): Likewise.
	(sub_epsilon_src_nodes):  Likewise.
	(add_epsilon_src_nodes):  Likewise.
	(merge_state_array): Likewise.
	(update_regs): Likewise.
	(build_trtable): Likewise.
	(sift_states_backward): Mark MCTX parameter as const.
	(build_sifted_states): Likewise.
	(update_cur_sifted_state): Likewise.
	(sift_states_mkref): Likewise.
	(check_arrival_expand_ecl): Mark eclosure as const.
	(check_dst_limits_calc_pos_1): Likewise.
	* posix/regex_internal.h (re_match_context_t): Make dfa a const
	pointer.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* timezone/africa: Update from tzdata2005m.
	* timezone/asia: Likewise.
	* timezone/australasia: Likewise.
	* timezone/backward: Likewise.
	* timezone/europe: Likewise.
	* timezone/northamerica: Likewise.
	* timezone/southamerica: Likewise.
	* timezone/zone.tab: Likewise.
	* timezone/zdump.c: Update from tzcode2005m.

	* posix/regexec.c (merge_state_with_log): Define dfa as const pointer.
	(transit_state_sb): Likewise.
	(transit_state_mb): Likewise.
	(sift_states_iter_mb): Likewise.
	(check_arrival_add_next_nodes): Likewise.
	(check_node_accept_bytes): Change first parameter to pointer-to-const.
	[_LIBC] (re_search_2_stub): Use mempcpy.

	* posix/regex_internal.c (re_string_reconstruct): Avoid calling
	mbrtowc for very simple UTF-8 case.

2005-09-01  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regex_internal.c (build_wcs_upper_buffer): Fix portability
	bugs in int versus size_t comparisons.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex_internal.c (re_acquire_state): Make DFA pointer arg
	a pointer-to-const.
	(re_acquire_state_context): Likewise.
	* posix/regex_internal.h: Adjust prototypes.

2005-08-31  Jim Meyering  <jim@meyering.net>

	* posix/regcomp.c (search_duplicated_node): Make first pointer arg
	a pointer-to-const.
	* posix/regex_internal.c (create_ci_newstate, create_cd_newstate,
	register_state): Likewise.
	* posix/regexec.c (search_cur_bkref_entry, check_dst_limits):
	(check_dst_limits_calc_pos_1, check_dst_limits_calc_pos):
	(group_nodes_into_DFAstates): Likewise.

2005-08-31  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regexec.c (re_search_internal): Simplify update of
	rm_so and rm_eo by replacing "if (A == B) A += C - B;"
	with the equivalent of "if (A == B) A = C;".

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regcomp.c (re_compile_internal): Change third parameter type
	to size_t.
	(init_dfa): Likewise.  Make sure that arithmetic on pat_len doesn't
	overflow.
	* posix/regex_internal.h (struct re_dfa_t): Change type of nodes_alloc
	and nodes_len to size_t.
	* posix/regex_internal.c (re_dfa_add_node): Use size_t as type for
	new_nodes_alloc.  Check for overflow.

2005-08-31  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regcomp.c (re_compile_fastmap_iter, init_dfa, init_word_char):
	(optimize_subexps, lower_subexp):
	Don't assume 1<<31 has defined behavior on hosts with 32-bit int,
	since the signed shift might overflow.  Use 1u<<31 instead.
	* posix/regex_internal.h (bitset_set, bitset_clear, bitset_contain):
	Likewise.
	* posix/regexec.c (check_dst_limits_calc_pos_1): Likewise.
	(check_subexp_matching_top): Likewise.
	* posix/regcomp.c (optimize_subexps, lower_subexp):
	Use CHAR_BIT rather than 8, for clarity.
	* posix/regexec.c (check_dst_limits_calc_pos_1):
	(check_subexp_matching_top): Likewise.
	* posix/regcomp.c (init_dfa): Make table_size unsigned, so that we
	don't have to worry about portability issues when shifting it left.
	Remove no-longer-needed test for table_size > 0.
	* posix/regcomp.c (parse_sub_exp): Do not shift more bits than there
	are in a word, as the resulting behavior is undefined.
	* posix/regexec.c (check_dst_limits_calc_pos_1): Likewise;
	in one case, a <= should have been an <, and in another case the
	whole test was missing.
	* posix/regex_internal.h (BYTE_BITS): Remove.  All uses changed to
	the standard name CHAR_BIT.

	* posix/regex_internal.h (re_sub_match_top_t): Remove unused member
	next_last_offset.
	(struct re_dfa_t): Remove unused member states_alloc.
	* posix/regcomp.c (init_dfa): Don't initialize unused members.

2005-08-25  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regexec.c (set_regs): Don't alloca with an unbounded size.

	alloca modernization/simplification for regex.
	* posix/regex.c: Remove portability cruft for alloca.  This no longer
	needs to be at the start of the file, and can be moved into
	regex_internal.h and simplified.
	* posix/regex_internal.h: Include <alloca.h>.
	(__libc_use_alloca) [!defined _LIBC]: New macro.
	* posix/regexec.c (build_trtable): Remove "#ifdef _LIBC",
	since the code now works outside glibc.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* include/regex.h: Remove use of _RE_ARGS.

2005-08-25  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regexec.c (find_recover_state): Change "err" to "*err".

2005-08-24  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regcomp.c (regerror): Pointer args are 'restrict',
	as per POSIX.
	* posix/regex.h (regerror): Likewise.
	* manual/pattern.texi (POSIX Regexp Compilation): Likewise.
	Similarly for regcomp and regexec.  Also, first 2 args of regexec
	and 2nd arg of regerror are const.

	* posix/regex.c: Do not include <sys/types.h>, as POSIX no longer
	requires this.  (The code never needed it.)

2005-08-20  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regexec.c (sift_states_bkref): re_node_set_insert returns
	int, not reg_errcode_t.

	* posix/regex_internal.c (calc_state_hash): Put 'inline' before type,
	since some broken compilers warn about it otherwise.

	* posix/regcomp.c (create_initial_state): Remove duplicate decl.

2005-08-20  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regex.h (_RE_ARGS): Remove.  No longer needed, since we assume
	C89 or better.  All uses removed.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex.c: Prevent using C++ compilers.

2005-08-19  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regcomp.c (duplicate_node): Return new index, not an error
	code, and let the caller return REG_ESPACE if out of space.  This
	removes an uninitialied-variable warning with GCC 4.0.1, and also
	avoids taking the address of a local variable.  All callers
	changed.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* include/time.h (__strptime_internal): Rename parameter to avoid
	bogus compiler warning.

2005-08-19  Jim Meyering  <jim@meyering.net>

	* posix/regexec.c (proceed_next_node): Redo local variables to
	avoid GCC shadowing warnings.

2005-09-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex_internal.c (re_acquire_state): Minor code rearrangement.
	(re_acquire_state_context): Likewise.

2005-08-19  Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regex_internal.c (re_string_realloc_buffers):
	(re_node_set_insert, re_node_set_insert_last, re_dfa_add_node):
	Rename local variables to avoid GCC shadowing warnings.

2005-07-08  Eric Blake  <ebb9@byu.net>
            Paul Eggert  <eggert@cs.ucla.edu>

	* posix/regcomp.c (init_dfa): Store __btowc value in wint_t, not
	wchar_t.  Remove now-unnecessary cast.
	(build_range_exp): Likewise.

2005-08-31  Bob Wilson  <bob.wilson@acm.org>

	* sysdeps/ieee754/flt-32/e_hypotf.c (__ieee754_hypotf):  Remove the
	exponent bias from the increment value for scaling by 2^60.

2005-09-05  Alexandre Oliva  <aoliva@redhat.com>

	* configure.in: Compile source test file with -fPIC for -shared.

2005-09-04  Ulrich Drepper  <drepper@redhat.com>

	* iconv/skeleton.c: Eliminate DEFINE_DIRECTION_OBJECTS macro use,
	it wasn't used.  Remove use of from_object and to_object variable,
	replace with some constants.  Adjust users.

	* sysdeps/i386/bits/string.h: Removed.

	* stdio-common/Makefile (tests): Add tst-put-error.
	* stdio-common/tst-put-error.c: New file.
	* libio/fileops.c (_IO_new_file_xsputn): If overflow fails and no more
	data would have to be written signal error.
	* libio/oldfileops.c (_IO_old_file_xsputn): Likewise.

	* libio/fileops.c (_IO_new_file_overflow): Use NULL not 0.

2005-09-02  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): No need to change
	protection of memory used for the last segment.

2005-08-22  Robert Millan  <robertmh@gnu.org>

	* sysdeps/mach/hurd/nfs/nfs.h: Move to ...
	* sysdeps/generic/nfs/nfs.h: ... here.

2005-09-01  Ulrich Drepper  <drepper@redhat.com>

	* libio/stdio.h: Remove __wur from ungetc, sscanf, and vsscanf.
	Add __wur to feof{,_unlocked}, ferror{,_unlocked},
	fileno{,_unlocked}, and popen.

2005-08-30  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/ieee754/flt-32/e_hypotf.c [!__STDC__]: Fix function name.

2005-08-01  Bob Wilson  <bob.wilson@acm.org>
	    Richard Sandiford  <richard@codesourcery.com>

	* sysdeps/ieee754/flt-32/e_hypotf.c (__ieee754_hypotf): Add missing
	exponent bias to the value for 2^126.

2005-08-30  Jakub Jelinek  <jakub@redhat.com>
	    Alan Modra  <amodra@bigpond.net.au>

	* elf/dl-addr.c (_dl_addr): Use DL_ADDR_SYM_MATCH macro.
	* sysdeps/generic/ldsodefs.h (DL_ADDR_SYM_MATCH): Define.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/ldsodefs.h: New file.

2005-08-23  Ulrich Drepper  <drepper@redhat.com>

	* nscd/nscd.c (main): Use error while process isn't running in the
	background, not dbg_log.
	* nscd/nscd_conf.c (nscd_parse_file): Likewise.
	Mark messages with _().  Unify testing for database name.

	* nscd/connection.c (DEFAULT_DATASIZE_PER_BUCKET): Move to nscd.h.
	(dbs): Initialize max_db_size fields.
	(nscd_init): When mapping the database, use max_db_size as the
	mapping size even if it is bigger than the file size.
	* nscd/mem.c (mempool_alloc): When resizing the file make sure the
	limit in max_db_size is not exceeded.  Don't use mremap, just
	posix_fallocate is enough (according to Linus).  Use posix_fallocate
	correctly.
	* nscd/nscd.conf: Add max-db-size parameters.
	* nscd/nscd.h (struct database_dyn): Add max_db_size field.
	Define DEFAULT_MAX_DB_SIZE and DEFAULT_DATASIZE_PER_BUCKET.
	Temporarily define TEMP_FAILURE_RETRY_VAL here.
	* nscd/nscd_conf.c (nscd_parse_file): Parse max-db-size parameter
	and add sanity checks for it.

	* nscd/aicache.c (addhstaiX): Use send with MSG_NOSIGNAL not write to
	send reply.
	* nscd/connection.c (writeall): Likewise.
	(handle_request): Likewise.
	* nscd/grpcache.c (cache_addgr): Likewise.
	* nscd/hstcache.c (cache_addhst): Likewise.
	* nscd/initgrcache.c (addinitgroupsX): Likewise.
	* nscd/nscd.c (parse_opt): Likewise.
	* nscd/nscd_stat.c (send_stats): Likewise.
	(receive_print_stats): Likewise.
	* nscd/pwdcache.c (cache_addpw): Likewise.

	* sysdeps/unix/sysv/linux/Versions: Export inotify_* syscalls.

2005-08-22  Jakub Jelinek  <jakub@redhat.com>

	* stdlib/bits/stdlib.h (mbstowcs): Divide __bos (__dst) by
	sizeof (wchar_t) rather than multiplying __len by sizeof (wchar_t).
	Pass __bos (__dst) / sizeof (wchar_t) to the *_chk routine.
	* wcsmbs/bits/wchar2.h (mbsrtowcs, mbsnrtowcs): Likewise.
	* debug/mbsnrtowcs_chk.c (__mbsnrtowcs_chk): Don't multiply
	len by sizeof (wchar_t).
	* debug/mbsrtowcs_chk.c (__mbsrtowcs_chk): Likewise.
	* debug/mbstowcs_chk.c (__mbstowcs_chk): Likewise.
	Fix type of SRC argument.  Pass &SRC rather than SRC to
	__mbsrtowcs.
	* debug/wcstombs_chk.c (__wcstombs_chk): Pass &SRC rather than SRC
	to __wcsrtombs.
	* debug/tst-chk1.c: Include assert.h.
	(do_test): Change enough array from VLA into a fixed size array.
	Assert that MB_CUR_MAX is <= sizeof (enough).  Use FAIL () macro
	instead of print error details.  Add several new tests.
	Kill some unused variable warnings.

2005-08-21  Ulrich Drepper  <drepper@redhat.com>

	* resolv/res_send.c (Aerror): Fix printing IP address.

	* resolv/res_send.c (send_vc): Pass correct sockaddr size to connect.

2005-08-19  H.J. Lu  <hongjiu.lu@intel.com>

	* sysdeps/ia64/fpu/libm_error.c (__libm_error_support): Don't abort.

2005-08-17  Robert Love  <rml@novell.com>

	* sysdeps/unix/sysv/linux/sys/inotify.h: Add IN_MOVE_SELF event.

2005-08-19  Bruno Haible  <bruno@clisp.org>

	* intl/localealias.c (read_alias_file): In case of failure, close the
	file descriptor and sort the array before returning.

2005-08-19  Ulrich Drepper  <drepper@redhat.com>

	* malloc/Makefile: Link libmemusage.so with ld.so.
	* malloc/memusage.c: Use atomic operations for all counter and size
	 computations.  Handle thread stacks.
	* sysdeps/generic/memusage.h: Define memusage_cntr_t and
	memusage_size_t.
	* sysdeps/i386/i686/memusage.h: New file.
	* include/atomic.h: Define atomic_max and atomic_min.

	* debug/tst-chk1.c: Add tests for mbstowcs and wcstombs.

2005-08-17  Paul Eggert  <eggert@cs.ucla.edu>

	[BZ #1207]
	* posix/regex.h: Remove spurious space-before-tab.  From gnulib.

2005-08-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/Makefile (sysdep_headers): Add
	sys/inotify.h.
	* sysdeps/unix/sysv/linux/sys/inotify.h: New file.
	* sysdeps/unix/sysv/linux/syscalls.list: Add inotify syscalls.

	* nscd/cache.c (prune_cache): Add more debug output.  Only for
	debug level 3 and higher and very verbose.

	* nscd/cache.c (prune_cache): Use stat64 not stat.
	* nscd/connections.c (nscd_init): Likewise.

2005-08-10  Sergio Gelato  <Sergio.Gelato@astro.su.se>

	[BZ #1188]
	* nis/nss_nis/nis-netgrp.c (_nss_nis_setnetgrent): Change assert check
	from (len > 0) to (len >= 0).

2005-08-16  Ulrich Drepper  <drepper@redhat.com>

	* nis/nis_xdr.c (_xdr_nis_result): Fix type of res variable.
	Reported by Thomas Schwinge.

2005-08-15  Jakub Jelinek  <jakub@redhat.com>

	* nis/nis_subr.c (nis_leaf_of_r): Handle buflen == 0 correctly.

2005-08-16  Ulrich Drepper  <drepper@redhat.com>

	* nss/getent.c (more_help): Use open_memstream instead of handling
	memory allocation ourselves.

2005-08-16  Jay Fenlason  <fenlason@redhat.com>

	* nss/getent.c (parse_options): change the -s option to support
	{database}:{search} to override /etc/resolv.conf for only the
	specified database.

2005-08-08  Ulrich Drepper  <drepper@redhat.com>

	* nscd/connections.c (main_loop_epoll): Pass NULL as event
	argument for epoll_ctl(EPOLL_CTL_DEL) calls.

	* nscd/nscd_stat.c (receive_print_stats): Really print values of
	thread number, paranoia, and restart interval the server is using.

	* argp/argp-help.c: Use _IO_vasprintf instead of vasprintf.
	* include/stdio.h: Add libc_hidden_proto for __vfprintf_chk.
	* debug/vfprintf_chk.c: Add libc_hidden_def.

2005-08-08  Roland McGrath  <roland@redhat.com>

	* argp/argp-help.c (__argp_error): __asprintf -> vasprintf.
	(__argp_failure): Likewise.

2005-08-08  Ulrich Drepper  <drepper@redhat.com>

	* nscd/cache.c (cache_add): Commit hash table and header to disk.

	* nscd/mem.c (mempool_alloc): Use posix_fallocate instead of ftruncate.
	* nscd/connections.c (nscd_init): Likewise.

2005-08-08  Jakub Jelinek  <jakub@redhat.com>

	* stdio-common/fxprintf.c: Include libioP.h.

	* posix/bits/unistd.h (confstr, getgroups, ttyname_r, gethostname,
	getdomainname): Add __NTH.
	* stdlib/bits/stdlib.h (ptsname_r, wctomb, mbstowcs, wcstombs):
	Likewise.
	(realpath): Likewise.  Use __const instead of const.  Add __restrict
	keywords.
	* socket/bits/socket2.h (recvfrom): Add __restrict keyword to __buf.
	* wcsmbs/bits/wchar2.h (wmemcpy, wmemmove, wmempcpy, wmemset,
	wcscpy, wcpcpy, wcsncpy, wcpncpy, wcscat, wcsncat, vswprintf, wcrtomb,
	mbsrtowcs, wcsrtombs, mbsnrtowcs, wcsnrtombs): Add __NTH.
	* string/bits/string3.h (__memset_ichk): Likewise.
	(__memcpy_ichk, __memmove_ichk, __mempcpy_ichk, __strcpy_ichk,
	__stpcpy_ichk, __strncpy_ichk, stpncpy, __strcat_ichk,
	__strncat_ichk): Likewise.  Use __const instead of const.
	(__stpncpy_chk): Use __const instead of const.
	(__stpncpy_alias): Use __REDIRECT_NTH instead of __REDIRECT.

2005-08-08  Ulrich Drepper  <drepper@redhat.com>
	    Jakub Jelinek  <jakub@redhat.com>

	* nscd/mem.c (BLOCK_ALIGN_LOG, BLOCK_ALIGN, BLOCK_ALIGN_M1): Move
	definitions to...
	* nscd/nscd.h (BLOCK_ALIGN_LOG, BLOCK_ALIGN, BLOCK_ALIGN_M1): ...here.
	* nscd/connections.c (usekey): New enum.
	(check_use, verify_persistent_db): New functions.
	(nscd_init): If persistent database is corrupted, unlink it and
	recreate rather than falling back to non-persistent database.
	Call verify_persistent_db.  Avoid overflows in total computation.

2005-08-08  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/utf-16.c (PREPARE_LOOP): Minor cleanups to make code
	better readable.  Avoid passing var to loop function, it's not
	necessary at all.

2005-08-07  Ulrich Drepper  <drepper@redhat.com>

	* elf/elf.h (DT_ALPHA_PLTRO): Use symbolic name in DT_ALPHA_PLTRO
	definition.

2005-08-05  Ulrich Drepper  <drepper@redhat.com>

	* timezone/checktab.awk: Update from tzcode2005k.
	* timezone/private.h: Likewise.
	* timezone/scheck.c: Likewise.
	* timezone/tzselect.ksh: Likewise.
	* timezone/zdump.c: Likewise.
	* timezone/zic.c: Likewise.
	* timezone/africa: Update from tzdata2005k.
	* timezone/antarctica: Likewise.
	* timezone/asia: Likewise.
	* timezone/australasia: Likewise.
	* timezone/europe: Likewise.
	* timezone/iso3166.tab: Likewise.
	* timezone/leapseconds: Likewise.
	* timezone/northamerica: Likewise.
	* timezone/solar87: Likewise.
	* timezone/solar88: Likewise.
	* timezone/solar89: Likewise.
	* timezone/southamerica: Likewise.
	* timezone/zone.tab: Likewise.

2005-08-05  Roland McGrath  <roland@frob.com>

	[BZ #1251]
	* mach/shortcut.awk: Ignore `weak_alias' lines.
	Reported by Alfred M. Szmidt <ams@gnu.org>.

	[BZ #1250]
	* sysdeps/mach/hurd/mig-reply.c (reply_port): Don't use ?: as lvalue.
	Reported by Alfred M. Szmidt <ams@gnu.org>.

2005-08-03  Dwayne Grant McConnell  <dgm69@us.ibm.com>

	* sysdeps/powerpc/powerpc32/Makefile (CFLAGS-initfini.s):
	Use +=, not =, to append.  Remove duplicate flags.
	* sysdeps/powerpc/powerpc64/Makefile (CFLAGS-initfini.s):
	Likewise.  Fix comments.

2005-08-01  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/sigwait.c (do_sigwait): Restart system
	call if it returned EINTR.

2005-07-31  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/x86_64/dl-machine.h (elf_machine_load_address): Move
	helper variable into .data.rel.ro.  Simplify the code.  Extend
	comment to explain prelinking.

2005-07-31  Andreas Jaeger  <aj@suse.de>

	* include/bits/syslog.h: New file.

2005-07-30  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c [__WORDSIZE==64] (FILEBUF_SIZE): Adjust the value
	up.  We have more program header entries now and the note section
	was normally not loaded.

	* nis/nis_subr.c: Some minor code cleanups.

2005-07-29  Ulrich Drepper  <drepper@redhat.com>

	* misc/bits/syslog.h: New file.
	* misc/sys/syslog.h: Include <bits/syslog.h> for fortification.
	* misc/Makefile (headers): Add bits/syslog.h.
	* include/sys/syslog.h: Add __vsyslog_chk prototype and hidden_proto.
	* sysdeps/generic/syslog.c: Change vsyslog function to __vsyslog_chk.
	Call __vfprintf_chk if necessary.  Make vsyslog a wrapper.  Add
	__syslog_chk.
	* misc/Versions: Export __syslog_chk and __vsyslog_chk.

2005-07-28  Thomas Schwinge  <schwinge@nic-nac-project.de>

	[BZ #1137]
	* misc/error.c [_LIBC]: Include <stdbool.h> and <stdint.h>.

2005-07-28  Ulrich Drepper  <drepper@redhat.com>

	* nis/nis_xdr.c: Help gcc to avoid generating unnecessary wrapper
	functions.

2005-07-28  Jakub Jelinek  <jakub@redhat.com>

	* stdio-common/fxprintf.c (__fxprintf): Add INTUSE to _IO_vfprintf
	call.
	* gmon/gmon.c (write_gmon): Use __snprintf rather than snprintf.

2005-07-28  Ulrich Drepper  <drepper@redhat.com>

	* nis/nis_file.c: Rewrite the two pairs of functions into wrappers
	around a pair of new, generalized functions.  22% size reduction.

2005-07-27  Ulrich Drepper  <drepper@redhat.com>

	* nis/nis_xdr.c: Remove unnecessary cast which might hide bugs.
	Rearrange code.  This reduces the code size 10%.

2005-07-26  Jakub Jelinek  <jakub@redhat.com>

	* misc/error.c (error_tail): Fix a comment typo.

2005-07-25  Ulrich Drepper  <drepper@redhat.com>

	* po/zh_TW.po: Update from translation team.

	* debug/mbstowcs_chk.c: New file.
	* debug/wcstombs_chk.c: New file.
	* debug/Makefile (routines): Add mbstowcs_chk and wcstombs_chk.
	* debug/Versions: Add __mbstowcs_chk and __wcstombs_chk.
	* stdlib/bits/stdlib.h: Add definitions for mbstowcs and wcstombs.

	* wcsmbs/bits/wchar2.h (mbsrtowcs): Pretty printing.

2005-07-24  Ulrich Drepper  <drepper@redhat.com>

	* string/test-memset.c (test_main): Use negative byte value in
	test.

	* string/test-memset.c (do_one_test): Compare effect of call, not
	only return value.
	Add a few casts to avoid warnings.

2005-07-24  SUGIOKA Toshinobu  <sugioka@itonet.co.jp>

	* sysdeps/sh/memset.S (memset): Correct 2nd argument handling.

2005-07-24  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1125]
	* posix/Makefile (tests): Add tst-execvp4.
	* posix/tst-execvp4.c: New file.

2005-07-24  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1125]
	* posix/execvp.c (execvp): Change path_malloc to
	char *, free that pointer on failure.

2005-07-24  Ulrich Drepper  <drepper@redhat.com>

	* wcsmbs/bits/wchar2.h: Use __FILE not FILE.
	* wcsmbs/Makefile: Add rules to build and run tst-wchar-h.
	* wcsmbs/tst-wchar-h.c: New file.

2005-07-22  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/fxprintf.c (__fxprintf): Define variable more local.

2005-07-22  Jakub Jelinek  <jakub@redhat.com>

	* wcsmbs/bits/wchar2.h (__vfwprintf_chk, __vwprintf_chk): Use
	__gnuc_va_list rather than _G_va_list.

2005-07-22  Roland McGrath  <roland@redhat.com>

	[BZ #869]
	* Makerules ($(objpfx)stubs): Fix last change.

2005-07-21  Roland McGrath  <roland@redhat.com>

	* nscd/Makefile ($(objpfx)nscd): Pass $(nscd-cflags) to $(LINK.o).

	* stdlib/Makefile (headers): Move bits/wchar.h to ...
	* wcsmbs/Makefile (headers): ... here.  Add bits/wchar2.h too.

2005-07-21  Jakub Jelinek  <jakub@redhat.com>

	* wcsmbs/bits/wchar2.h (swprintf): Remove format argument.
	* debug/tst-chk1.c (do_test): Add test for swprintf with format
	being the last argument.

2005-07-21  Thorsten Kukuk  <kukuk@suse.de>

	* debug/getgroups_chk.c (__getgroups_chk): Fix return value.

	* stdio-common/fxprintf.c: Include string.h.

2005-07-20  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1138]
	* sysdeps/x86_64/fpu/libm-test-ulps: Adjust expected atan2f results.
	* sysdeps/powerpc/fpu/libm-test-ulps: Likewise.
	* sysdeps/s390/fpu/libm-test-ulps: Likewise.

2005-07-20  Bob Wilson  <bob.wilson@acm.org>
            Darin Petkov  <darin@tensilica.com>

	[BZ #1138]
	* sysdeps/ieee754/flt-32/e_atan2f.c (pi_lo): Correct exponent value.

2005-07-20  Jakub Jelinek  <jakub@redhat.com>

	* include/stdio.h (__fxprintf): Remove wfmt argument.
	* stdio-common/fxprintf.c: Include assert.h, ctype.h and wchar.h.
	(__fxprintf): Remove wfmt argument, create wfmt format string on
	the fly from fmt.
	* argp/argp-fmtstream.c: Adjust all __fxprintf callers.
	* argp/argp-help.c: Likewise.
	* assert/assert-perr.c: Likewise.
	* assert/assert.c: Likewise.
	* gmon/gmon.c: Likewise.
	* inet/rcmd.c: Likewise.
	* malloc/obstack.c: Likewise.
	* misc/error.c: Likewise.
	* misc/getpass.c: Likewise.
	* posix/getopt.c: Likewise.
	* resolv/res_hconf.c: Likewise.
	* stdio-common/perror.c: Likewise.
	* stdio-common/psignal.c: Likewise.
	* stdlib/fmtmsg.c: Likewise.
	* sunrpc/auth_unix.c: Likewise.
	* sunrpc/clnt_perr.c: Likewise.
	* sunrpc/clnt_tcp.c: Likewise.
	* sunrpc/clnt_udp.c: Likewise.
	* sunrpc/clnt_unix.c: Likewise.
	* sunrpc/svc_simple.c: Likewise.
	* sunrpc/svc_tcp.c: Likewise.
	* sunrpc/svc_udp.c: Likewise.
	* sunrpc/svc_unix.c: Likewise.
	* sunrpc/xdr.c: Likewise.
	* sunrpc/xdr_array.c: Likewise.
	* sunrpc/xdr_rec.c: Likewise.
	* sunrpc/xdr_ref.c: Likewise.
	* sysdeps/generic/wordexp.c: Likewise.

2005-07-20  Ulrich Drepper  <drepper@redhat.com>

	* wcsmbs/bits/wchar2.h: Add definitions for wcrtomb, mbsrtowcs,
	wcsrtombs, mbsnrtowcs, and wcsnrtombs.
	* debug/Makefile (routines): Add wcrtomb_chk, mbsrtowcs_chk,
	wcsrtombs_chk, mbsnrtowcs_chk, and wcsnrtombs_chk.
	* debug/Versions: Add __wcrtomb_chk, __mbsrtowcs_chk,
	__wcsrtombs_chk, __mbsnrtowcs_chk, and __wcsnrtombs_chk.
	* debug/tst-chk1.c: Add tests for new functions.
	* debug/mbsnrtowcs_chk.c: New file.
	* debug/mbsrtowcs_chk.c: New file.
	* debug/wcrtomb_chk.c: New file.
	* debug/wcsnrtombs_chk.c: New file.
	* debug/wcsrtombs_chk.c: New file.

2005-07-19  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/Makefile (aux): Add fxprintf.
	* stdio-common/fxprintf.c: New file.
	* include/stdio.h: Add declaration for __fxprintf.
	* argp/argp-fmtstream.c: Use __fxprintf instead of inline stream
	orientation test and two separate function calls.
	* argp/argp-help.c: Likewise.
	* assert/assert-perr.c: Likewise.
	* assert/assert.c: Likewise.
	* gmon/gmon.c: Likewise.
	* inet/rcmd.c: Likewise.
	* malloc/obstack.c: Likewise.
	* misc/error.c: Likewise.
	* misc/getpass.c: Likewise.
	* posix/getopt.c: Likewise.
	* resolv/res_hconf.c: Likewise.
	* stdio-common/perror.c: Likewise.
	* stdio-common/psignal.c: Likewise.
	* stdlib/fmtmsg.c: Likewise.
	* sunrpc/auth_unix.c: Likewise.
	* sunrpc/clnt_perr.c: Likewise.
	* sunrpc/clnt_tcp.c: Likewise.
	* sunrpc/clnt_udp.c: Likewise.
	* sunrpc/clnt_unix.c: Likewise.
	* sunrpc/svc_simple.c: Likewise.
	* sunrpc/svc_tcp.c: Likewise.
	* sunrpc/svc_udp.c: Likewise.
	* sunrpc/svc_unix.c: Likewise.
	* sunrpc/xdr.c: Likewise.
	* sunrpc/xdr_array.c: Likewise.
	* sunrpc/xdr_rec.c: Likewise.
	* sunrpc/xdr_ref.c: Likewise.
	* sysdeps/generic/wordexp.c: Likewise.

	[BZ #1137]
	* misc/Makefile: Add rules to build and run tst-error1.
	* misc/tst-error1.c: New file.
	* misc/error.c: Fix memory leak and possibly endless loop.

	* configure.in: Check for -fstack-protector gcc option.
	* config.make.in (have-ssp): Add template.
	* nscd/Makefile (nscd-cflags): Add -fstack-protector if supported.

	* nscd/nscd.c (main): Don't ignore result of chdir call.

2005-07-18  Roland McGrath  <roland@redhat.com>

	[BZ #869]
	* Makerules ($(objpfx)stubs): Do cd into $(objdir) to reduce size of
	objdump command line.

2005-07-18  Ulrich Drepper  <drepper@redhat.com>

	* nscd/Makefile (nscd-cflags): Add _FORTIFY_SOURCE.

	* nscd/connections.c: Fix a few wur warnings.

	[BZ #1113]
	* nscd/grpcache.c (cache_addgr): Use correct maximum for group ID
	length.  Patch by Ivan Gyurdiev <ivg2@cornell.edu>.

	* debug/confstr_chk.c: New file.
	* debug/getdomainname_chk.c: New file.
	* debug/getgroups_chk.c: New file.
	* debug/gethostname_chk.c: New file.
	* debug/getlogin_r_chk.c: New file.
	* debug/ttyname_r_chk.c: New file.
	* posix/bits/unistd.h: Add definitions for new debug versions.
	* debug/tst-chk1.c: Add tests for new functions.
	* debug/Versions: Export new functions.
	* debug/Makefile (routines): Add new files.

	* stdlib/bits/stdlib.h: Fix typo.

2005-07-13  Thorsten Kukuk  <kukuk@suse.de>

	* manual/Makefile (libc/index.html): Depend on dir-add.texi.

2005-07-15  Ulrich Drepper  <drepper@redhat.com>

	* stdlib/bits/stdlib.h: Use __REDIRECT_NTH instead of __REDIRECT
	where necessary.
	* wcsmbs/bits/wchar2.h: Likewise.

2005-07-15  Andreas Jaeger  <aj@suse.de>

	* debug/Makefile (tst-lfschk3-ENV): New, set locale.
	(tst-lfschk2-ENV): New.
	(tst-lfschk1-ENV): New.
	(tst-chk3-ENV): New.
	(tst-chk2-ENV): New.
	(tst-chk1-ENV): New.

	[BZ #1079]
	* include/stdlib.h: Remove malloc attribute from __posix_memalign.
	* stdlib/stdlib.h: Likewise.

2005-07-15  Ulrich Drepper  <drepper@redhat.com>

	* wcsmbs/bits/wchar2.h: New file.
	* include/bits/wchar2.h: New file.
	* wcsmbs/wchar.h: Include <bits/wchar2.h> if fortification is
	requested.
	* wcsmbs/wcsncpy.c: Add __wcsncpy alias.
	* string/bits/string3.h: Add fortified stpncpy definitions.
	* sysdeps/generic/stpncpy_chk.c: New file.
	* libio/vswprintf.c: Move _IO_wstrnfile definition to strfile.h.
	Export _IO_wstrn_jumps.
	* libio/strfile.h: Define _IO_wstrnfile and declare _IO_wstrn_jumps.
	* include/wchar.h: Declare __wcsncpy and __vswprintf_chk.
	* debug/fgetws_chk.c: New file.
	* debug/fgetws_u_chk.c: New file.
	* debug/fwprintf_chk.c: New file.
	* debug/swprintf_chk.c: New file.
	* debug/vfwprintf_chk.c: New file.
	* debug/vswprintf_chk.c: New file.
	* debug/vwprintf_chk.c: New file.
	* debug/wcpcpy_chk.c: New file.
	* debug/wcpncpy_chk.c: New file.
	* debug/wcscat_chk.c: New file.
	* debug/wcscpy_chk.c: New file.
	* debug/wcsncat_chk.c: New file.
	* debug/wcsncpy_chk.c: New file.
	* debug/wmemcpy_chk.c: New file.
	* debug/wmemmove_chk.c: New file.
	* debug/wmempcpy_chk.c: New file.
	* debug/wmemset_chk.c: New file.
	* debug/wprintf_chk.c: New file.
	* debug/tst-chk1.c: Add tests for new functions.
	* debug/Versions: Export new functions.
	* debug/Makefile (routines): Add new functions.

2005-07-13  Ulrich Drepper  <drepper@redhat.com>

	* nscd/nscd_helper.c: Add a few __builtin_expect.

	[BZ #1080]
	* nscd/connections.c (send_ro_fd): Make sure BUF is aligned correctly.
	* nscd/nscd_helper.c (wait_on_socket): New function.
	(get_mapping): Use wait_on_socket instead of poll.  The former handles
	EINTR of poll correctly.
	(__nscd_open_socket): Likewise.
	(get_mapping): Make sure BUF is aligned correctly.
	(get_mapping): Use munmap on correct pointer.

2005-07-12  Ulrich Drepper  <drepper@redhat.com>

	* include/libc-symbols.h: Define macros for librt hidden symbols.
	* include/time.h: Add librt_hidden_proto definition for clock_gettime.
	* sysdeps/generic/clock_gettime.c: Add librt_hidden_def.
	* sysdeps/unix/clock_gettime.c: Likewise.

	* stdlib/bits/stdlib.h: New file.
	* stdlib/stdlib.h: Include <bits/stdlib.h> if fortification is
	requested.
	* Makefile (headers): Add bits/stdlib.h.
	* include/bits/stdlib.h: New file.
	* debug/Depend: New file.
	* debug/ptsname_r_chk.c: New file.
	* debug/realpath_chk.c: New file.
	* debug/wctomb_chk.c: New file.
	* debug/Makefile (routines): Add ptsname_r_chk, realpath_chk, and
	wctomb_chk.
	* debug/Versions: Export __ptsname_r_chk, __realpath_chk, and
	__wctomb_chk.
	* debug/tst-chk1.c: Add tests for __ptsname_r_chk, __realpath_chk, and
	__wctomb_chk.

2005-07-12  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1106]
	* sysdeps/unix/sysv/linux/ia64/has_cpuclock.c: Include not-cancel.h.
	(has_cpuclock): Use open_not_cancel_2 instead of open, read_not_cancel
	instead of read and close_not_cancel_no_status instead of close.

	[BZ #1106]
	* sysdeps/s390/s390-64/bcopy.S (__bcopy): Use
	HIDDEN_BUILTIN_JUMPTARGET to jump to memmove.

2005-06-27  Carlos O'Donell  <carlos@systemhalted.org>

	* posix/regcomp.c (re_compile_internal): Call __libc_lock_init
	after init_dfa.

2005-07-08  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/x86_64/fpu/s_sincosl.S: Use retq not ret.  Remove
	alignment.
	* sysdeps/x86_64/fpu/s_sincos.S: New file.

	* include/fenv.h: Add libm_hidden_proto for fesetround and
	feholdexcept.
	* sysdeps/alpha/fpu/feholdexcpt.c: Add libm_hidden_def.
	* sysdeps/alpha/fpu/fesetround.c: Likewise.
	* sysdeps/generic/feholdexcpt.c: Likewise.
	* sysdeps/generic/fesetround.c: Likewise.
	* sysdeps/i386/fpu/feholdexcpt.c: Likewise.
	* sysdeps/i386/fpu/fesetround.c: Likewise.
	* sysdeps/ia64/fpu/feholdexcpt.c: Likewise.
	* sysdeps/ia64/fpu/fesetround.c: Likewise.
	* sysdeps/powerpc/fpu/feholdexcpt.c: Likewise.
	* sysdeps/powerpc/fpu/fesetround.c: Likewise.
	* sysdeps/s390/fpu/feholdexcpt.c: Likewise.
	* sysdeps/s390/fpu/fesetround.c: Likewise.
	* sysdeps/sh/sh4/fpu/feholdexcpt.c: Likewise.
	* sysdeps/sh/sh4/fpu/fesetround.c: Likewise.
	* sysdeps/sparc/fpu/feholdexcpt.c: Likewise.
	* sysdeps/sparc/fpu/fesetround.c: Likewise.
	* sysdeps/x86_64/fpu/feholdexcpt.c: Likewise.
	* sysdeps/x86_64/fpu/fesetround.c: Likewise.
	* sysdeps/generic/s_significand.c (__significand): Use __ilogb not
	ilogb.
	* sysdeps/generic/s_significandf.c (__significandf): Use __ilogbf
	not ilogbf.
	* sysdeps/ieee754/dbl-64/s_sincos.c (__sincos): Use __sin and
	__cos, not sin and cos.

2005-07-07  Ulrich Drepper  <drepper@redhat.com>

	* resolv/res_send.c (send_dg): Recognize referral results and
	treat them as server errors.
	Based on a patch by Jason Vas Dias <jvdias@redhat.com>.

2005-07-08  Carlos O'Donell  <carlos@systemhalted.org>

	* sysdeps/hppa/setjmp.S (__sigsetjmp): Use %r1 not %r19.

	* sysdeps/hppa/add_n.s (__mpn_add_n): Use sr0 or r0, not 0.
	* sysdeps/hppa/lshift.s (__mpn_lshift): Likewise.
	* sysdeps/hppa/rshift.s (__mpn_rshift): Likewise.
	* sysdeps/hppa/sub_n.s (__mpn_sub_n): Likewise.
	* sysdeps/hppa/udiv_qrnnd.s (__udiv_qrnnd): Likewise.
	* sysdeps/hppa/hppa1.1/udiv_qrnnd.s (__udiv_qrnnd): Likewise.

2005-07-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/s_ctanh.c (__ctanh): Handle case of zero den better.
	* sysdeps/generic/s_ctanhf.c (__ctanhf): Likewise.
	* sysdeps/generic/s_ctanhl.c (__ctanhl): Likewise.
	* sysdeps/generic/s_ctan.c (__ctan): Likewise.
	* sysdeps/generic/s_ctanf.c (__ctanf): Likewise.
	* sysdeps/generic/s_ctanl.c (__ctanl): Likewise.

2005-04-13  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #974]
	* csu/elf-init.c (__preinit_array_start): Take int, char **, char **.
	(__preinit_array_end): Likewise.
	(__init_array_start): Likewise.
	(__init_array_end): Likewise.
	(__libc_csu_init): Take int argc, char **argv, char **envp.
	Call preinit_array and init_array with argc, argv, envp.
	* sysdeps/generic/libc-start.c (LIBC_START_MAIN): Remove
	INIT_MAIN_ARGS.
	* sysdeps/powerpc/elf/libc-start.c (INIT_MAIN_ARGS): Removed.
	* elf/Makefile (distribute): Add tst-array5.c, tst-array5-static.c,
	tst-array5dep.c, and tst-array5.exp.
	(tests): Add tst-array5.
	(tests-static): Add tst-array5-static.
	($(objpfx)tst-array5): New target.
	($(objpfx)tst-array5.out): Likewise.
	($(objpfx)tst-array5-static.out): Likewise.
	* elf/tst-array5-static.c: New file.
	* elf/tst-array5-static.exp: Likewise.
	* elf/tst-array5.c: Likewise.
	* elf/tst-array5.exp: Likewise.
	* elf/tst-array5dep.c: Likewise.

2005-07-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/bits/sched.h: Adjust clone prototype.

2005-07-05  Jakub Jelinek  <jakub@redhat.com>

	* elf/stackguard-macros.h (STACK_CHK_GUARD): Fix s390/s390x definition.
	Reported by Ulrich Weigand <uweigand@de.ibm.com>.

	* elf/stackguard-macros.h (STACK_CHK_GUARD): Add ia64 definition.

2005-07-06  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-error.c (_dl_signal_error): When testing for executable
	being relocated, take into account that nothing might even be loaded.

	* elf/dl-reloc.c [PROF] (_dl_relocate_object): Define
	consider_profiling always to zero.  Don't count of compiler to
	remove unreached if block.
	* sysdeps/x86_64/dl-trampoline.S [PROF] (_dl_runtime_profile):
	Don't compile.
	* sysdeps/i386/dl-trampoline.S [PROF] (_dl_runtime_profile): Likewise.
	* sysdeps/ia64/dl-trampoline.S [PROF] (_dl_runtime_profile): Likewise.
	* sysdeps/s390/s390-64/dl-trampoline.S [PROF] (_dl_runtime_profile):
	Likewise.
	* sysdeps/s390/s390-32/dl-trampoline.S [PROF] (_dl_runtime_profile):
	Likewise.
	* sysdeps/powerpc/powerpc64/dl-trampoline.S [PROF]
	(_dl_profile_resolve): Likewise.
	* sysdeps/powerpc/powerpc32/dl-trampoline.S [PROF]
	(_dl_profile_resolve): Likewise.
	* gmon/Makefile: Add rules to build and run tst-profile-static.
	* gmon/tst-profile-static.c: New file.
	* Makeconfig (+link-static): Allow passing program-specific flags.

2005-07-05  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #1111]
	* nis/nss_compat/compat-grp.c (internal_getgrgid_r): Check if NSS
	module provides getgrgid_r.
	(getgrnam_plusgroup): Preserve original return value.
	* nis/nss_compat/compat-pwd.c (getpwnam_plususer): Preserve
	original return value.
	* nis/nss_compat/compat-spwd.c (getspnam_plususer): Likewise.

2005-07-05  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1101]
	* posix/regex_internal.c (build_wcs_buffer): Use MB_LEN_MAX not
	MB_CUR_MAX.
	(build_wcs_upper_buffer): Likewise.

	* csu/elf-init.c (__libc_csu_fini): Pretty printing.

2005-07-02  Roland McGrath  <roland@redhat.com>

	* NEWS: Note LinuxThreads removal.
	* manual/install.texi (Installation): Don't mention linuxthreads.
	(Configuring and compiling): Don't use linuxthreads as example.

	* sysdeps/unix/sysv/linux/configure.in: Check for nptl add-on only,
	not linuxthreads.
	* sysdeps/unix/sysv/linux/configure: Regenerated.
	* resolv/Depend: Add nptl.
	* rt/Depend: Likewise.

	* linuxthreads, linuxthreads_db: Directories removed (preserved in
	ports repository).

2005-06-27  Jakub Jelinek  <jj@ultra.linux.cz>

	[BZ #1037]
	* sysdeps/unix/sysv/linux/sparc/sparc32/Makefile: -mv8 is deprecated,
	use -mcpu=v8.

2005-06-16  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1016]
	* sysdeps/ia64/strlen.S (strlen): Change l2 into a local label.

2005-06-23  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #1109]
	* nscd/nscd_stat.c (receive_print_stats): Replace YESSTR/NOSTR
	with own translation.

2005-06-25  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1097]
	* sunrpc/xdr.c (xdr_hyper, xdr_u_hyper): When decoding, cast
	t2 to uint32_t instead of ulong.
	* sunrpc/Makefile (tests): Add tst-xdrmem.
	* sunrpc/tst-xdrmem.c: New test.

	* Versions.def (ld): Add GLIBC_2.4.
	* configure.in: Add --enable-stackguard-randomization option.
	(ENABLE_STACKGUARD_RANDOMIZE): New define.
	* config.h.in (ENABLE_STACKGUARD_RANDOMIZE): Add.
	* sysdeps/unix/sysv/linux/dl-osinfo.h: Include stdint.h.
	(_dl_setup_stack_chk_guard): New inline function.
	* sysdeps/generic/dl-osinfo.h: Include stdint.h.
	(_dl_setup_stack_chk_guard): New inline function.
	* elf/rtld.c (__stack_chk_guard): New variable.
	(dl_main): Remove all traces of TLS_INIT_TP_EXPENSIVE.
	Set __stack_chk_guard to _dl_setup_stack_chk_guard (),
	use THREAD_SET_STACK_GUARD if defined.
	* elf/Versions (ld): Export __stack_chk_guard@@GLIBC_2.4.
	* sysdeps/generic/libc-start.c (__stack_chk_guard): New variable.
	(__libc_start_main): Set __stack_chk_guard to
	_dl_setup_stack_chk_guard (), use THREAD_SET_STACK_GUARD if defined.
	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Remove all
	traces of TLS_INIT_TP_EXPENSIVE.
	* debug/Versions (libc): Export __stack_chk_fail@@GLIBC_2.4.
	* debug/Makefile (routines): Add stack_chk_fail.
	(static-only-routines): Add stack_chk_fail_local.
	* debug/stack_chk_fail_local.c: New file.
	* debug/stack_chk_fail.c: New file.
	* elf/Makefile: Add rules to build and run tst-stackguard1{,-static}
	tests.
	* elf/tst-stackguard1.c: New file.
	* elf/tst-stackguard1-static.c: New file.
	* elf/stackguard-macros.h: New file.

2005-06-21  Ulrich Drepper  <drepper@redhat.com>

	* resource/Makefile (tests): Add tst-getrlimit.
	* resource/tst-getrlimit.c: New file.

	* sysdeps/unix/sysv/linux/bits/resource.h (RLIMIT_RTPRIO): Fix typo.
	* sysdeps/unix/sysv/linux/alpha/bits/resource.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/resource.h: Likewise.

2005-06-20  Ulrich Drepper  <drepper@redhat.com>

	* nscd/nscd.init: Get more in line with lsb3.
	* nscd/nscd.c: Adjust some error codes to fit in better with lsb3.
	* nscd/connections.c: Likewise.

2005-06-20  Jakub Jelinek  <jakub@redhat.com>

	[BZ #653]
	* sysdeps/unix/sysv/linux/sys/quota.h: Add definitions and types for
	_LINUX_QUOTA_VERSION >= 2.
	(_LINUX_QUOTA_VERSION): Define if not yet defined.

	* sysdeps/unix/sysv/linux/bits/resource.h (RLIMIT_NICE,
	RLIMIT_RTPRIO): Add.
	(RLIMIT_NLIMITS): Adjust.
	* sysdeps/unix/sysv/linux/alpha/bits/resource.h (RLIMIT_NICE,
	RLIMIT_RTPRIO): Add.
	(RLIMIT_NLIMITS): Adjust.
	* sysdeps/unix/sysv/linux/mips/bits/resource.h (RLIMIT_NICE,
	RLIMIT_RTPRIO): Add.
	(RLIMIT_NLIMITS): Adjust.
	* sysdeps/unix/sysv/linux/sparc/bits/resource.h (RLIMIT_NICE,
	RLIMIT_RTPRIO): Add.
	(RLIMIT_NLIMITS): Adjust.

2005-06-17  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1106]
	* time/mktime.c: Always include <string.h> for prototype of
	implicitly used memcpy.

	[BZ #1104]
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/truncate64.c
	(truncate64): Use __truncate, not truncate.
	(__have_no_truncate64): Renamed from have_no_truncate64.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/ftruncate64.c
	(__have_no_truncate64): Renamed from have_no_truncate64.

	* sysdeps/powerpc/fpu/libm-test-ulps: Adjust ulps for complex
	float functions for gcc 4.

2005-06-10  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_runtime_setup):
	Handle prelinked libraries and binaries with new style PLT.

2005-06-07  Jakub Jelinek  <jakub@redhat.com>

	* elf/elf.h (R_PPC_REL16, R_PPC_REL16_LO, R_PPC_REL16_HI,
	R_PPC_REL16_HA): Define.

2005-06-14  Alan Modra  <amodra@bigpond.net.au>

	* config.h.in (HAVE_ASM_PPC_REL16): Add.
	* elf/elf.h (DT_PPC_GOT, DT_PPC_NUM): Define.
	* elf/tls-macros.h (PowerPC32): Include config.h.  Add variants of
	TLS_IE, TLS_LD and TLS_GD for new PLT/GOT layout.
	* sysdeps/powerpc/powerpc32/configure.in: New file,
	* sysdeps/powerpc/powerpc32/dl-dtprocnum.h: New file.
	* sysdeps/powerpc/powerpc32/dl-machine.h (DT_PPC): Define.
	(ppc_got): New inline function.
	(elf_machine_dynamic): Use ppc_got.  Add attribute const.
	(elf_machine_load_address): Add attribute const.  Don't use int vars.
	Use bcl rather than bl to save trashing branch target stack.  Use
	elf_machine_dynamic rather than duplicating code here.
	(elf_machine_runtime_setup): New inline function replacing define.
	Handle new PLT.
	(elf_machine_fixup_plt): Handle new PLT.
	(elf_machine_rela): Likewise.
	* sysdeps/powerpc/powerpc32/sysdep.h: Include config.h.
	(CALL_MCOUNT): Don't set up counter vars.
	* sysdeps/powerpc/powerpc32/ppc-mcount.S: Correct comment.
	* sysdeps/powerpc/powerpc32/elf/start.S (start_addressesp): Don't
	define when HAVE_ASM_PPC_REL16.
	(_start): Add HAVE_ASM_PPC_REL16 code.
	* sysdeps/powerpc/powerpc32/dl-start.S (_dl_start_user): Don't bl
	into the GOT when HAVE_ASM_PPC_REL16.
	* sysdeps/powerpc/powerpc32/memset.S (memset): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/__longjmp-common.S (__longjmp): Ditto.
	* sysdeps/powerpc/powerpc32/fpu/s_ceil.S (__ceil): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_ceilf.S (__ceilf): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_floor.S (__floor): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_floorf.S (__floorf): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_lround.S (__lround): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_rint.S (__rint): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_rintf.S (__rintf): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_round.S (__round): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_roundf.S (__roundf): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_trunc.S (__trunc): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_truncf.S (__truncf): Likewise.
	* sysdeps/powerpc/powerpc32/fpu/setjmp-common.S (__sigsetjmp):
	Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S (__brk): Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S
	(__getcontext): Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S
	(__setcontext): Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S
	(__swapcontext): Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S (stackblock):
	Comment.
	(__socket): Bomb if NARGS >= 7.  Invoke CGOTSETUP and CGOTRESTORE.

2005-06-17  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1106]
	* sysdeps/posix/sigignore.c: Include <string.h> to tell the compiler
	to use __GI_memset.
	* sysdeps/posix/signal.c: Likewise.
	* sysdeps/posix/sigset.c: Likewise.
	* sysdeps/posix/sysv_signal.c: Likewise.
	* sysdeps/unix/sysv/linux/sleep.c: Likewise.
	* sysdeps/unix/sysv/linux/sysctl.c: Likewise.
	* sysdeps/unix/sysv/linux/system.c: Likewise.

2005-06-15  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1088]
	* hesiod/hesiod.c (hesiod_init): Don't check for ctx->classes[0] == 0
	or both classes equal here.
	(parse_config_file): If both classes are equal, clear the second one.

2005-06-08  Karl Kelley  <kekelley@iastate.edu>

	[BZ #1088]
	* hesiod/hesiod_p.h (struct hesiod_p): Add classes array.
	* hesiod/hesiod.c (hesiod_init): Initialize classes.  Fail if no
	valid classes were given or if both are equal.
	(hesiod_resolve): Use ctx->classes instead of hardcoded C_IN
	and C_HS order.
	(parse_config_file): Handle classes keyword.
	* hesiod/README.hesiod: Mention addition of the classes keyword.

2005-06-14  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1085]
	* configure.in: Add test for availability of libaudit.
	* config.h.in: Define HAVE_LIBAUDIT.
	* config.make.in: Define have-libaudit.
	* nscd/Makefile: If libaudit is available, link nscd with it.
	* nscd/selinux.c: If HAVE_LIBAUDIT is defined, log using libaudit.
	Patch by Steve Grubb <sgrubb@redhat.com>.

	* debug/pread64_chk.c: Use __libc_pread64 instead of __pread64.
	* sysdeps/posix/posix_fallocate64.c: Likewise.
	* include/string.h: Use libc_hidden_proto for strnlen.
	* sysdeps/generic/strnlen.c: Add libc_hidden_def.
	* include/libintl.h: Use libc_hidden_proto for __dcgettext.
	* intl/dcgettext.c: Add libc_hidden_def.
	* include/execinfo.h: Add libc_hidden_proto for __backtrace and
	__backtrace_symbols_fd.
	* sysdeps/generic/backtrace.c: Add libc_hidden_def.
	* sysdeps/generic/backtracesymsfd.c: Likewise.
	* sysdeps/generic/elf/backtracesymsfd.c: Likewise.
	* sysdeps/i386/backtrace.c: Likewise.
	* sysdeps/ia64/backtrace.c: Likewise.
	* sysdeps/powerpc/powerpc32/backtrace.c: Likewise.
	* sysdeps/powerpc/powerpc64/backtrace.c: Likewise.
	* sysdeps/s390/s390-32/backtrace.c: Likewise.
	* sysdeps/s390/s390-64/backtrace.c: Likewise.

2005-06-13  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/clock_gettime.c (clock_gettime): Implement case
	where HANDLED_REALTIME is not defined.  [BZ #966]

2005-06-13  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1096]
	* sysdeps/unix/sysv/linux/netlinkaccess.h (__netlink_sendreq,
	__netlink_receive): Remove prototypes.
	(__netlink_request): New prototype.
	* sysdeps/unix/sysv/linux/ifaddrs.c: Include <alloca.h> and
	<stdint.h>.
	(__netlink_sendreq): Make static.
	(__netlink_receive): Rename to...
	(__netlink_request): ... this.  Add type argument, call
	__netlink_sendreq.  If MSG_TRUNC is set after recvmsg, retry
	with a bigger buffer.  Don't record buffers that contain no
	messages we are expecting.
	(getifaddrs): Use __netlink_request instead of __netlink_sendreq
	and __netlink_receive pairs.  Formatting.
	* sysdeps/unix/sysv/linux/if_index.c (if_nameindex_netlink): Use
	__netlink_request instead of __netlink_sendreq and __netlink_receive
	pair.

2005-06-13  Thorsten Kukuk  <kukuk@suse.de>

	* sysdeps/unix/sysv/linux/netinet/if_tr.h: Don't include kernel
	headers, instead copy important structs/defines.

2005-06-13  Jakub Jelinek  <jakub@redhat.com>

	* elf/rtld.c (dl_main): Move DT_DEBUG setup before first
	_dl_debug_state call.

2005-06-12  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-error.c (_dl_signal_error): Store information about use of
	real malloc in the catch object.
	(_dl_catch_error): Forward information about malloc use to caller
	in new parameter.
	(_dl_out_of_memory): Make static.
	* elf/dl-deps.c: Adjust callers of _dl_catch_error.
	* elf/dl-libc.c: Likewise.
	* elf/dl-open.c: Likewise.
	* elf/rtld.c: Likewise.
	Add new --audit option.
	* sysdeps/generic/ldsodefs.h: Remove _dl_out_of_memory declaration.
	(rtld_global_ro._dl_signal_error): Add new parameter.
	* include/dlfcn.h (_dl_catch_error): Add new parameter.
	* dlfcn/dlfcn.c (_dlerror_run): Pass additional parameter to
	_dl_catch_error.  Only free if the returned newly value says so.

2005-06-01  Roland McGrath  <roland@redhat.com>

	[BZ #959]
	* posix/tst-mmap.c (main): Fill the test file with enough data for the
	page size.

2005-05-30  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/dl-osinfo.h (DL_SYSDEP_OSCHECK): If
	GLRO(dl_osversion) has been already set to a value smaller than
	_dl_discover_osversion (), don't overwrite it here.

2005-05-24  Thomas Schwinge  <schwinge@nic-nac-project.de>

	* sysdeps/mach/i386/syscall.S (syscall): Call END.

2005-05-28  Richard Henderson  <rth@redhat.com>

	* elf/elf.h (DT_ALPHA_PLTRO, DT_ALPHA_NUM): New.
	* sysdeps/alpha/dl-dtprocnum.h: New file.
	* sysdeps/alpha/dl-machine.h (DT_ALPHA): New.
	(elf_machine_load_address): Simplify to rely on gprel relocations.
	(elf_machine_runtime_setup): Handle DT_ALPHA_PLTRO plt format.
	Remove thread safety workaround for binutils 2.6.
	(elf_machine_fixup_plt): Handle DT_ALPHA_PLTRO plt format.
	* sysdeps/alpha/dl-trampoline.S (_dl_runtime_resolve_new): New.
	(_dl_runtime_profile_new): New.
	(_dl_runtime_resolve_old): Rename from _dl_runtime_resolve.
	(_dl_runtime_profile_old): Rename from _dl_runtime_profile.  Fix
	typo in _dl_call_pltexit argument loading.

	* sysdeps/alpha/div_libc.h (funcnoplt): New.
	* sysdeps/alpha/divl.S: Use it.
	* sysdeps/alpha/divq.S: Likewise
	* sysdeps/alpha/divqu.S: Likewise.
	* sysdeps/alpha/reml.S: Likewise.
	* sysdeps/alpha/remq.S: Likewise.
	* sysdeps/alpha/remqu.S: Likewise.

2005-05-26  Andreas Schwab  <schwab@suse.de>

	* locale/Makefile (CFLAGS-loadlocale.c): Don't define.

2005-05-26  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/bits/fcntl.h (O_DIRECT): Fix value.
	Reported by Colin Gibbs <colin@gibbsonline.net>.  [BZ #954]

2005-05-17  Alan Modra  <amodra@bigpond.net.au>

	* sysdeps/powerpc/powerpc32/fpu/__longjmp-common.S (__longjmp): Corrent
	_dl_hwcap access in PIC && !SHARED case.
	* sysdeps/powerpc/powerpc32/fpu/setjmp-common.S: Likewise.

2005-05-25  Dwayne Grant McConnell  <dgm69@us.ibm.com>

	* gmon/gmon.c: Add space in weak_alias use.
	* linuxthreads/sysdeps/unix/sysv/linux/mips/vfork.S: Likewise.
	* sysdeps/alpha/htonl.S: Likewise.
	* sysdeps/alpha/htons.S: Likewise.
	* sysdeps/alpha/elf/start.S: Likewise.
	* sysdeps/i386/i386-mcount.S: Likewise.
	* sysdeps/ia64/strchr.S: Likewise.
	* sysdeps/ia64/fpu/e_lgamma_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgamma_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammal_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammal_r.c: Likewise.
	* sysdeps/ia64/fpu/w_lgamma.c: Likewise.
	* sysdeps/ia64/fpu/w_lgamma.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammaf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammaf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal.c: Likewise.
	* sysdeps/mach/hurd/readdir64_r.c: Likewise.
	* sysdeps/mach/hurd/sigaltstack.c: Likewise.
	* sysdeps/powerpc/fpu/s_fabs.S: Likewise.
	* sysdeps/powerpc/fpu/s_fabs.S: Likewise.
	* sysdeps/powerpc/fpu/s_fabs.S: Likewise.
	* sysdeps/powerpc/fpu/s_fabs.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmax.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmax.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmax.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmax.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmin.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmin.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmin.S: Likewise.
	* sysdeps/powerpc/fpu/s_fmin.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_copysign.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_copysign.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_copysign.S: Likewise.
	* sysdeps/powerpc/powerpc64/fpu/s_copysign.S: Likewise.
	* sysdeps/powerpc/powerpc64/fpu/s_copysign.S: Likewise.
	* sysdeps/powerpc/powerpc64/fpu/s_copysign.S: Likewise.
	* sysdeps/s390/s390-32/s390-mcount.S: Likewise.
	* sysdeps/s390/s390-64/s390x-mcount.S: Likewise.
	* sysdeps/sparc/sparc32/memset.S: Likewise.
	* sysdeps/sparc/sparc32/stpcpy.S: Likewise.
	* sysdeps/sparc/sparc32/strchr.S: Likewise.
	* sysdeps/sparc/sparc32/strchr.S: Likewise.
	* sysdeps/sparc/sparc64/memcmp.S: Likewise.
	* sysdeps/sparc/sparc64/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/memset.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/getrusage.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/sigsuspend.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/swapcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/syscall.S: Likewise.
	* sysdeps/unix/sysv/linux/readdir64.c: Likewise.
	* sysdeps/unix/sysv/linux/readdir64_r.c: Likewise.
	* sysdeps/unix/sysv/linux/hppa/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/makecontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/swapcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/ia64/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/ia64/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/mips/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/mips/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/makecontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/swapcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/swapcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc32/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S: Likewise.
	* sysdeps/unix/sysv/linux/wordsize-64/getdents.c: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/makecontext.c: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/swapcontext.S: Likewise.
	* sysdeps/x86_64/_mcount.S: Likewise.

2005-05-24  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h
	(SETUP_PIC_REG, LOAD_PIC_REG): Move these macros ...
	* sysdeps/i386/sysdep.h [PIC]: ... to here.

2005-05-23  Roland McGrath  <roland@redhat.com>

	* sysdeps/arm, sysdeps/unix/arm, sysdeps/unix/sysv/linux/arm:
	Subdirectories moved to ports repository.
	* configure.in (base_machine): Remove arm* and thumb* patterns.
	* shlib-versions (arm.*-.*-linux.*): Remove this pattern.

2005-05-23  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1086]
	* sunrpc/bindrsvprt.c (LOWPORT): Apparently some mountd
	implementations are broken and don't accept ports < 512.

2005-05-22  Dmitry V. Levin  <ldv@altlinux.org>

	[BZ #961]
	* io/sys/sendfile.h: Remove __nonnull from sendfile and sendfile64
	declarations.

2005-05-23  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1086]
	* sunrpc/pm_getport.c (__get_socket): New function.
	(pmap_getport): Use it to open a non-reserved socket to the portmapper
	for TCP.
	* include/rpc/pmap_clnt.h (__get_socket): Declare.
	* sunrpc/pm_getmaps.c (pmap_getmaps): Use __get_socket to get an
	non-reserved socket for the portmapper.
	Based on a patch by Steve Dickson <steved@redhat.com>.

	[BZ #1086]
	* sunrpc/bindrsvprt.c (bindresvport): Try harder to find a port.
	If we tried looking at the usual range without success extend the
	range to even lower ports.

	* sysdeps/unix/clock_gettime.c (clock_gettime): Revert last patch.

2005-05-22  Andreas Schwab  <schwab@suse.de>

	* elf/rtld.c: Include <dl-osinfo.h>.

2005-05-17  Alan Modra  <amodra@bigpond.net.au>

	* sysdeps/powerpc/powerpc32/sysdep.h (PSEUDO_RET): Don't use
	JUMPTARGET.  Instead append @local to __syscall_error.
	* sysdeps/powerpc/powerpc32/bsd-_setjmp.S: Delete all occurrences
	of JUMPTARGET.  Instead append @local to labels.
	* sysdeps/powerpc/powerpc32/bsd-setjmp.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/setjmp-common.S: Likewise.
	* sysdeps/powerpc/powerpc32/ppc-mcount.S: Likewise.
	* sysdeps/powerpc/powerpc32/setjmp-common.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/vfork.S: Likewise.

	* sysdeps/powerpc/powerpc32/fpu/s_ceil.S: Use float constants.
	* sysdeps/powerpc/powerpc32/fpu/s_floor.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_rint.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_trunc.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_lround.S: Likewise.  Use one GOT
	slot to access both constants.
	* sysdeps/powerpc/powerpc32/fpu/s_round.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/s_roundf.S: Likewise.

	* sysdeps/powerpc/powerpc32/fpu/s_ceil.S (TWO52.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_ceilf.S (TWO23.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_floor.S (TWO52.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_floorf.S (TWO23.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_lround.S: Comment typo.
	(NEGZERO.0, POINTFIVE.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_rint.S (TWO52.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_rintf.S (TWO23.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_round.S (__round): Code in .text.
	(TWO52.0, POINTFIVE.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_roundf.S (__roundf): Code in .text.
	(TWO23.0, POINTFIVE.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_trunc.S (__trunc): Code in .text.
	(TWO52.0): Delete.
	* sysdeps/powerpc/powerpc32/fpu/s_truncf.S (__truncf): Code in .text.
	(TWO23.0): Delete.
	* sysdeps/powerpc/powerpc32/memset.S (memset): Formatting.

2005-05-19  Richard Henderson  <rth@redhat.com>

	* sysdeps/unix/clock_gettime.c (clock_gettime): Fix typo around
	CLOCK_REALTIME.

	* sysdeps/ia64/bits/atomic.h (__arch_compare_and_exchange_bool_32_acq,
	__arch_compare_and_exchange_bool_64_acq,
	__arch_compare_and_exchange_val_32_acq,
	__arch_compare_and_exchange_val_64_acq, atomic_exchange_and_add):
	Use __sync builtin without _si or _di suffix.

2005-05-19  Jakub Jelinek  <jakub@redhat.com>

	[BZ #955]
	* iconvdata/ibm939.c (BODY): Avoid segfaults with input characters
	<UFFFF> and above.

2005-05-17  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/clock_getcpuclockid.c
	(clock_getcpuclockid): Always return a defined value.

2005-05-17  Neal H. Walfield  <neal@gnu.org>

	[BZ #1350]
	* sysdeps/posix/getaddrinfo.c (gaih_local): Check [_HAVE_SA_LEN]
	instead of [SALEN].
	(gaih_inet): Likewise.

2005-05-11  Ulrich Drepper  <drepper@redhat.com>

	* elf/elf.h (Elf32_auxv_t): Make cross-compile safe.
	(Elf64_auxv_t): Likewise.
	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Adjust for
	removal of a_ptr element in ElfXX_auxv_t.
	* elf/dl-support.c (_dl_aux_init): Likewise.

2005-05-09  Daniel Jacobowitz  <dan@codesourcery.com>

	* sysdeps/unix/sysv/linux/clock_getres.c: Include <time.h>.
	* sysdeps/unix/sysv/linux/clock_gettime.c: Likewise.

2005-05-09  Alan Modra  <amodra@bigpond.net.au>

	* sysdeps/powerpc/powerpc64/dl-machine.h (RTLD_START): Use
	.pushsection/.popsection in place of .section/.previous.

2005-05-08  Ulrich Drepper  <drepper@redhat.com>

	* MakeTAGS: Make xgettext not look into test cases.

	* MakeTAGS: Make sure translations in error calls are marked with
	c-format by xgettext.

2005-05-07  Ulrich Drepper  <drepper@redhat.com>

	* intl/libintl.h: Always use __attribute_format_arg__ for gettext
	functions since gcc sometimes forgets the attribute for the
	standard functions.

2005-05-06  Jakub Jelinek  <jakub@redhat.com>

	[BZ #934]
	* posix/regex_internal.h: Include bits/libc-lock.h or define dummy
	__libc_lock_* macros if not _LIBC.
	(struct re_dfa_t): Add lock.
	* posix/regcomp.c (re_compile_internal): Add __libc_lock_init.
	* posix/regexec.c (regexec, re_search_stub): Add locking.

2005-05-04  Jakub Jelinek  <jakub@redhat.com>

	* intl/Makefile (tst-gettext[45].out): Pass also $(run-program-prefix)
	as argument to the scripts.
	* intl/tst-gettext2.sh: Use mkdir -p instead of test -d + mkdir.
	* intl/tst-gettext4.sh: Likewise.  Use run_program_prefix argument.
	* intl/tst-gettext5.sh: Likewise.

	* intl/tst-translit.sh: Add mkdir -p.

	* sysdeps/unix/sysv/linux/i386/sysdep.h (SETUP_PIC_REG): Use
	.ifndef/.endif to allow use of this macro more than once per .S
	file.
	(LOAD_PIC_REG): New macro.
	* sysdeps/unix/sysv/linux/i386/makecontext.S: Add call frame
	information.
	* sysdeps/unix/sysv/linux/i386/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/vfork.S: Likewise.
	* sysdeps/i386/fpu/s_asinh.S: Use LOAD_PIC_REG macro.  Add call frame
	information.
	* sysdeps/i386/fpu/e_log10f.S: Likewise.
	* sysdeps/i386/fpu/s_expm1.S: Likewise.
	* sysdeps/i386/fpu/e_acoshf.S: Likewise.
	* sysdeps/i386/fpu/e_log2l.S: Likewise.
	* sysdeps/i386/fpu/s_log1pf.S: Likewise.
	* sysdeps/i386/fpu/s_lrint.S: Likewise.
	* sysdeps/i386/fpu/s_llrint.S: Likewise.
	* sysdeps/i386/fpu/s_ilogbf.S: Likewise.
	* sysdeps/i386/fpu/s_cbrtl.S: Likewise.
	* sysdeps/i386/fpu/s_asinhf.S: Likewise.
	* sysdeps/i386/fpu/e_log.S: Likewise.
	* sysdeps/i386/fpu/e_atanhf.S: Likewise.
	* sysdeps/i386/fpu/s_lrintl.S: Likewise.
	* sysdeps/i386/fpu/e_atanhl.S: Likewise.
	* sysdeps/i386/fpu/e_scalb.S: Likewise.
	* sysdeps/i386/fpu/s_log1p.S: Likewise.
	* sysdeps/i386/fpu/s_nearbyintl.S: Likewise.
	* sysdeps/i386/fpu/s_frexpl.S: Likewise.
	* sysdeps/i386/fpu/s_log1pl.S: Likewise.
	* sysdeps/i386/fpu/s_nearbyintf.S: Likewise.
	* sysdeps/i386/fpu/s_cbrt.S: Likewise.
	* sysdeps/i386/fpu/s_expm1l.S: Likewise.
	* sysdeps/i386/fpu/s_lrintf.S: Likewise.
	* sysdeps/i386/fpu/e_acosh.S: Likewise.
	* sysdeps/i386/fpu/s_cexp.S: Likewise.
	* sysdeps/i386/fpu/s_ilogbl.S: Likewise.
	* sysdeps/i386/fpu/s_expm1f.S: Likewise.
	* sysdeps/i386/fpu/e_powl.S: Likewise.
	* sysdeps/i386/fpu/e_powf.S: Likewise.
	* sysdeps/i386/fpu/e_scalbf.S: Likewise.
	* sysdeps/i386/fpu/e_logl.S: Likewise.
	* sysdeps/i386/fpu/e_acoshl.S: Likewise.
	* sysdeps/i386/fpu/s_frexp.S: Likewise.
	* sysdeps/i386/fpu/e_pow.S: Likewise.
	* sysdeps/i386/fpu/e_logf.S: Likewise.
	* sysdeps/i386/fpu/e_log2.S: Likewise.
	* sysdeps/i386/fpu/s_frexpf.S: Likewise.
	* sysdeps/i386/fpu/s_cexpl.S: Likewise.
	* sysdeps/i386/fpu/s_llrintf.S: Likewise.
	* sysdeps/i386/fpu/s_ilogb.S: Likewise.
	* sysdeps/i386/fpu/e_scalbl.S: Likewise.
	* sysdeps/i386/fpu/e_atanh.S: Likewise.
	* sysdeps/i386/fpu/e_log10.S: Likewise.
	* sysdeps/i386/fpu/s_cbrtf.S: Likewise.
	* sysdeps/i386/fpu/s_cexpf.S: Likewise.
	* sysdeps/i386/fpu/s_llrintl.S: Likewise.
	* sysdeps/i386/fpu/e_log10l.S: Likewise.
	* sysdeps/i386/fpu/s_nearbyint.S: Likewise.
	* sysdeps/i386/fpu/s_asinhl.S: Likewise.
	* sysdeps/i386/fpu/e_log2f.S: Likewise.
	* sysdeps/i386/addmul_1.S: Various fixes to cfi handling.
	* sysdeps/i386/mul_1.S: Likewise.
	* sysdeps/i386/strtok.S: Likewise.
	* sysdeps/i386/sub_n.S: Likewise.
	* sysdeps/i386/submul_1.S: Likewise.
	* sysdeps/i386/i586/addmul_1.S: Likewise.
	* sysdeps/i386/i586/memcpy.S: Likewise.
	* sysdeps/i386/i586/mul_1.S: Likewise.
	* sysdeps/i386/i586/rshift.S: Likewise.
	* sysdeps/i386/i586/sub_n.S: Likewise.
	* sysdeps/i386/i586/submul_1.S: Likewise.
	* sysdeps/i386/i686/memcmp.S: Likewise.
	* sysdeps/i386/i686/memmove.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/mmap.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/mmap64.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/setcontext.S: Likewise.

2005-05-03  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/add_n.S: Add call frame information.
	* sysdeps/i386/addmul_1.S: Likewise.
	* sysdeps/i386/bsd-setjmp.S: Likewise.
	* sysdeps/i386/lshift.S: Likewise.
	* sysdeps/i386/memchr.S: Likewise.
	* sysdeps/i386/memcmp.S: Likewise.
	* sysdeps/i386/mul_1.S: Likewise.
	* sysdeps/i386/rawmemchr.S: Likewise.
	* sysdeps/i386/rshift.S: Likewise.
	* sysdeps/i386/stpncpy.S: Likewise.
	* sysdeps/i386/strchr.S: Likewise.
	* sysdeps/i386/strchrnul.S: Likewise.
	* sysdeps/i386/strcspn.S: Likewise.
	* sysdeps/i386/strpbrk.S: Likewise.
	* sysdeps/i386/strrchr.S: Likewise.
	* sysdeps/i386/strspn.S: Likewise.
	* sysdeps/i386/strtok.S: Likewise.
	* sysdeps/i386/sub_n.S: Likewise.
	* sysdeps/i386/submul_1.S: Likewise.
	* sysdeps/i386/elf/bsd-setjmp.S: Likewise.
	* sysdeps/i386/i486/strcat.S: Likewise.
	* sysdeps/i386/i586/add_n.S: Likewise.
	* sysdeps/i386/i586/addmul_1.S: Likewise.
	* sysdeps/i386/i586/lshift.S: Likewise.
	* sysdeps/i386/i586/memcpy.S: Likewise.
	* sysdeps/i386/i586/memset.S: Likewise.
	* sysdeps/i386/i586/mul_1.S: Likewise.
	* sysdeps/i386/i586/rshift.S: Likewise.
	* sysdeps/i386/i586/strchr.S: Likewise.
	* sysdeps/i386/i586/strcpy.S: Likewise.
	* sysdeps/i386/i586/sub_n.S: Likewise.
	* sysdeps/i386/i586/submul_1.S: Likewise.
	* sysdeps/i386/i686/add_n.S: Likewise.
	* sysdeps/i386/i686/memcmp.S: Likewise.
	* sysdeps/i386/i686/memmove.S: Likewise.
	* sysdeps/i386/i686/mempcpy.S: Likewise.
	* sysdeps/i386/i686/memset.S: Likewise.
	* sysdeps/i386/i686/strtok.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/mmap.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/mmap64.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/posix_fadvise64.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/semtimedop.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/setcontext.S: Likewise.

	* sysdeps/i386/fpu/libm-test-ulps: Adjust for gcc 4.

	* sysdeps/unix/sysv/linux/kernel-features.h: waitid is available
	on ppc in 2.6.12.

2005-04-29  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1083]
	* sysdeps/posix/posix_fallocate.c (posix_fallocate): If len == 0,
	call ftruncate if offset is bigger than current size.  Make sure
	the file is offset + len bytes long if that is more than current size.
	Don't overwrite previous content of the file.
	* sysdeps/posix/posix_fallocate64.c (__posix_fallocate64_l64):
	Likewise.

2005-05-02  Roland McGrath  <roland@redhat.com>

	[BZ #924]
	* crypt/md5.c [! HAVE_MEMCPY] (memcpy): Yield proper expression value.

2005-04-29  Roland McGrath  <roland@redhat.com>

	* timezone/africa: Update from tzdata2005i.
	* timezone/asia: Likewise.
	* timezone/northamerica: Likewise.
	* timezone/yearistype: Likewise.

	* sysdeps/i386/sysdep.h (CALL_MCOUNT): Fix typo in last change.

2005-04-29  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1093]
	* nis/nis_table.c: Fix realloc handling.
	* nis/nis_removemember.c: Likewise.

2005-04-28  Ulrich Drepper  <drepper@redhat.com>

	[BZ #798]
	* nscd/Makefile: Help losers who use --with-headers.

2005-04-28  Roland McGrath  <roland@redhat.com>

	[BZ #796]
	* sysdeps/unix/sysv/linux/dl-sysdep.h: New file.
	Define NEED_DL_SYSINFO_DSO for all platforms.

	* sysdeps/generic/dl-sysdep.h: Remove multiple inclusion protection.
	* sysdeps/alpha/dl-sysdep.h: Likewise.
	Use #include_next instead of duplicating generic file's contents.
	* sysdeps/ia64/dl-sysdep.h: Likewise.
	* sysdeps/sparc/dl-sysdep.h: Likewise.

2005-03-22  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/powerpc/powerpc64/memset.S (memset): Make ___memset local.

2005-03-07  Steven Munroe  <sjmunroe@us.ibm.com>

	[BZ #781]
	* sysdeps/unix/sysv/linux/kernel-features.h
	(__ASSUME_TGKILL): Define for powerpc32/64 starting with 2.6.1.
	(__ASSUME_UTIMES): Define for powerpc32/64 starting with 2.6.1.
	(__ASSUME_FADVISE64_64_SYSCALL): Define for powerpc32 only starting
	with 2.6.1.
	(__ASSUME_WAITID_SYSCALL): Don't define for powerpc32/64.

2005-04-28  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/sysdep.h: Add cfi instrumentation to asm fragments.
	* sysdeps/unix/sysv/linux/i386/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/i386/socket.S: Remove now duplicate
	cfi_startproc and cfi_endproc.

	* configure.in: Remove ultrasparc names.

	* sysdeps/i386/i686/memcmp.S: Move misplaced END.

2005-03-27  Bruno Haible  <bruno@clisp.org>

	Make it possible for multiple threads to use gettext() in different
	locales.
	* intl/dcigettext.c (HAVE_PER_THREAD_LOCALE): New macro.
	(struct known_translation_t): If HAVE_PER_THREAD_LOCALE, add localename
	field.
	(transcmp): If HAVE_PER_THREAD_LOCALE, compare localename fields.
	(DCIGETTEXT): If HAVE_PER_THREAD_LOCALE, fill the localename field in
	search and newp.

	* intl/tst-gettext4.c: New file.
	* intl/tst-gettext4.sh: New file.
	* intl/tst-gettext4-de.po: New file.
	* intl/tst-gettext4-fr.po: New file.
	* intl/tst-gettext5.c: New file.
	* intl/tst-gettext5.sh: New file.
	* intl/Makefile (distribute): Add tst-gettext4.sh, tst-gettext4-de.po,
	tst-gettext4-fr.po, tst-gettext5.sh.
	(multithread-test-srcs): New variable.
	(test-srcs): Add its contents.
	(tests): Depend on tst-gettext4.out, tst-gettext5.out.
	(tst-gettext4.out, tst-gettext5.out): New rules.
	(CFLAGS-tst-gettext4.c, CFLAGS-tst-gettext5.c): New variables.
	Add rule for linking the multithread-test-srcs with the appropriate
	thread-library.

2005-04-28  Ulrich Drepper  <drepper@redhat.com>

	* po/rw.po: New file.  From translation team.

	* scripts/config.guess: Update from upstream.
	* scripts/config.sub: Likewise.

2005-04-27  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1094]
	* nscd/connections.c (nscd_run): Use time() value in prune_cache
	call, not timeout value, since the latter might be from another clock.

2005-04-27  Roland McGrath  <roland@redhat.com>

	[BZ #877]
	* posix/unistd.h: Remove __nonnull from acct decl.

	* rt/tst-cpuclock1.c: New file.
	* rt/tst-cpuclock2.c: New file.
	* rt/tst-cputimer1.c: New file.
	* rt/tst-cputimer2.c: New file.
	* rt/tst-cputimer3.c: New file.
	* rt/Makefile (tests): Add them.

	* sysdeps/unix/sysv/linux/kernel-posix-cpu-timers.h: New file.
	* sysdeps/unix/sysv/linux/clock_getcpuclockid.c: New file.
	* sysdeps/unix/sysv/linux/ia64/clock_getcpuclockid.c
	(HAS_CPUCLOCK): New macro.
	(clock_getcpuclockid): Function removed.
	#include the new linux file to define it instead.
	* sysdeps/unix/clock_gettime.c [HP_TIMING_AVAIL] (hp_timing_gettime):
	New function, broken out of ...
	(clock_gettime) [HP_TIMING_AVAIL]: ... here.  Call it.
	(realtime_gettime): New function, broken out of ...
	(clock_gettime) [! HANDLED_REALTIME]: ... here.  Call it.
	(clock_gettime) [SYSDEP_GETTIME_CPU]: Use new macro in default case.
	* sysdeps/unix/sysv/linux/clock_gettime.c (SYSCALL_GETTIME): New macro.
	(SYSDEP_GETTIME_CPUTIME): New macro.
	(SYSDEP_GETTIME): Use both.
	[! __ASSUME_POSIX_TIMERS] (maybe_syscall_gettime): New function, broken
	out of ...
	(SYSDEP_GETTIME): ... here.  Use it.
	[__NR_clock_gettime] (HANDLED_CPUTIME): Define it.
	(SYSDEP_GETTIME_CPUTIME): New macro.  Handle CPU timers by trying
	kernel support and falling back to hp-timing code.
	* sysdeps/posix/clock_getres.c
	[HP_TIMING_AVAIL] (hp_timing_getres): New function, broken out of ...
	(clock_getres) [HP_TIMING_AVAIL]: ... here.  Call it.
	(realtime_getres): New function, broken out of ...
	(clock_getres) [! HANDLED_REALTIME]: ... here.  Call it.
	(clock_getres) [SYSDEP_GETRES_CPU]: Use new macro in default case.
	* sysdeps/unix/sysv/linux/clock_getres.c (SYSCALL_GETRES): New macro.
	(SYSDEP_GETRES_CPUTIME): New macro.
	(SYSDEP_GETRES): Use both.
	[! __ASSUME_POSIX_TIMERS] (maybe_syscall_getres): New function, broken
	out of ...
	(SYSDEP_GETRES): ... here.  Use it.
	[__NR_clock_getres] (HANDLED_CPUTIME): Define it.
	(SYSDEP_GETRES_CPUTIME): New macro.  Handle CPU timers by trying
	kernel support and falling back to hp-timing code.
	* sysdeps/unix/sysv/linux/clock_nanosleep.c: Handle
	CLOCK_PROCESS_CPUTIME_ID and CLOCK_PROCESS_THREAD_ID specially,
	translating to the kernel clockid_t for our own process/thread clock.

2005-04-27  Ulrich Drepper  <drepper@redhat.com>

	* stdlib/test-canon.c: Make doesExist a directory and add more tests
	for the new error case.

2004-06-02  Dmitry V. Levin  <ldv@altlinux.org>
	    Ranjani Murthy <ranmur@gmail.com>

	* stdlib/canonicalize.c (__realpath): Change realpath(3) to
	return NULL and set errno to ENOTDIR for such pathnames like
	"/path/to/existing-non-directory/".

2005-04-26  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1105]
	* time/strptime_l.c (__strptime_internal): Handle 'z' to set
	tm_gmtoff.
	* time/Makefile (tests): Add tst-strptime2.
	* time/tst-strptime2.c: New file.

2005-04-26  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1081]
	* elf/dl-close.c: Include stddef.h.
	(_dl_close): If called recursively, just remember GC needs to be rerun
	and decrease l_direct_opencount.  Avoid GC if l_direct_opencount
	decreased to 1.  Rerun GC at the end if any destructor unloaded some
	additional libraries.
	* elf/Makefile: Add rules to build and run unload6 test.
	* elf/unload6.c: New test.
	* elf/unload6mod1.c: New file.
	* elf/unload6mod2.c: New file.
	* elf/unload6mod3.c: New file.

	* malloc/hooks.c (mem2chunk_check): Add magic_p argument, set *magic_p
	if magic_p is not NULL.
	(top_check): Invoke MALLOC_FAILURE_ACTION if MORECORE failed.
	(malloc_check): Fail if sz == -1.
	(free_check): Adjust mem2chunk_check caller.
	(realloc_check): Likewise.  Fail if bytes == -1.  If bytes == 0 and
	oldmem != NULL, call free_check and return NULL.  If reallocating
	and returning NULL, invert magic byte again to make oldmem valid
	region for further checking.
	(memalign_check): Fail if bytes == -1.
	* malloc/Makefile: Add rules to build and run tst-mcheck.
	* malloc/tst-mcheck.c: New test.

2005-04-26  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1110]
	* stdio-common/vfscanf.c: Correctly account for characters of
	decimal points right after +-.

2005-04-26  Roland McGrath  <roland@redhat.com>

	* elf/rtld-Rules (rtld-all): Test ifndef rtld-modules instead of
	ifeq ($(subdir),elf) to distinguish main driver from subdir runs.

2005-04-25  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h
	(INTERNAL_SYSCALL_ERROR_P): Fix typo in last change.

	* sunrpc/xdr.c (xdr_u_int): Use `long' for L and cast where needed.

	* elf/dl-load.c: Revert last change.

2005-04-24  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1110]
	* stdio-common/vfscanf.c: Fix parsing of decimal point after +-.
	Patch by Hamed Malek <hamed@bamdad.org>.

2005-04-21  Roland McGrath  <roland@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Don't use MAP_DENYWRITE,
	since Linux ignores it in user mmap calls.

2005-04-17  David S. Miller  <davem@davemloft.net>

	* sysdeps/sparc/sparc32/elf/start.S: Define __data_start.
	* sysdeps/sparc/sparc64/elf/start.S: Likewise.

2005-04-15  Roland McGrath  <roland@redhat.com>

	* timezone/Makefile (zic-deps): New variable.
	($(testdata)/America/New_York): Use it instead of explicit deps.
	($(testdata)/Etc/UTC, $(testdata)/Australia/Melbourne): Likewise.
	($(testdata)/America/Sao_Paulo, $(testdata)/Asia/Tokyo): Likewise.
	(%/UTC %/Universal): New pattern rule, replaces ...
	($(testdata)/UTC, $(testdata)/Universal): ... these removed targets.
	($(testdata)/%/Berlin $(testdata)/%/London): New pattern rule.
	($(testdata)/Europe/London, $(testdata)/Europe/Berlin): Removed.

2005-04-14  Roland McGrath  <roland@redhat.com>

	* MakeTAGS ($P/$(domain).pot): Depend on distinfo file as well.
	(extract): Filter-out distinfo file name.

	[BZ #253]
	* MakeTAGS (text-srcs): Match %.bash.in files too.

	[BZ #253]
	* nscd/Makefile (all-nscd-modules): New variable, include selinux
	module regardless of configuration.
	(distribute): Use that instead of $(nscd-modules).

2005-04-13  David S. Miller  <davem@davemloft.net>

	Add sparc64 TLS and NPTL support.
	* elf/tls-macros.h: Add Sparc64 defines.
	* sysdeps/sparc/sparc64/dl-machine.h (sparc64_fixup_plt): Mark as
	always_inline.
	(elf_machine_fixup_plt): Likewise.
	(elf_machine_rela): Handle TLS relocations.
	(elf_machine_type_cleaa): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h
	(SYSCALL_ERROR_HANDLER_ENTRY): Use sethi/or for GOT reloc.
	It does not always fit in R_SPARC_GOT13 when building -fPIC.
	Also, add TLS handling.
	* sysdeps/unix/sysv/linux/configure.in (arch_minimum_kernel):
	Increase it to 2.4.21 for sparc64.
	* sysdeps/unix/sysv/linux/sparc/sparc32/clone.S: NULL terminate
	backtrace by zero'ing out %fp.  Store away flags, func_ptr,
	and func_arg in global registers not local registers.
	* sysdeps/unix/sysv/linux/sparc/sparc64/clone.S: Handle PTID, TLS,
	and CTID arguments properly.  Add RESET_PID handling.
	* sysdeps/unix/sysv/linux/sparc/sparc64/pause.c: Rework so that we
	do not invoke __sigprocmask().  We can always assume rt signals
	are present on sparc64, so just do an inline syscall.

2005-04-13  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/sparc/sparc64/dl-machine.h: Add dl_machine_h multiple
	inclusion guard for the first half of the header.
	(elf_machine_type_class, ELF_MACHINE_JMP_SLOT, ELF_MACHINE_NO_REL,
	ELF_MACHINE_PLTREL_OVERLAP, elf_machine_runtime_setup,
	elf_machine_relplt, DL_STACK_END, RTLD_START): Move into the
	#ifndef dl_machine_h guarded part of the header.

2005-04-14  Ulrich Drepper  <drepper@redhat.com>

	[BZ #851]
	* posix/execvp.c (execvp): Use file name including path when
	trying to run it with shell.
	* posix/Makefile: Add rules to build and run tst-execvp3.
	* posix/tst-execvp3.c: New file.

2005-04-12  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1090]
	* stdlib/random_r.c (__initstate_r): Don't use non-existing state.
	* string/tst-strfry.c: New file.
	* string/Makefile (tests): Add tst-strfry.

2005-04-11  James A. Morrison  <ja2morri@uwaterloo.ca>

	* manual/string.texi: Fix typo in wmemcpy decl.

2005-04-10  David S. Miller  <davem@davemloft.net>

	* sysdeps/sparc/sparc32/dl-trampoline.S: Use std not stx.

2005-04-08  Carlos O'Donell <carlos@baldric.uwo.ca>

	* FAQ.in: Explain why `make' might fail running rpcgen.
	* FAQ: Regenerated.

2005-04-07  Roland McGrath  <roland@redhat.com>

	* po/libc.pot: Regenerated.

2005-04-07  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/dl-osinfo.h (_dl_discover_osversion)
	[(NEED_DL_SYSINFO || NEED_DL_SYSINFO_DSO) && SHARED]: Scan
	GLRO(dl_sysinfo_map) for PT_NOTE giving Linux kernel version,
	we can skip the uname call if it's there.
	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Don't use
	DL_SYSDEP_OSCHECK here.
	* elf/rtld.c (dl_main) [DL_SYSDEP_OSCHECK]: Do it here instead.

	* sysdeps/generic/ldsodefs.h (struct rtld_global_ro):
	Add _dl_sysinfo_map.
	* elf/rtld.c (dl_main): Don't call _dl_init_paths early in the
	rtld_is_main case.  Call it unconditionally later.
	Move GLRO(dl_sysinfo_dso) handling earlier, before _dl_init_paths call.
	Initialize GLRO(dl_sysinfo_map).
	* elf/dl-load.c (open_path): Bail out if _dl_init_paths wasn't called.
	* sysdeps/generic/dl-sysdep.c (_DL_FIRST_EXTRA): New macro.
	(_dl_important_hwcaps)
	[(NEED_DL_SYSINFO || NEED_DL_SYSINFO_DSO) && SHARED]: Scan
	GLRO(dl_sysinfo_map) for PT_NOTE giving synthetic hwcap names
	and bit values.
	* elf/ldconfig.c (_DL_FIRST_EXTRA): New macro.
	(hwcap_extra): New static variable.
	(is_hwcap_platform): Check hwcap_extra for a matching name.
	Remove tls special case.
	(path_hwcap): Likewise.
	(parse_conf): Parse "hwcap" directive to define synthetic hwcap bits
	and their names, stored in hwcap_extra.
	(main) [USE_TLS]: Initialize final synthetic hwcap bit as "tls".

	* sysdeps/generic/ldsodefs.h (struct rtld_global_ro): Use uint64_t for
	_dl_hwcap and _dl_hwcap_mask.
	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Cast a_val for
	AT_HWCAP to unsigned long int.
	* elf/dl-support.c (_dl_aux_init): Likewise.
	(_dl_hwcap): Update defn.

	* elf/cache.c (print_entry): Pad hwcap value with 0s in diagnostic.
	* elf/ldconfig.c (search_dir): Likewise.

2005-04-05  Roland McGrath  <roland@redhat.com>

	* NEWS: Copy 2.3.5 section from 2.3 branch.

	* intl/tst-codeset.sh: Use mkdir -p.  Put msgfmt output in temporary
	file and mv it into place.
	* intl/tst-gettext3.sh: Likewise.

	* Makefile (glibc-%.tar rule): Use make -q to ensure configure scripts
	are up to date in srcdir.  Touch all configure scripts after export.

	* iconv/gconv_int.h: Include <ctype.h> and <string.h>.

2005-04-05  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #592]
	* sysdeps/ia64/fpu/e_acosh.S: Update from Intel libm 2005-04-05
	(comment changes only).
	* sysdeps/ia64/fpu/e_acoshl.S: Likewise.
	* sysdeps/ia64/fpu/e_atanh.S: Likewise.
	* sysdeps/ia64/fpu/e_cosh.S: Likewise.
	* sysdeps/ia64/fpu/e_coshf.S: Likewise.
	* sysdeps/ia64/fpu/e_exp.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10f.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2f.S: Likewise.
	* sysdeps/ia64/fpu/e_expf.S: Likewise.
	* sysdeps/ia64/fpu/e_log.S: Likewise.
	* sysdeps/ia64/fpu/e_logf.S: Likewise.
	* sysdeps/ia64/fpu/e_pow.S: Likewise.
	* sysdeps/ia64/fpu/e_powf.S: Likewise.
	* sysdeps/ia64/fpu/e_sinh.S: Likewise.
	* sysdeps/ia64/fpu/e_sinhf.S: Likewise.
	* sysdeps/ia64/fpu/libm_error.c: Likewise.
	* sysdeps/ia64/fpu/libm_lgamma.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgammaf.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgammal.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincos.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincosf.S: Likewise.
	* sysdeps/ia64/fpu/s_asinh.S: Likewise.
	* sysdeps/ia64/fpu/s_atanl.S: Likewise.
	* sysdeps/ia64/fpu/s_cos.S: Likewise.
	* sysdeps/ia64/fpu/s_cosf.S: Likewise.
	* sysdeps/ia64/fpu/s_erf.S: Likewise.
	* sysdeps/ia64/fpu/s_erfc.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcf.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcl.S: Likewise.
	* sysdeps/ia64/fpu/s_erff.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1f.S: Likewise.
	* sysdeps/ia64/fpu/s_log1p.S: Likewise.
	* sysdeps/ia64/fpu/s_tanf.S: Likewise.
	* sysdeps/ia64/fpu/s_tanh.S: Likewise.
	* sysdeps/ia64/fpu/s_tanhf.S: Likewise.
	* sysdeps/ia64/fpu/w_tgamma.S: Likewise.
	* sysdeps/ia64/fpu/w_tgammaf.S: Likewise.
	* sysdeps/ia64/fpu/w_tgammal.S: Likewise.

2005-04-05  Roland McGrath  <roland@redhat.com>

	* scripts/config.guess: Update from master, timestamp='2005-03-24'.
	* scripts/config.sub: Update from master, timestamp='2005-02-10'.

2005-04-04  David S. Miller  <davem@davemloft.net>

	* sysdeps/sparc/sparc32/dl-trampoline.S: New file.
	* sysdeps/sparc/sparc32/dl-machine.h: Move PLT trampolines there.
	Use RESOLVE_MAP instead of RESOLVE to protect relocation code.
	(elf_machine_runtime_setup): Test for dl_profile non-null.
	* sysdeps/sparc/sparc64/dl-trampoline.S: New file.
	(ARCH_LA_PLTENTER, ARCH_LA_PLTEXIT): New.
	* sysdeps/sparc/sparc64/dl-machine.h: Move PLT trampolines there.
	Use RESOLVE_MAP instead of RESOLVE to protect relocation code.
	(elf_machine_runtime_setup): Test for dl_profile non-null.
	* sysdeps/sparc/bits/link.h: New file.
	* sysdeps/generic/ldsodefs.h (La_sparc32_regs, La_sparc32_retval,
	La_sparc64_regs, La_sparc64_retval): New.
	(struct audit_ifaces): Add sparc entries.
	* elf/tst-auditmod1.c: Add sparc entries.

2005-03-27  Bruno Haible  <bruno@clisp.org>

	* intl/tst-gettext3.c: New file.
	* intl/tst-gettext3.sh: New file.
	* intl/Makefile (distribute): Add tst-gettext3.sh.
	(test-srcs): Add tst-gettext3.
	(tests): Depend on tst-gettext3.out.
	(tst-gettext3.out): New rule.
	(CFLAGS-tst-gettext3.c): New variable.

	Fix bug exposed by tst-gettext3.
	* intl/gettextP.h (struct converted_domain): New type.
	(struct loaded_domain): Remove the conv, conv_tab fields. Add
	conversions, nconversions fields.
	(_nl_init_domain_conv): Remove declaration.
	(_nl_free_domain_conv): Remove declaration.
	(_nl_find_msg): Add convert argument.
	* intl/dcigettext.c (DCIGETTEXT): Call _nl_find_msg with convert=1.
	(_nl_find_msg): Add convert argument. When a conversion to a different
	charset is needed, create a new converted_domain element, instead of
	throwing away the old converted translations.
	(get_output_charset): New function.
	* intl/loadmsgcat.c (_nl_init_domain_conv): Remove function.
	(_nl_free_domain_conv): Remove function.
	(_nl_load_domain): Initialize the conversions array to empty. Use
	_nl_find_msg instead of _nl_init_domain_conv to retrieve the header
	entry.
	(_nl_unload_domain): Free the conversions array and its contents.

	* intl/gettextP.h (struct loaded_domain): Remove codeset_cntr field.
	(struct binding): Likewise.
	* intl/bindtextdom.c (set_binding_values): Drop codeset_cntr
	modifications.

2005-04-04  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1082]
	* sunrpc/pmap_rmt.c (xdr_rmtcall_args): Use a dummy arglen instead
	of trying to encode uninitialized arglen.

2005-04-04  Ulrich Drepper  <drepper@redhat.com>

	[BZ #825]
	* timezone/scheck.c: Update from tzcode2005h.
	* timezone/tzfile.h: Likewise.
	* timezone/zdump.c: Likewise.
	* timezone/zic.c: Likewise.

	[BZ #825]
	* timezone/antarctica: Update from tzdata2005h.
	* timezone/asia: Likewise.
	* timezone/australasia: Likewise.
	* timezone/etcetera: Likewise.
	* timezone/europe: Likewise.
	* timezone/northamerica: Likewise.
	* timezone/southamerica: Likewise.
	* timezone/leapseconds: Likewise.
	* timezone/iso3166.tab: Likewise.

2005-03-31  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #592]
	* sysdeps/ia64/fpu/libm_cpu_defs.h: Update copyright.

2005-04-01  Ulrich Drepper  <drepper@redhat.com>

	* wcsmbs/btowc.c (__btowc): Optimize parameters in ASCII range.
	* wcsmbs/wctob.c (wctob): Likewise.
	* wcsmbs/wchar.h (btowc): Add optimized inline function.
	(wctob): Likewise.

2005-03-31  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/getcontext.S: Use functionally
	equivalent, but shorter instructions.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/swapcontext.S: Likewise.
	* sysdeps/unix/x86_64/sysdep.S: Likewise.
	* sysdeps/x86_64/strchr.S: Likewise.
	* sysdeps/x86_64/memset.S: Likewise.
	* sysdeps/x86_64/strcspn.S: Likewise.
	* sysdeps/x86_64/strcmp.S: Likewise.
	* sysdeps/x86_64/elf/start.S: Likewise.
	* sysdeps/x86_64/strspn.S: Likewise.
	* sysdeps/x86_64/dl-machine.h: Likewise.
	* sysdeps/x86_64/bsd-_setjmp.S: Likewise.
	* sysdeps/x86_64/bsd-setjmp.S: Likewise.
	* sysdeps/x86_64/strtok.S: Likewise.

2005-03-30  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #592]
	* sysdeps/ia64/fpu/e_acosf.S: Update from Intel libm 2005-03-21.
	* sysdeps/ia64/fpu/e_acoshf.S: Likewise.
	* sysdeps/ia64/fpu/e_acoshl.S: Likewise.
	* sysdeps/ia64/fpu/e_acosh.S: Likewise.
	* sysdeps/ia64/fpu/e_acosl.S: Likewise.
	* sysdeps/ia64/fpu/e_acos.S: Likewise.
	* sysdeps/ia64/fpu/e_asinf.S: Likewise.
	* sysdeps/ia64/fpu/e_asinl.S: Likewise.
	* sysdeps/ia64/fpu/e_asin.S: Likewise.
	* sysdeps/ia64/fpu/e_atan2f.S: Likewise.
	* sysdeps/ia64/fpu/e_atan2.S: Likewise.
	* sysdeps/ia64/fpu/e_atanhf.S: Likewise.
	* sysdeps/ia64/fpu/e_atanhl.S: Likewise.
	* sysdeps/ia64/fpu/e_atanh.S: Likewise.
	* sysdeps/ia64/fpu/e_coshf.S: Likewise.
	* sysdeps/ia64/fpu/e_coshl.S: Likewise.
	* sysdeps/ia64/fpu/e_cosh.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10f.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10l.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2f.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2l.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2.S: Likewise.
	* sysdeps/ia64/fpu/e_expf.S: Likewise.
	* sysdeps/ia64/fpu/e_exp.S: Likewise.
	* sysdeps/ia64/fpu/e_fmodf.S: Likewise.
	* sysdeps/ia64/fpu/e_fmodl.S: Likewise.
	* sysdeps/ia64/fpu/e_fmod.S: Likewise.
	* sysdeps/ia64/fpu/e_hypotf.S: Likewise.
	* sysdeps/ia64/fpu/e_hypotl.S: Likewise.
	* sysdeps/ia64/fpu/e_hypot.S: Likewise.
	* sysdeps/ia64/fpu/e_lgammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammal_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgamma_r.c: Likewise.
	* sysdeps/ia64/fpu/e_log2f.S: Likewise.
	* sysdeps/ia64/fpu/e_log2l.S: Likewise.
	* sysdeps/ia64/fpu/e_log2.S: Likewise.
	* sysdeps/ia64/fpu/e_logf.S: Likewise.
	* sysdeps/ia64/fpu/e_logl.S: Likewise.
	* sysdeps/ia64/fpu/e_log.S: Likewise.
	* sysdeps/ia64/fpu/e_powf.S: Likewise.
	* sysdeps/ia64/fpu/e_powl.S: Likewise.
	* sysdeps/ia64/fpu/e_pow.S: Likewise.
	* sysdeps/ia64/fpu/e_remainderf.S: Likewise.
	* sysdeps/ia64/fpu/e_remainderl.S: Likewise.
	* sysdeps/ia64/fpu/e_remainder.S: Likewise.
	* sysdeps/ia64/fpu/e_scalbf.S: Likewise.
	* sysdeps/ia64/fpu/e_scalbl.S: Likewise.
	* sysdeps/ia64/fpu/e_scalb.S: Likewise.
	* sysdeps/ia64/fpu/e_sinhf.S: Likewise.
	* sysdeps/ia64/fpu/e_sinhl.S: Likewise.
	* sysdeps/ia64/fpu/e_sinh.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrtf.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrtl.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrt.S: Likewise.
	* sysdeps/ia64/fpu/libm_error.c: Likewise.
	* sysdeps/ia64/fpu/libm_lgammaf.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgammal.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgamma.S: Likewise.
	* sysdeps/ia64/fpu/libm_scalblnf.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincosf.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincos_large.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincosl.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincos.S: Likewise.
	* sysdeps/ia64/fpu/libm_support.h: Likewise.
	* sysdeps/ia64/fpu/s_asinhl.S: Likewise.
	* sysdeps/ia64/fpu/s_asinh.S: Likewise.
	* sysdeps/ia64/fpu/s_atanf.S: Likewise.
	* sysdeps/ia64/fpu/s_atanl.S: Likewise.
	* sysdeps/ia64/fpu/s_cbrtf.S: Likewise.
	* sysdeps/ia64/fpu/s_cbrtl.S: Likewise.
	* sysdeps/ia64/fpu/s_cosf.S: Likewise.
	* sysdeps/ia64/fpu/s_cosl.S: Likewise.
	* sysdeps/ia64/fpu/s_cos.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcf.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcl.S: Likewise.
	* sysdeps/ia64/fpu/s_erfc.S: Likewise.
	* sysdeps/ia64/fpu/s_erfl.S: Likewise.
	* sysdeps/ia64/fpu/s_erf.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1f.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1l.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1.S: Likewise.
	* sysdeps/ia64/fpu/s_fdimf.S: Likewise.
	* sysdeps/ia64/fpu/s_fdiml.S: Likewise.
	* sysdeps/ia64/fpu/s_fdim.S: Likewise.
	* sysdeps/ia64/fpu/s_frexp.c: Likewise.
	* sysdeps/ia64/fpu/s_frexpf.c: Likewise.
	* sysdeps/ia64/fpu/s_frexpl.c: Likewise.
	* sysdeps/ia64/fpu/s_ilogbf.S: Likewise.
	* sysdeps/ia64/fpu/s_ilogbl.S: Likewise.
	* sysdeps/ia64/fpu/s_ilogb.S: Likewise.
	* sysdeps/ia64/fpu/s_ldexp.c: Likewise.
	* sysdeps/ia64/fpu/s_ldexpf.c: Likewise.
	* sysdeps/ia64/fpu/s_ldexpl.c: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexpf.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexpl.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexp.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbnf.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbnl.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbn.S: Likewise.
	* sysdeps/ia64/fpu/s_log1pf.S: Likewise.
	* sysdeps/ia64/fpu/s_log1pl.S: Likewise.
	* sysdeps/ia64/fpu/s_log1p.S: Likewise.
	* sysdeps/ia64/fpu/s_logbf.S: Likewise.
	* sysdeps/ia64/fpu/s_logbl.S: Likewise.
	* sysdeps/ia64/fpu/s_logb.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyintf.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyintl.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyint.S: Likewise.
	* sysdeps/ia64/fpu/s_nextafterf.S: Likewise.
	* sysdeps/ia64/fpu/s_nextafterl.S: Likewise.
	* sysdeps/ia64/fpu/s_nextafter.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttowardf.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttowardl.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttoward.S: Likewise.
	* sysdeps/ia64/fpu/s_roundf.S: Likewise.
	* sysdeps/ia64/fpu/s_roundl.S: Likewise.
	* sysdeps/ia64/fpu/s_round.S: Likewise.
	* sysdeps/ia64/fpu/s_scalblnf.c: Likewise.
	* sysdeps/ia64/fpu/s_scalbn.c: Likewise.
	* sysdeps/ia64/fpu/s_scalbnf.c: Likewise.
	* sysdeps/ia64/fpu/s_scalbnl.c: Likewise.
	* sysdeps/ia64/fpu/s_tanf.S: Likewise.
	* sysdeps/ia64/fpu/s_tanhl.S: Likewise.
	* sysdeps/ia64/fpu/s_tanh.S: Likewise.
	* sysdeps/ia64/fpu/s_tanl.S: Likewise.
	* sysdeps/ia64/fpu/s_tan.S: Likewise.
	* sysdeps/ia64/fpu/w_lgamma.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammaf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal.c: Likewise.
	* sysdeps/ia64/fpu/w_tgammaf.S: Likewise.
	* sysdeps/ia64/fpu/w_tgammal.S: Likewise.
	* sysdeps/ia64/fpu/w_tgamma.S: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/libm_cpu_defs.h: New file.
	* sysdeps/ia64/fpu/libm_error_codes.h: New file.

	[BZ #592]
	* sysdeps/ia64/fpu/gen_import_file_list: Updated for Intel libm
	2005-03-21.
	* sysdeps/ia64/fpu/import_file.awk: Likewise.
	* sysdeps/ia64/fpu/import_intel_libm: Likewise.
	* sysdeps/ia64/fpu/Makefile: Likewise.

2005-03-29  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1087]
	* posix/fnmatch.c (fnmatch): For short patterns or strings attempt to
	avoid calling mbsrtowcs twice.

2005-03-29  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/dl-osinfo.h (_dl_discover_osversion): New
	function, inline broken out of ...
	(DL_SYSDEP_OSCHECK): ... here.  Use that.
	Do the discovery and set GLRO(dl_osversion) if successful,
	if __LINUX_KERNEL_VERSION <= 0.
	* elf/dl-load.c: Don't include dl-osinfo.h here.

2005-03-29  Alfred M. Szmidt  <ams@gnu.org>

	* manual/install.texi (Tools for Compilation): GNU binutils 2.15
	is now needed.

2005-03-19  Bruno Haible  <bruno@clisp.org>

	* intl/dcigettext.c (struct known_translation_t): Change type of
	domainname field to 'const char *'.
	(DCIGETTEXT): Remove const-cast.

2005-03-29  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #661]
	* grp/initgroups.c (internal_getgrouplist): Check if we have
	enough space before adding the primary group to the list.

	* posix/tst-execle1.c (do_test): Fix execle arguments.
	* posix/tst-execle2.c (do_test): Likewise.

2005-03-28  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/w_exp2.c [NO_LONG_DOUBLE]: Fix typos in alias names.
	Reported by Mark Mitchell <mark@codesourcery.com>.
	* Versions.def (libm): Define GLIBC_2.4 set.
	* math/Versions (libm: GLIBC_2.4): Add this set, with exp2l.
	* sysdeps/i386/Versions (libm: GLIBC_2.1): Add this set, with exp2l.
	* sysdeps/ia64/Versions: Likewise.
	* sysdeps/m68k/Versions: Likewise.
	* sysdeps/sparc/sparc64/Versions: Likewise.
	* sysdeps/x86_64/Versions: New file.
	* sysdeps/mips/mips64/Versions: New file.

	* locale/langinfo.h (_NL_LOCALE_NAME): New macro.
	[__USE_GNU] (NL_LOCALE_NAME): New macro.
	* locale/nl_langinfo.c: Grok special item value for _NL_LOCALE_NAME,
	return locale name string for the category.

2005-03-25  Jakub Jelinek  <jakub@redhat.com>

	[BZ #721]
	* sysdeps/generic/wcstoul_l.c: Include "wcstol_l.c" rather than
	<wcstol_l.c>.

2005-03-28  Daniel Jacobowitz  <dan@codesourcery.com>

	* sysdeps/mips/atomicity.h: Remove unused file.
	* sysdeps/mips/dl-machine.h (elf_machine_rel): Add TLS relocations.
	* sysdeps/mips/dl-tls.h: New file.
	* sysdeps/mips/libc-tls.c: New file.
	* sysdeps/mips/tls-macros.h: New file.
	* sysdeps/mips/bits/atomic.h: New file.
	* sysdeps/mips/bits/setjmp.h: Protect against multiple inclusion.
	* sysdeps/mips/elf/configure.in: New file.
	* sysdeps/mips/elf/configure: Generated.
	* sysdeps/mips/sys/asm.h: New file.
	* sysdeps/unix/sysv/linux/mips/vfork.S: New file.
	* sysdeps/unix/sysv/linux/mips/clone.S: Add NPTL and five-argument
	clone support.
	* sysdeps/unix/sysv/linux/mips/mips32/sysdep.h
	(INTERNAL_SYSCALL_NCS): New.
	(INTERNAL_SYSCALL): Update for non-constant support.
	(internal_syscall0): Likewise.
	(internal_syscall1): Likewise.
	(internal_syscall2): Likewise.
	(internal_syscall3): Likewise.
	(internal_syscall4): Likewise.
	(internal_syscall5): Likewise.
	(internal_syscall6): Likewise.
	(internal_syscall7): Likewise.
	* sysdeps/unix/sysv/linux/mips/bits/siginfo.h (SIGEV_THREAD):
	Update to match the kernel.
	(SIGEV_CALLBACK): Likewise.
	(SIGEV_THREAD_ID): Likewise.

2005-03-28  Daniel Jacobowitz  <dan@codesourcery.com>

	[BZ #783]
	* elf/tst-auditmod1.c: Add MIPS support.
	* sysdeps/generic/ldsodefs.h (La_mips_32_regs): New.
	(La_mips_32_retval): New.
	(La_mips_64_regs): New.
	(La_mips_64_retval): New.
	(struct audit_ifaces): Add MIPS entries.
	* sysdeps/mips/dl-machine.h: Check RESOLVE_MAP instead of RESOLVE.
	(elf_machine_runtime_link_map, ELF_DL_FRAME_SIZE,
	ELF_DL_SAVE_ARG_REGS, ELF_DL_RESTORE_ARG_REGS,
	ELF_MACHINE_RUNTIME_TRAMPOLINE): Move to dl-trampoline.c.
	(RTLD_START): Align the stack before calling _dl_init_internal.
	Use .ent for _dl_start_user.
	(ARCH_LA_PLTENTER, ARCH_LA_PLTEXIT): Define.
	(elf_machine_rel, elf_machine_rel_relative, elf_machine_lazy_rel)
	(elf_machine_runtime_setup): Use "auto inline".
	(elf_machine_rela, elf_machine_rela_relative): Provide empty versions.
	(elf_machine_got_rel): Likewise.  Use RESOLVE_MAP.
	* sysdeps/mips/dl-trampoline.c: New file.
	* sysdeps/mips/bits/link.h: New file.
	* sysdeps/unix/sysv/linux/mips/mips32/sysdep.h
	(internal_syscall5): Use register operands instead of non-lvalue
	memory operands.
	(internal_syscall6): Likewise.
	(internal_syscall7): Likewise.

2005-03-27  Andreas Jaeger  <aj@suse.de>

	* debug/warning-nop.c (__builtin___memcpy_chk): Define away to
	avoid warnings with older compiler.
	(__builtin___memcpy_chk): Likewise.
	(__builtin___memmove_chk: Likewise.
	(__builtin___mempcpy_chk): Likewise.
	(__builtin___memset_chk): Likewise.
	(__builtin___stpcpy_chk): Likewise.
	(__builtin___strcat_chk): Likewise.
	(__builtin___strcpy_chk): Likewise.
	(__builtin___strncat_chk): Likewise.
	(__builtin___strncpy_chk): Likewise.
	(__builtin_object_size): Likewise.

2005-03-27  Daniel Jacobowitz  <dan@codesourcery.com>

	* elf/tls-macros.h: Correct typo.

2005-03-23  Jakub Jelinek  <jakub@redhat.com>

	[BZ #822]
	* nis/ypclnt.c (yp_2_yperr): Revert 2004-11-30 patch.
	(ypprot_err): Use yp_2_yperr table also for YP_NODOM .. YP_NOMORE.

2005-03-22  Roland McGrath  <roland@redhat.com>

	* locale/setlocale.c: Comment typo.

	* scripts/versions.awk: No errors for GLIBC_PRIVATE.

	* Versions.def (libdl, librt): Add GLIBC_2.3.4 version.

	* scripts/versions.awk: Print all errors and die at the end.
	Use library name in versions array keys.

2005-03-22  Daniel Jacobowitz  <dan@codesourcery.com>

	* elf/elf.h (PT_ARM_EXIDX): New macro.

2005-03-21  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #1098]
	* sunrpc/xdr_stdio.c (xdrstdio_getlong, xdrstdio_putlong):
	Convert correctly between long/int on 64bit big-endian.

2005-03-21  David Mosberger  <davidm@hpl.hp.com>

	* sysdeps/ia64/_mcount.S: Newer kernels don't like register-frames
	with more than 8 output registers.  Fix this by passing original
	ar.pfs to _mcount_ret_helper via r3.

2005-03-15  Jakub Jelinek  <jakub@redhat.com>

	[BZ #786]
	* sysdeps/generic/dl-tls.c (_dl_next_tls_modid): Handle
	GL(dl_tls_static_nelem) == GL(dl_tls_max_dtv_idx).
	* elf/Makefile: Add rules to build and run tst-tls15.
	* elf/tst-tls15.c: New test.
	* elf/tst-tlsmod15a.c: New file.
	* elf/tst-tlsmod15b.c: New file.

2005-03-20  Ulrich Drepper  <drepper@redhat.com>

	* elf/rtld.c (dl_main): Always call init_tls if we have audit modules.

2005-03-20  Alfred M. Szmidt  <ams@gnu.org>

	* elf/dl-open.c (dl_open_worker): Fix typo.

2005-03-20  Ulrich Drepper  <drepper@redhat.com>

	* malloc/malloc.c (public_cALLOc): We cannot skip the memory
	clearing if perturb_byte != 0.

2005-03-20  Jakub Jelinek  <jakub@redhat.com>

	* posix/bits/unistd.h (pread) [__USE_FILE_OFFSET64]: Use __off64_t
	instead of __off_t for last argument.
	* debug/Makefile (tests): Add tst-lfschk{1,2,3}.
	* debug/tst-lfschk1.c: New test.
	* debug/tst-lfschk2.c: New test.
	* debug/tst-lfschk3.c: New test.

2005-02-09  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/bits/termios.h (CMSPAR): Define.
	* sysdeps/unix/sysv/linux/sparc/bits/termios.h: Add __USE_MISC
	and __USE_XOPEN guards to match linux/bits/termios.h.
	* sysdeps/unix/sysv/linux/alpha/bits/termios.h: Likewise.
	(CMSPAR): Define.
	* sysdeps/unix/sysv/linux/powerpc/bits/termios.h: Likewise.

2005-02-10  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #1076]
	* sysdeps/ia64/elf/initfini.c: Add local _init and _fini labels.

2005-02-27  Denis Barbier  <barbier@debian.org>

	[BZ #549]
	* locale/iso-4217.def: Add CSD currency.

2005-03-19  Ulrich Drepper  <drepper@redhat.com>

	* inet/test-ifaddrs.c: Use test-skeleton.
	* inet/test_ifindex.c: Likewise.

	[BZ #821]
	* elf/dl-lookup.c (add_dependency): Always search l_initfini if
	the list exists.

	[BZ #821]
	* elf/Makefile: Add rules to build and run order2.
	* elf/order2.c: New file.
	* elf/order2mod1.c: New file.
	* elf/order2mod2.c: New file.
	* elf/order2mod3.c: New file.
	* elf/order2mod4.c: New file.

2005-03-19  Jakub Jelinek  <jakub@redhat.com>

	[BZ #821]
	* elf/dl-open.c (dl_open_worker): Print exact l_direct_opencount value,
	it has been incremented before.

2005-03-18  Ulrich Drepper  <drepper@redhat.com>

	[BZ #821]
	* elf/dl-fini.c (_dl_fini): Split sorting of the maps in separate
	function _dl_sort_fini.
	(_dl_sort_fini): New function.
	* sysdeps/generic/ldsodefs.h: Declare _dl_sort_fini.
	* elf/dl-close.c (_dl_close): Call _dl_sort_fini before running
	destructors to call them in the right order.

2005-02-07  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/powerpc/bits/link.h (La_ppc64_regs): Add lr_vrsave.
	(La_ppc64_retval): Correct size of lrc_fp.
	* sysdeps/powerpc/powerpc64/dl-trampoline.S (_dl_profile_resolve):
	Fix up ABI problems and complete function.

2005-03-10  Jakub Jelinek  <jakub@redhat.com>

	* math/test-misc.c (main): Add some more tests.

2005-03-17  Jakub Jelinek  <jakub@redhat.com>

	* posix/regcomp.c (re_compile_fastmap_iter): Fix check for failed
	__wcrtomb.  Check return values of other __wcrtomb calls.
	* posix/regex_internal.c (build_wcs_buffer, re_string_skip_chars):
	Change mbclen type to size_t.
	(build_wcs_upper_buffer): Change mbclen and mbcdlen type to size_t.
	Handle mb chars whose upper case doesn't have multibyte representation
	in locale's charset.

2005-03-15  Jakub Jelinek  <jakub@redhat.com>

	* malloc/malloc.c (_int_icalloc, _int_icomalloc, iALLOc,
	public_iCALLOc, public_iCALLOc, public_iCOMALLOc): Protect with
	#ifndef _LIBC.

	[BZ #779]
	* malloc/malloc.c (public_mTRIm): Initialize malloc if not yet
	initialized.

2005-03-10  Jakub Jelinek  <jakub@redhat.com>

	* misc/sys/cdefs.h (__always_inline): Define.
	* posix/bits/unistd.h (read, pread, pread64, readlink, getcwd, getwd):
	Use __always_inline instead of __inline.
	* socket/bits/socket2.h (recv, recvfrom): Likewise.
	* libio/bits/stdio2.h (gets, fgets, fgets_unlocked): Likewise.
	* string/bits/string3.h (__memcpy_ichk, __memmove_ichk, __mempcpy_ichk,
	__memset_ichk, __strcpy_ichk, __stpcpy_ichk, __strncpy_ichk,
	__strcat_ichk, __strncat_ichk): Use __always_inline instead of
	__inline__ __attribute__ ((__always_inline__)).

2005-03-09  Jakub Jelinek  <jakub@redhat.com>

	* debug/tst-chk1.c: Include sys/socket.h and sys/un.h.
	(do_test): Add new tests for recv, recvfrom, getcwd, getwd and
	readlink.  Add some more tests for read, pread, pread64, fgets and
	fgets_unlocked.

	* posix/bits/unistd.h (read, pread, pread64, readlink,
	getcwd, getwd): Change macros into extern inline functions.
	(__read_alias, __pread_alias, __pread64_alias, __readlink_alias,
	__getcwd_alias, __getwd_alias): New prototypes.
	* socket/bits/socket2.h (recv, recvfrom): Change macros into
	extern inline functions.
	(__recv_alias, __recvfrom_alias): New prototypes.
	* libio/bits/stdio2.h (gets, fgets, fgets_unlocked): Change macros
	into extern inline functions.
	(__gets_alias, __fgets_alias, __fgets_unlocked_alias): New prototypes.

	* debug/pread_chk.c (__pread_chk): Fix order of arguments passed
	to __pread.
	* debug/pread64_chk.c (__pread64_chk): Fix order of arguments passed
	to __pread64.

2005-03-18  Daniel Jacobowitz  <dan@codesourcery.com>

	* configure.in: Use %function instead of @function.

2005-03-18  Ulrich Drepper  <drepper@redhat.com>

	[BZ #821]
	* include/link.h (struct link_map): Remove l_opencount.  Add l_removed.
	Change type of l_idx to int.
	* elf/dl-close.c: Basically rewrite.  Do not use l_opencount to
	determine whether a DSO has to be unloaded.  Instead compute this
	in this function.
	* elf/dl-deps.c: No need to manipulate l_opencount anymore.
	* elf/dl-lookup.c: Likewise.
	* elf/rtld.c: Likewise
	* elf/dl-open.c: Likewise.  Use l_init_called to determine whether
	object was just loaded.
	* elf/dl-fini.c: Bump l_direct_opencount instead of l_opencount.
	* elf/dl-load.c (_dl_map_object_from_fd): Do not recognize DSO which
	is about to be unloaded as a match.
	(_dl_map_object): Likewise.
	* elf/do-lookup.h (do_lookup_x): Do not look into DSO which is about
	to be unloaded.
	* elf/circleload1.c: Don't use l_opencount anymore.
	* elf/neededtest.c: Likewise.
	* elf/neededtest2.c: Likewise.
	* elf/neededtest3.c: Likewise.
	* elf/neededtest4.c: Likewise.
	* elf/unload.c: Likewise.
	* elf/unload2.c: Likewise.
	* elf/loadtest.c: Likewise.

	[BZ #821]
	* elf/rtld.c: Preloading errors are now never fatal.

2005-03-08  Jakub Jelinek  <jakub@redhat.com>

	[BZ #821]
	* elf/Makefile: Add rules to build and run unload5 test.
	* elf/unload5.c: New file.

	[BZ #821]
	* elf/Makefile: Add rules to build and run unload4 test.
	* elf/unload4.c: New file.
	* elf/unload4mod1.c: New file.
	* elf/unload4mod2.c: New file.
	* elf/unload4mod3.c: New file.
	* elf/unload4mod4.c: New file.

2005-03-17  Roland McGrath  <roland@redhat.com>

	* nscd/aicache.c (addhstaiX): Tweak type to avoid warning.

2005-03-16  Richard Henderson  <rth@redhat.com>

	[BZ #721]
	* include/libc-symbols.h (__hidden_proto): Remove bogus declaration
	of internal.
	(__hidden_def1, __hidden_dot_def1): Remove.
	(__hidden_def2, __hidden_def3): Remove.
	(__hidden_ver1): New.
	(hidden_ver, hidden_def, hidden_weak): Use it.
	(hidden_data_ver, hidden_data_ver, hidden_data_weak): Use non-data
	version of the macro.

	[BZ #721]
	* include/wchar.h (__wcscoll): Remove.
	* wcsmbs/wcscoll.c: Define wcscoll directly instead of via __wcscoll.
	* string/strcoll.c: Don't issue libc_hidden_def STRCOLL redefined.

2005-03-16  Daniel Jacobowitz  <dan@codesourcery.com>

	* elf/elf.h: Define MIPS TLS relocations.

2005-03-16  Ulrich Drepper  <drepper@redhat.com>

	* elf/circleload1.c (main): Pretty printing.

2005-03-15  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/generic/wordexp.c (exec_comm_child): Add inline keyword.
	Patch by Dan Kegel <dank@kegel.com>.

	[BZ #721]
	* elf/dynamic-link.h (elf_machine_rel, elf_machine_rel_relative,
	elf_machine_rela, elf_machine_rela_relative, elf_machine_lazy_rel):
	Add inline keyword.
	* sysdeps/alpha/dl-machine.h (elf_machine_rela,
	elf_machine_rela_relative, elf_machine_lazy_rel): Add always_inline
	attribute.
	* sysdeps/sparc/sparc32/dl-machine.h (elf_machine_rela,
	elf_machine_rela_relative, elf_machine_lazy_rel): Likewise.  Change
	static inline into auto inline.
	* sysdeps/sparc/sparc64/dl-machine.h (elf_machine_rela,
	elf_machine_rela_relative, elf_machine_lazy_rel): Likewise.
	* sysdeps/generic/dl-machine.h (elf_machine_rel, elf_machine_rela):
	Likewise.
	* sysdeps/arm/dl-machine.h (elf_machine_rel, elf_machine_rel_relative,
	elf_machine_rela, elf_machine_rela_relative, elf_machine_lazy_rel):
	Likewise.

2005-03-15  Jakub Jelinek  <jakub@redhat.com>

	[BZ #789]
	* sysdeps/i386/i686/hp-timing.h (HP_TIMING_ACCUM): Fix asm constraints.
	Remove memory clobber.

	* sysdeps/x86_64/hp-timing.h (HP_TIMING_ACCUM): Make the addition
	thread-safe.  Subtract GLRO(dl_hp_timing_overhead) from Diff.

2005-03-14  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h: Don't include
	asm/types.h.

2005-03-10  GOTO Masanori  <gotom@debian.or.jp>

	* sysdeps/unix/sysv/linux/sh/bits/mman.h: Define MAP_POPULATE and
	MAP_NONBLOCK.
	* sysdeps/unix/sysv/linux/sparc/bits/mman.h: Likewise.
	Correct MAP_GROWSDOWN value.

2005-03-13  Roland McGrath  <roland@redhat.com>

	* elf/tls-macros.h: #include_next <tls-macros.h> to get a sysdeps
	version if there is one.  Only #error if macros are then undefined.
	* sysdeps/generic/tls-macros.h: New file.

2005-03-10  GOTO Masanori  <gotom@debian.or.jp>

	* sysdeps/hppa/configure.in: Remove old Makefile leftovers.
	* sysdeps/hppa/configure: Regenerated.

2005-03-08  Roland McGrath  <roland@redhat.com>

	* sysdeps/gnu/errlist-compat.awk: Use NERR in all array decls, so
	array types match exactly in C alias decls.

2005-03-07  Ulrich Drepper  <drepper@redhat.com>

	* malloc/arena.c (ptmalloc_init): Recognize MALLOC_PERTURB_ and call
	mallopt appropriately.
	* malloc/malloc.h: Define M_PERTURB.
	* malloc/malloc.c (perturb_byte): New variable.
	(alloc_perturb, free_perturb): New macros.
	(_int_malloc): Before returning, overwrite the memory if this is
	requested.
	(_int_free): Overwrite freed memory if requested.
	(mALLOPt): Handle M_PERTURB.
	* test-skeleton.c: Add call to mallopt with M_PERTURB command.

	* elf/dl-close.c (_dl_close): Decrement l_opencount before
	printing debug message.
	* elf/dl-open.c (dl_open_worker): Always print the new opencount
	in debug messages.

2005-03-06  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-close.c (_dl_close): Unify debug message format.

	* elf/dl-close.c (_dl_close): Print debug message just before
	destroying a link map.

	* elf/do-lookup.h (do_lookup_x): Add namespace info to debug output.
	* elf/dl-version.c (match_symbol): Likewise.

	* posix/bits/unistd.h (pread): Fix typo in __USE_FILE_OFFSET64 code.

	* debug/recv_chk.c (__recv_chk): Always fail if request could
	overflow the buffer.
	* debug/recvfrom_chk.c (__recvfrom_chk): Likewise.
	* socket/bits/socket2.h (recv): Avoid calls to the _chk variant if
	we know the call succeeds.
	(recvfrom): Likewise.

2005-03-05  Ulrich Drepper  <drepper@redhat.com>

	* posix/regexec.c (check_node_accept_bytes): Correct cast to avoid
	warning.
	* posix/regex_internal.c (re_string_reconstruct): Add cast to
	avoid warning.
	(build_wcs_upper_buffer): Change type of bug to plain char.
	* locale/weightwc.h (findidx): Add casts to avoid warnings.
	* time/mktime.c (ranged_convert): Initialize tm to make the
	compiler happy.
	* wcsmbs/mbsrtowcs_l.c (__mbsrtowcs_l): Add casts to avoid warnings.
	* wcsmbs/wcsnrtombs.c (__wcsnrtombs): Add casts to avoid warnings.
	* wcsmbs/mbsnrtowcs.c: Add casts to avoid warnings.
	* wcsmbs/wcsrtombs.c (__wcsrtombs): Add casts to avoid warnings.
	* wcsmbs/wcrtomb.c (__wcrtomb): Add casts to avoid warnings.
	* wcsmbs/mbrtowc.c (__mbrtowc): Use unsigned char for outbuf.
	* wcsmbs/wctob.c (wctob): Make buf array of unsigned char.
	* sysdeps/generic/strchrnul.c: Add cast to avoid warning.
	* libio/iofwide.c: Add casts to avoid warnings.
	* stdio-common/printf-prs.c (parse_printf_format): Introduce new
	variable f to avoid warnings.
	* sysdeps/unix/sysv/linux/x86_64/makecontext.c (__makecontext):
	Fix a few casts to avoid warnings.
	* iconv/gconv_simple.c (internal_utf8_loop): Make start unsigned
	to avoid warning.

	[BZ #1101]
	* posix/regex_internal.c [_LIBC] (build_wcs_buffer): Avoid using
	dynamically sized array.
	(build_wcs_upper_buffer): Likewise.

2005-03-05  Jakub Jelinek  <jakub@redhat.com>

	* include/bits/unistd.h: New file.
	* include/bits/socket2.h: New file.

2005-03-05  Ulrich Drepper  <drepper@redhat.com>

	* sunrpc/key_call.c: Remove doors support.
	* sunrpc/Makefile: Remove CPPFLAGS-key_call.c definition.
	* configure.in: Remove test for doors support which never existed.
	* config.make.in: Remove have_doors entry.

	* configure.in: Make sure at least gcc 3.4 is used.  Undo last change.
	* config.make.in: Undo last change.

	* sysdeps/i386/Makefile (CFLAGS-initfini.s): Unconditionally use
	-mtune.

2005-03-05  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/ldsodefs.h (_dl_out_of_memory_internal): Remove decl.
	(_dl_out_of_memory): Use rtld_hidden_proto.
	* elf/dl-error.c (_dl_out_of_memory): Use rtld_hidden_data_def.
	(_dl_signal_error): Don't use INTUSE on _dl_out_of_memory.
	* elf/dl-open.c (_dl_open): Likewise.
	* elf/dl-deps.c (_dl_map_object_deps): Likewise.

	* sunrpc/des_impl.c (des_set_key): Make first argument unsigned char *.

	* elf/dl-addr.c (_dl_addr): Add a cast.

	[BZ #821]
	* elf/unload3mod4.c: Declare foo.
	* elf/testobj2.c: Include <stdio.h>.

	* sysdeps/gnu/errlist.awk: Emit NERR macro for _sys_nerr_internal
	value constant, and use it in the defn.
	* sysdeps/gnu/errlist-compat.awk: Use NERR in array decl.
	Use actual size for compat array decls.

	* config.make.in (cc-mtune): New substituted variable.
	* configure.in (libc_cv_cc_mtune): New test for -mtune= switch,
	done only if libc_mtune_example is defined.
	* sysdeps/i386/configure.in (libc_mtune_example): Set it.
	* sysdeps/i386/Makefile (CFLAGS-initfini.s): Use $(cc-mtune).

2005-03-05  Jakub Jelinek  <jakub@redhat.com>

	[BZ #721]
	* sysdeps/i386/dl-machine.h (ELF_MACHINE_NO_RELA): Define
	unconditionally to (defined RTLD_BOOTSTRAP).
	* sysdeps/arm/dl-machine.h (ELF_MACHINE_NO_RELA): Likewise.

2005-03-05  Jakub Jelinek  <jakub@redhat.com>

	* Makerules ($(inst_libdir)/libc.so): Use $(slibdir) instead of
	$(inst_slibdir) in AS_NEEDED directive.

2005-03-03  Jakub Jelinek  <jakub@redhat.com>

	* posix/bits/unistd.h (pread, pread64): Don't swap function arguments.

2005-03-01  H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #776]
	* iconv/iconvconfig.c: Fix comment for the output file.
	(write_output): Clear padding in header.

2005-03-03  Ulrich Drepper  <drepper@redhat.com>

	[BZ #821]
	* elf/dl-close.c (_dl_close): Don't try to set up new searchpath if the
	loader is closed.  Fixes unload3.
	* elf/tst-global1.c: New file.
	* elf/Makefile (tests): Add tst-global1.
	* elf/testobj2.c (p): New function.

2005-03-03  Jakub Jelinek  <jakub@redhat.com>

	[BZ #821]
	* elf/Makefile: Add rules to build and run unload3 test.
	* elf/unload3.c: New test.
	* elf/unload3mod1.c: New file.
	* elf/unload3mod2.c: New file.
	* elf/unload3mod3.c: New file.
	* elf/unload3mod4.c: New file.

2005-02-21  Alan Modra <amodra@bigpond.net.au>

	[BZ #1394]
	* sysdeps/unix/sysv/linux/powerpc/sys/procfs.h (elf_vrreg_t): Don't
	use __uint128_t.

2005-03-01  Jakub Jelinek  <jakub@redhat.com>

	* posix/bits/unistd.h (read, pread, pread64): Use __bos0 instead
	of __bos.
	* socket/bits/socket2.h (recv, recvfrom): Likewise.

2005-03-01  Roland McGrath  <roland@redhat.com>

	[BZ #721]
	* sysdeps/arm/dl-machine.h (ELF_MACHINE_NO_RELA): Define this outside
	of [RESOLVE_MAP].

2005-03-01  Alfred M. Szmidt  <ams@gnu.org>

	[BZ #777]
	* elf/dl-load.c (__stack_prot) [!PROT_GROWSUP && !PROT_GROWSDOWN]:
	Add missing initializer.

	[BZ #777]
	* malloc/arena.c: #include <stdbool.h> outside of [SHARED &&
	USE_TLS && !USE___THREAD].

2005-02-26  GOTO Masanori  <gotom@debian.or.jp>

	* csu/Makefile: Use printf instead of echo for some shells.

2005-02-28  Roland McGrath  <roland@redhat.com>

	* debug/warning-nop.c (__nop): Rename to nop, make it static.
	(__warndecl): Use alias attribute directly, instead of strong_alias
	macro.  Add attribute_hidden.

2005-02-28  Ulrich Drepper  <drepper@redhat.com>

	* posix/bits/unistd.h: Avoid calling __*_chk variants if we can
	determine the call will never trigger a failure.
	* debug/read_chk.c (__read_chk): Always fail if the buffer is too
	small.
	* debug/readlink_chk.c (__readlink_chk): Likewise.
	* debug/pread64_chk.c (__pread64_chk): Likewise.
	* debug/pread_chk.c (__pread_chk): Likewise.

	* sysdeps/i386/i686/memset_chk.S: Remove alias and warning.
	* sysdeps/x86_64/memset_chk.S: Likewise.

2005-02-24  Roland McGrath  <roland@redhat.com>

	* debug/Versions (libc: GLIBC_2.4): Remove
	__memset_zero_constant_len_parameter.
	* sysdeps/generic/memset_chk.c: Remove alias and warning.
	* misc/sys/cdefs.h (__warndecl): New macro.
	* debug/warning-nop.c: New file.
	* string/bits/string3.h (memset): Call __warn_memset_zero_len with no
	arguments, instead of calling __memset_zero_constant_len_parameter.
	Use __warndecl for __warn_memset_zero_len.
	* debug/Makefile (routines): Add $(static-only-routines).
	(static-only-routines): New variable.

2005-02-27  Ulrich Drepper  <drepper@redhat.com>

	* po/tr.po: Update from translation team.

2005-02-26  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-addr.c: Cleanups.  Move declaration next to first use.

	* dlfcn/dlerror.c (check_free): New function.  Extract common code
	from fini and free_key_mem.  Check whether this is libdl in the
	base namespace.

2005-02-25  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-lookup.c (_dl_debug_bindings): Add namespace information
	to debug output.

2004-11-11  Richard Sandiford  <rsandifo@redhat.com>

	[BZ #758]
	* sysdeps/unix/sysv/linux/mips/configure.in (asm-unistd.h): Only
	preprocess <asm/unistd.h> if it defines ABI-prefixed syscall names
	like __NR_N32_open.  Just include <asm/unistd.h> otherwise.
	* sysdeps/unix/sysv/linux/mips/configure: Regenerate.
	* sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h: Delete
	* sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h (SYS_ify): Use the
	standard __NR prefix.
	* sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h (SYS_ify): Likewise.
	* sysdeps/unix/sysv/linux/mips/Makefile (syscall-%.h): Rework so that
	the output file is compatible with both pre-2.6 and 2.6 kernel headers.
	Extract separate syscall lists for each ABI.

2005-02-23  Ulrich Drepper  <drepper@redhat.com>

	* Makerules (libc.so): Add AS_NEEDED line for dynamic linker.

	[BZ #719]
	* elf/Makefile: Run tst-tls9-static again.

2005-02-22  Ulrich Drepper  <drepper@redhat.com>

	[BZ #719]
	* sysdeps/generic/libc-tls.c (static_dtv): Size the same as the
	slotinfo array.
	(__libc_setup_tls): Initialize length of DTV based on array length.
	* elf/dl-load.c: Revert last change.
	* sysdeps/generic/dl-tls.c: Revert last change.

	* posix/Makefile (tests): Add tst-execvp1, tst-execvp2, tst-execlp1,
	tst-execlp2, tst-execv1, tst-execv2, tst-execl1, tst-execl2,
	tst-execve1, tst-execve2, tst-execle1, and tst-execle2.
	* posix/tst-execl1.c: New file.
	* posix/tst-execl2.c: New file.
	* posix/tst-execle1.c: New file.
	* posix/tst-execle2.c: New file.
	* posix/tst-execlp1.c: New file.
	* posix/tst-execlp2.c: New file.
	* posix/tst-execv1.c: New file.
	* posix/tst-execv2.c: New file.
	* posix/tst-execve1.c: New file.
	* posix/tst-execve2.c: New file.
	* posix/tst-execvp1.c: New file.
	* posix/tst-execvp2.c: New file.

2005-02-22  Roland McGrath  <roland@redhat.com>

	* include/signal.h: Revert last change.
	(__sigemptyset): Use __builtin_memset instead of memset.

2005-02-22  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/libc_fatal.c (__libc_message): Use
	non-cancelable I/O functions.

2005-02-22  Jakub Jelinek  <jakub@redhat.com>

	[BZ #769]
	* nscd/nscd-client.h: Include sys/uio.h.
	(__readall, __readvall, writeall): New prototypes.
	* nscd/connections.c (writeall): New function.
	(handle_request): Use it.
	* nscd/aicache.c (addhstaiX): Likewise.
	* nscd/initgrcache.c (addinitgroupsX): Likewise.
	* nscd/hstcache.c (cache_addhst): Likewise.
	* nscd/grpcache.c (cache_addgr): Likewise.
	* nscd/pwdcache.c (cache_addpw): Likewise.
	* nscd/nscd_helper.c (__readall, __readvall): New functions.
	* nscd/nscd_getai.c (__nscd_getai): Use them.
	* nscd/nscd_getpw_r.c (__nscd_getpw_r): Likewise.
	* nscd/nscd_getgr_r.c (__nscd_getgr_r): Likewise.
	* nscd/nscd_gethst_r.c (__nscd_gethst_r): Likewise.
	* nscd/nscd_initgroups.c (__nscd_getgrouplist): Likewise.

2005-02-22  Roland McGrath  <roland@redhat.com>

	* include/sys/socket.h: Declare __recv.
	* sysdeps/generic/recv.c (recv): Rename to __recv, and add weak alias.
	* sysdeps/mach/hurd/recv.c: Likewise.

	* sysdeps/unix/sysv/linux/libc_fatal.c: Include <execinfo.h> for
	__backtrace_* decls.

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
	(INTERNAL_SYSCALL_ERROR_P): Evalute VAL.  Parenthesize ERR.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h: Likewise.

	* include/signal.h: Include <string.h> for memset decl.

2005-02-22  Andreas Schwab  <schwab@suse.de>

	* posix/execvp.c (execvp): Fix invalid free.

2005-02-22  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1095]
	* malloc/Makefile (CFLAGS-mcheck-init.c): Add.
	* sunrpc/Makefile: Add $(PIC-ccflag) to CFLAGS-x* for
	librpcsvc.a objects.

2005-02-21  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1107]
	* iconvdata/ibm930.h: Correct Yen mapping.
	* iconvdata/ibm939.h: Likewise.
	* iconvdata/testdata/IBM930..UTF8: Adjust test data.
	* iconvdata/testdata/IBM939..UTF8: Likewise.
	Patch by Jiro Sekiba <SEKIBA@jp.ibm.com>.

	* iconvdata/Makefile (modules): Add IBM1025, IBM1122, IBM1137, IBM1153,
	IBM1154, IBM1155, IBM1156, IBM1157, and IBM1158.
	(distribute): Add ibm1025.c, ibm1025.h, ibm1122.c, ibm1122.h,
	ibm1137.c, ibm1137.h, ibm1153.c, ibm1153.h, ibm1154.c, ibm1154.h,
	ibm1155.c, ibm1155.h, ibm1156.c, ibm1156.h, ibm1157.c, ibm1157.h,
	ibm1158.c, and ibm1158.h.
	* iconvdata/TESTS: Add IBM1025, IBM1122, IBM1137, IBM1153,
	IBM1154, IBM1155, IBM1156, IBM1157, and IBM1158.
	* iconvdata/gconv-modules: Likewise.
	* iconvdata/ibm1025.c: New file.
	* iconvdata/ibm1025.h: New file.
	* iconvdata/ibm1122.c: New file.
	* iconvdata/ibm1122.h: New file.
	* iconvdata/ibm1137.c: New file.
	* iconvdata/ibm1137.h: New file.
	* iconvdata/ibm1153.c: New file.
	* iconvdata/ibm1153.h: New file.
	* iconvdata/ibm1154.c: New file.
	* iconvdata/ibm1154.h: New file.
	* iconvdata/ibm1155.c: New file.
	* iconvdata/ibm1155.h: New file.
	* iconvdata/ibm1156.c: New file.
	* iconvdata/ibm1156.h: New file.
	* iconvdata/ibm1157.c: New file.
	* iconvdata/ibm1157.h: New file.
	* iconvdata/ibm1158.c: New file.
	* iconvdata/ibm1158.h: New file.
	* iconvdata/testdata/IBM1025: New file.
	* iconvdata/testdata/IBM1025..UTF8: New file.
	* iconvdata/testdata/IBM1122: New file.
	* iconvdata/testdata/IBM1122..UTF8: New file.
	* iconvdata/testdata/IBM1137: New file.
	* iconvdata/testdata/IBM1137..UTF8: New file.
	* iconvdata/testdata/IBM1153: New file.
	* iconvdata/testdata/IBM1153..UTF8: New file.
	* iconvdata/testdata/IBM1154: New file.
	* iconvdata/testdata/IBM1154..UTF8: New file.
	* iconvdata/testdata/IBM1155: New file.
	* iconvdata/testdata/IBM1155..UTF8: New file.
	* iconvdata/testdata/IBM1156: New file.
	* iconvdata/testdata/IBM1156..UTF8: New file.
	* iconvdata/testdata/IBM1157: New file.
	* iconvdata/testdata/IBM1157..UTF8: New file.
	* iconvdata/testdata/IBM1158: New file.
	* iconvdata/testdata/IBM1158..UTF8: New file.
	Contributed by Jiro Sekiba <SEKIBA@jp.ibm.com>.

2005-02-10  Paolo Bonzini  <bonzini@gnu.org>

	* posix/regcomp.c (lower_subexp): Do not optimize empty
	subexpressions even with REG_NOSUB.
	* posix/rxspencer/tests: Add a previously failing testcase.

2005-02-21  Alan Modra <amodra@bigpond.net.au>

	[BZ #719]
	* elf/dl-reloc.c (_dl_nothread_init_static_tls): Assert that dtv
	array index is within bounds.

2005-02-21  Ulrich Drepper  <drepper@redhat.com>

	[BZ #719]
	* elf/dl-load.c: Do not allow PT_TLS in modules loaded in statically
	linked code.
	* sysdeps/generic/dl-tls.c [!SHARED]: Don't build _dl_next_tls_modid.
	* elf/Makefile: Remove rules to build and run tst-tls9-static.

	[BZ #719]
	* elf/dl-reloc.c (_dl_nothread_init_static_tls): Avoid using
	THREAD_DTV multiple times, this minimally reduces code size on
	some archs.

2005-02-21  Jakub Jelinek  <jakub@redhat.com>

	[BZ #768]
	* nscd/nscd_gethst_r.c (nscd_gethst_r): Set *h_errnop to
	NETDB_INTERNAL if buffer is too small.

	[BZ #768]
	* nscd/hstcache.c (INCR): Remove.
	(addhstbyX): Double buflen in each iteration rather than add INCR.
	* nscd/grpcache.c: Likewise.
	* nscd/pwdcache.c: Likewise.

2005-02-21  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/libc_fatal.c: Print backtrace and memory
	map if requested.
	* debug/chk_fail.c: Request backtrace and memory map dump.

	* Versions.def: Add GLIBC_2.4 for libc.
	* debug/fgets_chk.c: New file.
	* debug/fgets_u_chk.c: New file.
	* debug/getcwd_chk.c: New file.
	* debug/getwd_chk.c: New file.
	* debug/readlink_chk.c: New file.
	* debug/read_chk.c: New file.
	* debug/pread_chk.c: New file.
	* debug/pread64_chk.c: New file.
	* debug/recv_chk.c: New file.
	* debug/recvfrom_chk.c: New file.
	* debug/Versions: Add all new functions with version GLIBC_2.4.
	* debug/Makefile (routines): Add fgets_chk, fgets_u_chk, read_chk,
	pread_chk, pread64_chk, recv_chk, recvfrom_chk, readlink_chk,
	getwd_chk, and getcwd_chk.  Plus appropriate CFLAGS definitions.
	* debug/tst-chk1.c: Add more tests.
	* libio/bits/stdio2.h: Add macros for fgets and fgets_unlocked.
	* include/stdio.h: Declare __fgets_chk and __fgets_unlocked_chk.
	* posix/unistd.h: Include <bits/unistd.h> for fortification.
	* posix/bits/unistd.h: New file.
	* posix/Makefile (headers): Add bits/unistd.h.
	* socket/sys/socket.h: Include <bits/socket2.h> for fortification.
	* socket/bits/socket2.h: New file.
	* socket/Makefile (headers): Add bits/socket2.h.

	* string/bits/string3.h: Extend memset macro to check for zero 3rd
	parameter and use __memset_zero_constant_len_parameter in that case.
	* sysdeps/generic/memset_chk.c: Add
	__memset_zero_constant_len_parameter alias and linker warning.
	* debug/Versions: Add __memset_zero_constant_len_parameter to libc
	with version GLIBC_2.4.

	* sysdeps/generic/bits/types.h: Don't unnecessarily use __extension__
	in __STD_TYPE definition.

2005-02-21  Jakub Jelinek  <jakub@redhat.com>

	* malloc/malloc.c (malloc_printerr): If MALLOC_CHECK_={5,7}, print
	the error message rather than program name.

2005-02-21  Ulrich Drepper  <drepper@redhat.com>

	[BZ #767]
	* posix/unistd.h: symlink and readlink are unconditionally
	available in the 2001 spec.

2005-02-16  Roland McGrath  <roland@redhat.com>

	* intl/dcigettext.c (_nl_find_msg): Add a cast.

	* nis/nis_clone_dir.c (nis_clone_directory): Use char * for ADDR.
	* nis/nis_clone_obj.c (nis_clone_object): Likewise.
	* nis/nis_clone_res.c (nis_clone_result): Likewise.

	* resolv/nss_dns/dns-network.c (getanswer_r): Use const unsigned char *
	for END_OF_MESSAGE and CP.

	* resolv/res_send.c (send_dg): Add else branch for case impossible
	unless `poll' is buggy.

	* crypt/crypt_util.c (__setkey_r): Add a cast.

	* locale/programs/linereader.c (get_toplvl_escape): Use size_t for
	NBYTES, and unsigned char * for BYTES.

	* locale/programs/charmap.c (charmap_new_char): Use size_t and
	unsighed char * for NBYTES, BYTES parameters.

	* sysdeps/generic/dl-hash.h (_dl_elf_hash): Take const char * argument
	and cast it.
	* sysdeps/i386/i686/dl-hash.h (_dl_elf_hash): Likewise.

	* sunrpc/create_xid.c (_create_xid): Don't use unsigned long for RES.

	* sunrpc/svcauth_des.c (_svcauth_des): Fix cast type.

	* sunrpc/auth_des.c (authdes_create): Don't use u_char for PKEY_DATA.
	(authdes_marshal): Don't use unsigned int for LEN.
	* sunrpc/xdr.c (xdr_hyper): Don't use unsigned long for T2.
	(xdr_u_hyper): Likewise.
	(xdr_u_short): Don't use u_long for L.
	* sunrpc/xdr_intXX_t.c (xdr_int64_t): Don't use uint32_t for T2.

	* inet/rexec.c (rexec_af): Use socklen_t.
	* sunrpc/key_call.c (getkeyserv_handle): Likewise.
	* sunrpc/rtime.c (rtime): Likewise.
	* resolv/res_send.c (send_vc, send_dg): Likewise.
	* nis/nis_callback.c (__nis_create_callback): Likewise.

	* sysdeps/generic/libc-start.c: Use unsigned int for nthreads ptr.

	* sysdeps/posix/getaddrinfo.c (gaih_inet): Fix type of ADDR local.

	* libio/libio.h (_IO_BE): Add parenthesis around EXPR.

	* intl/dcigettext.c (INTVARDEF, INTUSE): Macros removed.
	(_nl_default_dirname): Use libc_hidden_data_def instead of INTVARDEF.
	(libc_freeres_fn, DCIGETTEXT): Don't use INTUSE.
	* intl/bindtextdom.c (INTUSE): Macro removed.
	(_nl_default_dirname): Use libc_hidden_proto.
	(set_binding_values): Don't use INTUSE.
	* include/libintl.h (_libc_intl_domainname_internal): Decl removed.
	(_libc_intl_domainname): Use libc_hidden_proto.
	* posix/regex_internal.h (gettext): Remove INTUSE on it.
	* locale/SYS_libc.c (_libc_intl_domainname): Use libc_hidden_data_def
	rather than INTDEF.
	* include/libintl.h (_): Don't use *_internal name.

	* ctype/ctype-extn.c (__ctype_tolower, __ctype_toupper): Use int32_t,
	not uint32_t.
	* locale/lc-ctype.c (_nl_postload_ctype): Likewise for assignments.

	* iconv/gconv_open.c (__gconv_open): Remove useless cast.

	[BZ #721]
	* sysdeps/i386/dl-machine.h (ELF_MACHINE_NO_RELA): Define this outside
	of [RESOLVE_MAP].
	* sysdeps/sh/dl-machine.h (ELF_MACHINE_NO_REL): Likewise.
	* sysdeps/powerpc/powerpc32/dl-machine.h
	(elf_machine_rel, elf_machine_rel_relative): Removed.
	* sysdeps/powerpc/powerpc64/dl-machine.h
	(elf_machine_rel, elf_machine_rel_relative): Removed.

2005-02-03  Alexandre Oliva  <aoliva@redhat.com>

	[BZ #721]
	* elf/dynamic-link.h: Don't declare nested auto functions that are
	not going to be defined.

2004-07-23  Jakub Jelinek  <jakub@redhat.com>

	[BZ #284]
	* include/features.h (_POSIX_SOURCE, _POSIX_C_SOURCE): Define
	if _XOPEN_SOURCE >= 500 even if __STRICT_ANSI__ is defined.

2005-02-16  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/libc-start.c (LIBC_START_MAIN): Move UBP_EV defn
	inside [! SHARED] where it's used.

2005-02-15  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/bits/byteswap.h: Make sure result of all the
	functions and macros is unsigned.

2005-02-11  Barry deFrese  <bddebian@comcast.net>

	[BZ #722]
	* sysdeps/mach/hurd/setresgid.c: Use weak_alias.
	* sysdeps/mach/hurd/setresuid.c: Likewise.

2005-02-14  GOTO Masanori  <gotom@debian.or.jp>

	* misc/sys/syslog.h: Fix typo in comment.

2005-02-14  Roland McGrath  <roland@redhat.com>

	[BZ #720]
	* sysdeps/unix/sysv/linux/sys/kd.h: Don't leave _LINUX_TYPES_H defined
	if it wasn't originally.

2005-02-14  GOTO Masanori  <gotom@debian.or.jp>

	* sysdeps/unix/sysv/linux/alpha/syscalls.list: Remove the duplicated
	getpeername entry.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Likewise.

2005-02-11  Jakub Jelinek  <jakub@redhat.com>

	* scripts/soversions.awk: Only record first WORDSIZE{32,64}
	matching line.

2005-02-14  Alan Modra  <amodra@bigpond.net.au>

	[BZ #721]
	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Define
	with auto inline, and attribute always_inline.
	(elf_machine_rela_relative, elf_machine_lazy_rel): Likewise.
	(elf_machine_rel, elf_machine_rel_relative): Likewise.
	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_rela): Likewise.
	(elf_machine_rela_relative, elf_machine_lazy_rel): Likewise.
	(elf_machine_rel, elf_machine_rel_relative): Likewise.
	(elf_machine_tprel): Likewise.

2005-02-14  Andreas Schwab  <schwab@suse.de>

	* manual/filesys.texi (Random Access Directory): Fix type of file
	position value for telldir and seekdir.
	(Attribute Meanings): Fix typo.

2005-02-14  H.J. Lu  <hongjiu.lu@intel.com>

	* csu/elf-init.c (__libc_csu_fini): Enable if LIBC_NONSHARED
	isn't defined.
	* sysdeps/generic/libc-start.c (LIBC_START_MAIN): Call fini
	if SHARED isn't defined.
	* elf/Makefile (tests-static): Add tst-array1-static.
	($(objpfx)tst-array1-static.out): New target.
	* elf/tst-array1-static.c: New file.

2005-02-11  Jakub Jelinek  <jakub@redhat.com>

	[BZ #1100]
	* debug/chk_fail.c (__chk_fail): Add a while (1) loop around
	__libc_message to kill GCC warning about noreturn function returning.

	* elf/rtld.c (dlmain): If LD_TRACE_PRELINKING, clear l_relocated flag
	before relocating ld.so again.

	* elf/rtld.c (_dl_start): Set bootstrap_map.l_relocated even
	for already prelinked ld.so.

2005-02-11  Roland McGrath  <roland@redhat.com>

	[BZ #715]
	* Makefile (installed-stubs): New variable.
	Set to $(inst_includedir)/gnu/stubs.h if $(biarch) is no,
	or to $(inst_includedir)/gnu/stubs-$(biarch).h if otherwise.
	[$(biarch) != no] (install-others-nosubdir): Add $(installed-stubs).
	($(inst_includedir)/gnu/stubs.h): Use $(installed-stubs) for this
	rule's target.
	($(inst_includedir)/gnu/stubs.h): New target, install from ...
	* include/stubs-biarch.h: New file.

	* shlib-versions (i.86-.*-.*): Add WORDSIZE64 line mapping to x86_64.

	* Makeconfig ($(common-objpfx)soversions.mk): Depend on Makeconfig.
	Emit defn for variable `biarch'.

	* include/stub-tag.h: Update comment.

	* scripts/soversions.awk: Fix default version set handling.

2005-02-10  Roland McGrath  <roland@redhat.com>

	[BZ #157]
	* include/libc-symbols.h (stub_warning): Emit a marker section called
	.gnu.glibc-stub.NAME.
	* Makerules ($(objpfx)stubs): Depend on object files, not dep files.
	Use objdump to collect those marker section names.
	($(common-objpfx)shlib.lds): Discard .gnu.glibc-stub.* sections.

	* Rules (subdir_objs, subdir_stubs): New phony targets.
	* Makefile (+subdir_targets): Add them.

	* Makerules ($(common-objpfx)Versions.all): Grok new leading column in
	soversions.i.

	* scripts/lib-names.awk: Consider [0-9].* a "number", not just [0-9]+.
	Reported by H.J. Lu <hongjiu.lu@intel.com>.

	* scripts/lib-names.awk: Always print WORDSIZE32 section first when
	doing two.

2005-02-10  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/powerpc/powerpc32/bits/link.h: Removed.
	* sysdeps/powerpc/powerpc64/bits/link.h: Moved to...
	* sysdeps/powerpc/bits/link.h: ... here.  New file.

2005-02-09  Jakub Jelinek  <jakub@redhat.com>

	[BZ #710]
	* stdlib/random_r.c (__initstate_r): Save old state.
	* stdlib/Makefile (tests): Add tst-random2.
	* stdlib/tst-random2.c: New test.
	Reported by Peter Bergner <bergner@vnet.ibm.com>.

2005-01-25  H.J. Lu  <hongjiu.lu@intel.com>

	* dlfcn/dlfcn.c (init): Put it in .init_array section.

2005-02-10  Roland McGrath  <roland@redhat.com>

	[BZ #632]
	* scripts/soversions.awk: Expect cpu, vendor, os as separate variables
	from command line.
	Grok shlib-versions lines with WORDSIZE* in second column.
	Add new leading column to output, DEFAULT for existing output lines.
	Also emit lines with WORDSIZE* for alternate configurations.
	* Makeconfig ($(common-objpfx)soversions.i): Pass those variables.
	($(common-objpfx)soversions.mk): Grok new column, use only DEFAULT.
	($(common-objpfx)gnu/lib-names.stmp): Depend on soversions.i instead
	of soversions.mk; replace inline shell script with use of ...
	* scripts/lib-names.awk: New file.  If input has non-DEFAULT lines,
	emit multiple sets of macros under #if.
	* shlib-versions (x86_64-.*-.*): Add WORDSIZE32 line mapping to i686.
	(s390x-.*-.*): Likewise for s390.
	(powerpc64-.*-.*): Likewise for powerpc.
	(sparc64-.*-.*): Likewise for sparc.
	(s390-.*-.*, powerpc.*-.*-.*, sparc.*-.*-.*): Add WORDSIZE64 entries
	for these mapping back to the above.

2005-02-08  Jakub Jelinek  <jakub@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Fix a typo.

2005-02-08  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/dl-machine.h (elf_machine_rela): Remove use of
	RESOLVE.

2005-02-07  Richard Henderson  <rth@redhat.com>

	[BZ #721]
	* iconvdata/jis0208.h (struct jisx0208_ucs_idx): Move before use.

2005-02-08  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/sh/dl-machine.h (elf_machine_rela): Remove code using
	RESOLVE.

2005-02-07  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Make sure registers are
	set correctly.

2005-01-07  Richard Henderson  <rth@redhat.com>

	[BZ #721]
	* math/math_private.h (__copysign): Define as builtin for gcc 4.
	(__copysignf, __copysignl): Likewise.
	* sysdeps/alpha/fpu/bits/mathinline.h (copysign): Don't define
	for gcc 4.0.
	(copysignf, copysignl, fabsf, fabs): Likewise.
	(__copysign, __copysignf, __copysignl): Remove.
	(__fabs, __fabsf): Remove.

2005-01-07  Jakub Jelinek  <jakub@redhat.com>

	[BZ #738]
	* elf/dl-load.c (open_path): If rtld_search_dirs is in RELRO segment,
	avoid writing to it if none of the standard search directories exist.

2005-02-07  Steven Munroe  <sjmunroe@us.ibm.com>

	[BZ #700]
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/setcontext.S
	(__novec_setcontext, __setcontext): Fix typo so CCR is restored.
	Load MSR as a doubleword.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/swapcontext.S
	(__novec_swapcontext, __swapcontext): Likewise.

2005-02-07  Ulrich Drepper  <drepper@redhat.com>

	* iconv/iconv_prog.c (main): Provide more help in case on an error.

	* sysdeps/unix/sysv/linux/i386/sysdep.h (check_consistency): Define.

2005-02-07  Jakub Jelinek  <jakub@redhat.com>

	[BZ #741]
	* nscd/nscd.c (termination_handler): Avoid segfault if some database
	is not enabled.

	[BZ #741]
	* nscd/nscd_getai.c (__nscd_getai): If ai_resp->found == -1, set
	__nss_not_use_nscd_hosts and return -1.
	* nscd/nscd_initgroups.c (__nscd_getgrouplist): If
	initgr_resp->found == -1, set __nss_not_use_nscd_group and return -1.
	Avoid leaking sockets.

2005-01-28  Andreas Schwab  <schwab@suse.de>
	    H.J. Lu  <hongjiu.lu@intel.com>

	[BZ #677]
	* elf/dl-runtime.c (fixup): Change return type to
	DL_FIXUP_VALUE_TYPE. Use DL_FIXUP_VALUE_TYPE,
	DL_FIXUP_MAKE_VALUE and DL_FIXUP_VALUE_CODE_ADDR for relocation
	values. Use DL_FIXUP_VALUE_ADDR and DL_FIXUP_ADDR_VALUE to
	store and retrieve relocation values.
	(profile_fixup): Likewise.
	* include/link.h (link_map): Use DL_FIXUP_VALUE_TYPE for
	l_reloc_result.
	* sysdeps/generic/dl-fptr.h (link_map): Forward declaration.
	* sysdeps/generic/dl-lookupcfg.h (DL_FIXUP_VALUE_TYPE): New.
	(DL_FIXUP_MAKE_VALUE): Likewise.
	(DL_FIXUP_VALUE_CODE_ADDR): Likewise.
	(DL_FIXUP_VALUE_ADDR): Likewise.
	(DL_FIXUP_ADDR_VALUE): Likewise.
	* sysdeps/ia64/dl-lookupcfg.h: Include <dl-fptr.h> for "struct fdesc".
	(DL_FIXUP_VALUE_TYPE): New.
	(DL_FIXUP_MAKE_VALUE): Likewise.
	(DL_FIXUP_VALUE_CODE_ADDR): Likewise.
	(DL_FIXUP_VALUE_ADDR): Likewise.
	(DL_FIXUP_ADDR_VALUE): Likewise.
	* sysdeps/ia64/dl-machine.h (elf_machine_profile_fixup_plt): Removed.
	(elf_machine_profile_plt): Removed.
	(elf_machine_fixup_plt): Change return type and type of value
	parameter to struct fdesc.
	(elf_machine_plt_value): Likewise.
	(elf_machine_rela): Use DL_FIXUP_MAKE_VALUE to construct
	argument for elf_machine_fixup_plt.

2005-02-07  Jakub Jelinek  <jakub@redhat.com>

	[BZ #742]
	* nscd/nscd.init (reload): Print Reloading nscd: before and a newline
	after the status string printed by killproc.

2004-11-18  Alexandre Oliva  <aoliva@redhat.com>

	* manual/.cvsignore: Add dir-add.texi.

2005-02-06  Richard Henderson  <rth@redhat.com>

	* sysdeps/alpha/dl-machine.h (elf_machine_rela): Use RESOLVE_MAP
	all the time.

2004-11-03  Marcus Brinkmann  <marcus@gnu.org>

	* configure.in (sysnames): Append sysdeps/generic for each add-on.
	* configure: Regenerated.

2005-02-02  Alfred M. Szmidt  <ams@gnu.org>

	* sysdeps/mach/hurd/tls.h: Include <stdbool.h>
	(dtv_t): Change pointer type to be a struct which also contains
	information whether the memory pointed to is static TLS or not.

	* sysdeps/generic/syslog.c (send_flags) [!send_flags]: Define it.

	* shadow/sgetspent_r.c (FALSE): Macro renamed to ...
	(FALSEP): ... this.  Updated all references.

	[BZ #765]
	* libio/fmemopen.c: Include <stdint.h>.

2005-01-30  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1103]
	* nscd/nscd_helper.c (get_mapping): Use MSG_NOSIGNAL if available.
	* nscd/connections.c (send_ro_fd): Likewise.

2005-01-28  H.J. Lu  <hongjiu.lu@intel.com>

	* elf/tst-auditmod1.c: Add ia64 entries.
	* sysdeps/generic/ldsodefs.h (La_ia64_regs): New.
	(La_ia64_retval): New.
	(audit_ifaces): Add ia64 entries.
	* sysdeps/ia64/bits/link.h: New file.
	* sysdeps/ia64/dl-machine.h (elf_machine_runtime_setup): Test
	for dl_profile non-null.
	(ARCH_LA_PLTENTER): New.
	(ARCH_LA_PLTEXIT): New.
	* sysdeps/ia64/dl-trampoline.S (_dl_runtime_resolve): Allocate
	only 2 output registers. Allocate stack to save/restore
	8 incoming fp registers. Call _dl_fixup instead of fixup.
	(_dl_runtime_profile): Rewrite.

2005-01-28  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/s390/bits/link.h: New file.
	* sysdeps/s390/s390-32/dl-trampoline.S: New file.
	* sysdeps/s390/s390-64/dl-trampoline.S: New file.
	* sysdeps/s390/s390-32/dl-machine.h: Move PLT trampolines to
	dl-trampoline.S. Use RESOLVE_MAP instead of RESOLVE to protect
	relocation code.
	(elf_machine_runtime_setup): Test for dl_profile non-null.
	(elf_machine_rela): Remove code using RESOLVE.
	(ARCH_LA_PLTENTER, ARCH_LA_PLTEXIT): New.
	* sysdeps/s390/s390-64/dl-machine.h: Likewise.
	* sysdeps/generic/ldsodefs.h (La_s390_32_regs, La_s390_32_retval,
	La_s390_64_regs, La_s390_64_retval): New.
	* elf/tst-auditmod1.c: Add s390 entries.

	[BZ #743]
	* sysdeps/s390/bits/string.h (strlen, strncpy, strcat, strncat,
	strncat, memchr, strcmp): Add missing memory clobber.

2005-01-27  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/oldglob.c (__old_globfree): Also
	copy gl_offs.  Patch by Sergey Tikhonov <tsv@solvo.ru>.

2005-01-27  Paolo Bonzini  <bonzini@gnu.org>

	[BZ #558]
	* posix/regcomp.c (calc_inveclosure): Return reg_errcode_t.
	Initialize the node sets in dfa->inveclosures.
	(analyze): Initialize inveclosures only if it is needed.
	Check errors from calc_inveclosure.
	* posix/regex_internal.c (re_dfa_add_node): Do not initialize
	the inveclosure node set.
	* posix/regexec.c (re_search_internal): If nmatch includes unused
	subexpressions, reset them to { rm_so: -1, rm_eo: -1 } here.

	* posix/regcomp.c (parse_bracket_exp) [!RE_ENABLE_I18N]:
	Do build a SIMPLE_BRACKET token.

	* posix/regexec.c (transit_state_mb): Do not examine nodes
	where ACCEPT_MB is not set.

2005-01-27  Jakub Jelinek  <jakub@redhat.com>

	* stdlib/tst-fmtmsg.c: Include stdlib.h.
	* stdio-common/tst-fmemopen2.c: Include string.h.
	* posix/execvp.c: Include stdbool.h.

2004-12-13  Paolo Bonzini  <bonzini@gnu.org>

	Separate parsing and creation of the NFA.  Avoided recursion on
	the (very unbalanced) parse tree.
	[BZ #611]
	* posix/regcomp.c (struct subexp_optimize, analyze_tree, calc_epsdest,
	re_dfa_add_tree_node, mark_opt_subexp_iter): Removed.
	(optimize_subexps, duplicate_tree, calc_first, calc_next,
	mark_opt_subexp): Rewritten.
	(preorder, postorder, lower_subexps, lower_subexp, link_nfa_nodes,
	create_token_tree, free_tree, free_token): New.
	(analyze): Accept a regex_t *.  Invoke the passes via the preorder and
	postorder generic visitors.  Do not initialize the fields in the
	re_dfa_t that represent the transitions.
	(free_dfa_content): Use free_token.
	(re_compile_internal): Analyze before UTF-8 optimizations.  Do not
	include optimization of subexpressions.
	(create_initial_state): Fetch the DFA node index from the first node's
	bin_tree_t *.
	(optimize_utf8): Abort on unexpected nodes, including OP_DUP_QUESTION.
	Return on COMPLEX_BRACKET.
	(duplicate_node_closure): Fix comment.
	(duplicate_node): Do not initialize the fields in the
	re_dfa_t that represent the transitions.
	(calc_eclosure, calc_inveclosure): Do not handle OP_DELETED_SUBEXP.
	(create_tree): Remove final argument.  All callers adjusted.  Rewritten
	to use create_token_tree.
	(parse_reg_exp, parse_branch, parse_expression, parse_bracket_exp,
	build_charclass_op): Use create_tree or create_token_tree instead
	of re_dfa_add_tree_node.
	(parse_dup_op): Likewise.  Also free the tree using free_tree for
	"<re>{0}", and lower OP_DUP_QUESTION to OP_ALT: "a?" is equivalent
	to "a|".  Adjust invocation of mark_opt_subexp.
	(parse_sub_exp): Create a single SUBEXP node.
	* posix/regex_internal.c (re_dfa_add_node): Remove last parameter,
	always perform as if it was 1.  Do not initialize OPT_SUBEXP and
	DUPLICATED, and initialize the DFA fields representing the transitions.
	* posix/regex_internal.h (re_dfa_add_node): Adjust prototype.
	(re_token_type_t): Move OP_DUP_PLUS and OP_DUP_QUESTION to the tokens
	section.  Add a tree-only code SUBEXP.  Remove OP_DELETED_SUBEXP.
	(bin_tree_t): Include a full re_token_t for TOKEN.  Turn FIRST and
	NEXT into pointers to trees.  Remove ECLOSURE.

2004-12-28  Paolo Bonzini  <bonzini@gnu.org >

	[BZ #605]
	* posix/regcomp.c (parse_bracket_exp): Do not modify DFA nodes
	that were already created.
	* posix/regex_internal.c (re_dfa_add_node): Set accept_mb field
	in the token if needed.
	(create_ci_newstate, create_cd_newstate): Set accept_mb field
	from the tokens' field.
	* posix/regex_internal.h (re_token_t): Add accept_mb field.
	(ACCEPT_MB_NODE): Removed.
	* posix/regexec.c (proceed_next_node, transit_states_mb,
	build_sifted_states, check_arrival_add_next_nodes): Use
	accept_mb instead of ACCEPT_MB_NODE.

2005-01-26  Ulrich Drepper  <drepper@redhat.com>

	[BZ #1100]
	* debug/chk_fail.c (__chk_fail): Print program name in final message.

	* sysdeps/unix/sysv/linux/kernel-features.h: Found reference to
	MSG_NOSIGNAL being in 2.2 kernels.

2005-01-26  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h
	(SYSCALL_ERROR_HANDLER_TLS_STORE): Remove unnecessary 0 imm.

	[BZ #693]
	* posix/regex_internal.h (DUMMY_CONSTRAINT): Rename to...
	(WORD_DELIM_CONSTRAINT): ...this.
	(NOT_WORD_DELIM_CONSTRAINT): Define.
	(re_context_type): Add INSIDE_NOTWORD and NOT_WORD_DELIM,
	change WORD_DELIM to use WORD_DELIM_CONSTRAINT.
	* posix/regcomp.c (peek_token): For \B create NOT_WORD_DELIM
	anchor instead of INSIDE_WORD.
	(parse_expression): Handle NOT_WORD_DELIM constraint.
	* posix/bug-regex19.c (tests): Adjust tests that relied on \B
	being inside word instead of not word delim.
	* posix/tst-rxspencer.c (mb_frob_pattern): Don't frob escaped
	characters.
	* posix/rxspencer/tests: Add some new tests.

2005-01-14  GOTO Masanori  <gotom@debian.or.jp>

	[BZ #1108]
	* sunrpc/rpc_main.c (s_output): Generate #include <rpc/pmap_clnt.h>
	irrespective of Cflag.

	* manual/memory.texi (sbrk): Fix definition.
	* manual/string.texi (strcasestr): Fix example typo.

2005-01-25  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/syslog.c [NO_SIGPIPE]: Protect sigpipe_handler decl.

2005-01-23  Roland McGrath  <roland@redhat.com>

	[BZ #737]
	* sysdeps/i386/Makefile (defines): If -mno-tls-direct-seg-refs appears
	in $(CFLAGS), add -DNO_TLS_DIRECT_SEG_REFS.
	* sysdeps/unix/sysv/linux/i386/sysdep.h [USE___THREAD]
	(SYSCALL_ERROR_HANDLER) [NO_TLS_DIRECT_SEG_REFS]: Load thread pointer
	from %gs:0 and add to that value, rather that direct %gs:OFFSET access.
	* sysdeps/unix/i386/sysdep.S [NO_TLS_DIRECT_SEG_REFS]: Likewise.

2005-01-25  Jakub Jelinek  <jakub@redhat.com>

	[BZ #731]
	* stdlib/fmtmsg.c (addseverity): Remove new_string variable.
	(free_mem): Don't free string.
	* stdlib/tst-fmtmsg.c: Include string.h.
	(main): Add some more tests.

2005-01-25  Andreas Schwab  <schwab@suse.de>

	[BZ #736]
	* timezone/asia: Update from tzdata2005c.
	* timezone/backward: Likewise.
	* timezone/europe: Likewise.
	* timezone/leapseconds: Likewise.
	* timezone/northamerica: Likewise.
	* timezone/southamerica: Likewise.

	[BZ #736]
	* timezone/private.h: Update from tzcode2005c.
	* timezone/tzfile.h: Likewise.
	* timezone/zdump.c: Likewise.
	* timezone/zic.c: Likewise.

2005-01-25  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/dl-machine.h (elf_machine_rel): Remove code using
	RESOLVE.
	* sysdeps/x86_64/dl-machine.h (elf_machine_rela): Remove code
	using RESOLVE.
	* elf/rtld.c (_dl_start): Remove RESOLVE definition.

2005-01-25  Alan Modra  <amodra@bigpond.net.au>

	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Test
	sym_map, not sym, against zero.

2005-01-24  Ulrich Drepper  <drepper@redhat.com>

	[BZ #671]
	* misc/syslog.c: Moved to...
	* sysdeps/generic/syslog.c: ...here.
	[NO_SIGIPE]: Don't install SIGPIPE handler.
	* sysdeps/unix/sysv/linux/syslog.c: New file.
	* sysdeps/unix/sysv/linux/kernel-features.h: Define
	__ASSUME_MSG_NOSIGNAL.

2005-01-22  Richard Henderson  <rth@redhat.com>

	* sysdeps/alpha/dl-trampoline.S: New file.
	* sysdeps/alpha/dl-machine.h: Move PLT trampolines there.
	Use RESOLVE_MAP instead of RESOLVE to protect relocation code.
	(elf_machine_runtime_setup): Test for dl_profile non-null.
	(ARCH_LA_PLTENTER, ARCH_LA_PLTEXIT): New.
	* sysdeps/alpha/bits/link.h: New file.
	* sysdeps/generic/ldsodefs.h (La_alpha_regs, La_alpha_retval): New.
	(struct audit_ifaces): Add alpha entries.
	* elf/tst-auditmod1.c: Add alpha entries.

2005-01-22  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/ia64/dl-machine.h: Remove PLT trampolines here.
	* sysdeps/ia64/dl-trampoline.S: New file.

	* sysdeps/x86_64/bits/link.h: Use namespace-safe identifiers in
	La_x86_64_xmm definition.

	* posix/Makefile: Use CFLAGS-*.os instead of CFLAGS-*.c for frame
	pointer option.
	* stdlib/Makefile (CFLAGS-system.os): Use this instead of
	CFLAGS-system.c for frame pointer option.

2005-01-21  Roland McGrath  <roland@redhat.com>

	* elf/dl-runtime.c (_dl_profile_fixup): Remove const from REGS.
	* sysdeps/i386/dl-machine.h: Update decl.

2005-01-21  Jakub Jelinek  <jakub@redhat.com>

	[BZ #735]
	* elf/Makefile: Add rules to build and run tst-align2.
	* elf/tst-align2.c: New test.
	* elf/tst-alignmod2.c: New file.
	* sysdeps/powerpc/tst-stack-align.h: New file.
	* sysdeps/i386/dl-machine.h (RTLD_START): Align stack and clear frame
	pointer before calling _dl_init.
	* sysdeps/x86_64/dl-machine.h (RTLD_START): Likewise.

2005-01-20  Ulrich Drepper  <drepper@redhat.com>

	* posix/execl.c: Do not allocate potentially large buffers on the
	stack.
	* posix/execle.c: Likewise.
	* posix/execlp.c: Likewise.
	* posix/execvp.c: Likewise.
	(script_execute): Removed.
	(allocate_scripts_argv): New function.  Called at most once to
	allocate memory, not every time a script is run.  Adjust caller.

	* sysdeps/generic/wordexp.c (exec_comm): Add a few
	TEMP_FAILURE_RETRY.  Reorganize code to avoid multiple calls to
	exec_comm_child.
	(exec_comm_child): Can now be inlined.

	* posix/Makefile: Add -fomit-frame-pointer for a few more files.
	* stdlib/Makefile: Likewise.

2005-01-19  Roland McGrath  <roland@redhat.com>

	[BZ #681]
	* sunrpc/openchild.c (_openchild): Use NULL instead of 0 for trailing
	argument to execlp.
	Reported by Marcus Meissner <meissner@suse.de>.

2005-01-19  Jakub Jelinek  <jakub@redhat.com>

	* hurd/sigunwind.c (_hurdsig_longjmp_from_handler): Fix a typo
	in assert.
	* iconv/strtab.c (strtabfinalize): Likewise.

	* libio/iofopncook.c (_IO_cookie_seekoff): Add prototype.

2005-01-17  Roland McGrath  <roland@redhat.com>

	[BZ #745]
	* nscd/Makefile (LDLIBS-nscd): New variable.
	($(objpfx)nscd): Use that instead of selinux-LIBS.

	* Makeconfig (link-extra-libs): Define just as $(LDLIBS-$(@F)).
	(link-extra-libs-static): Define to $(link-extra-libs).
	(link-extra-libs-bounded): Likewise.

2005-01-17  Ulrich Drepper  <drepper@redhat.com>

	* include/link.h: Remove stray definition of pltenter.

2005-01-16  GOTO Masanori  <gotom@debian.or.jp>

	[BZ #734]
	* sysdeps/unix/rewinddir.c: Reset filepos.
	* dirent/tst-seekdir.c: Check telldir value after calling rewinddir.

2005-01-15  Ulrich Drepper  <drepper@redhat.com>

	* elf/tst-auditmod1.c: Reduce duplication.

2005-01-16  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/dl-machine.h: Remove trampoline code.  Define
	ARCH_LA_PLTENTER and ARCH_LA_PLTEXIT.
	(elf_machine_runtime_setup): If profile != 0 does not anymore mean
	GLRO(dl_profile) != NULL.
	* sysdeps/m68k/dl-trampoline.S: New file.
	* sysdeps/m68k/bits/link.h: New file.
	* sysdeps/generic/ldsodefs.h (struct audit_ifaces): Add m68k
	variants.
	* elf/tst-auditmod1.c: Add m68k support.

2005-01-14  Ulrich Drepper  <drepper@redhat.com>

	* posix/regcomp.c [!_LIBC] (init_dfa): Fix determining of relevant
	LC_* variable.  Patch by Aharon Robbins <arnold@skeeve.com>.

	[BZ #731]
	* stdlib/fmtmsg.c (internal_addseverity): Remove incorrect free call.
	* stdlib/tst-fmtmsg.c (main): Add another addseverity test.

2005-01-12  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): We don't have to allow
	callers from libc anymore.

	* elf/dl-open.c (dl_open_worker): Pass __RTLD_AUDIT flag from caller
	to _dl_map_object_deps.
	* elf/dl-load.c (_dl_map_object_from_fd): Don't change memory
	protections when loading auditing modules.

	* dlfcn/dlopen.c (dlopen_doit): Catch invalid mode arguments and fail.

	* posix/getconf.c: Update copyright year.
	* nss/getent.c: Likewise.
	* nscd/nscd_nischeck.c: Likewise.
	* iconv/iconvconfig.c: Likewise.
	* iconv/iconv_prog.c: Likewise.
	* elf/ldconfig.c: Likewise.
	* catgets/gencat.c: Likewise.
	* csu/version.c: Likewise.
	* elf/ldd.bash.in: Likewise.
	* elf/sprof.c (print_version): Likewise.
	* locale/programs/locale.c: Likewise.
	* locale/programs/localedef.c: Likewise.
	* nscd/nscd.c (print_version): Likewise.
	* debug/xtrace.sh: Likewise.
	* malloc/memusage.sh: Likewise.
	* malloc/mtrace.pl: Likewise.
	* debug/catchsegv.sh: Likewise.

2005-01-11  Thorsten Kukuk  <kukuk@suse.de>

	[BZ #733]
	* sunrpc/svc_tcp.c (svctcp_create): Call listen with SOMAXCONN
	as backlog.
	* sunrpc/svc_unix.c (svcunix_create): Likewise.

	[BZ #1099]
	* grp/putgrent.c (putgrent): Don't write 0 as group
	ID if groupname starts with + or -.
	* pwd/putpwent.c (putpwent): Don't write 0 as user or
	group ID if user name starts with + or -.

2005-01-09  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/generic/ldsodefs.h (struct audit_ifaces): Add sh variants.
	* sysdeps/elf/tst-auditmod1.c: Add sh support.
	* sysdeps/sh/bits/link.h: New.
	* sysdeps/sh/dl-machine.h: Remove trampoline code here.  Define
	ARCH_LA_PLTENTER and ARCH_LA_PLTEXIT.  Remove obsolete comments.
	(RTLD_START): Define __fpscr_values.
	* sysdeps/sh/dl-trampoline.S: New file.
	* sysdeps/sh/sh4/dl-trampoline.S: New file.
	* sysdeps/sh/sh4/Versions [ld]: Add __fpscr_values.
	* sysdeps/sh/sh4/dl-machine.h: Remove.

2005-01-10  Jakub Jelinek  <jakub@redhat.com>

	[BZ #732]
	* time/tst-strptime.c (day_tests): Add 2 new tests.
	(test_tm, main): Issue an error instead of segfaulting if
	strptime returns NULL.

2005-01-10  H.J. Lu  <hongjiu.lu@intel.com>

	* sysdeps/alpha/libc-tls.c (__tls_get_addr): Updated for dtv_t union.
	* sysdeps/ia64/libc-tls.c (__tls_get_addr): Likewise.

2005-01-11  Ulrich Drepper  <drepper@redhat.com>

	* malloc/malloc.h: Remove no-glibc support.

2005-01-12  GOTO Masanori  <gotom@debian.or.jp>

	[BZ #650]
	* malloc/malloc.h: Always include features.h.

2005-01-10  Roland McGrath  <roland@redhat.com>

	* sysdeps/ia64/fpu/e_logl.c: File removed.

	* dlfcn/dlfcn.c (init): Fix typo in attribute decl.

2005-01-10  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/dl-tls.c (_dl_next_tls_modid): Fix assertion and
	recognition of last entry.

2005-01-09  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-runtime.c: Include <sys/param.h>.

	* elf/Makefile (headers): Add bits/link.h.

2005-01-09  Andreas Schwab  <schwab@suse.de>

	* elf/rtld.c (dl_main): Create main_map with __RTLD_OPENEXEC.

2005-01-09  Andreas Jaeger  <aj@suse.de>

	[BZ #732]
	* time/strptime_l.c (__strptime_internal): Add braces to avoid
	warning.

	* sysdeps/x86_64/bits/link.h: Use vector_size for GCC 4.0.

	* elf/rtld.c (dl_main): Call _dl_add_to_slotinfo only if USE_TLS.

2005-01-08  Jakub Jelinek  <jakub@redhat.com>

	* elf/Makefile (generated): Add tst-pie1{,.out,.o}.

2005-01-09  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-fini.c (_dl_fini): Call destructors of audit DSOs after
	those of all the regular objects.

	* elf/dl-debug.c (_dl_debug_initialize): Take extra parameter and
	use it to select the r_debug structure for that namespace.
	* elf/dl-close.c (_dl_close): Adjust call to _dl_debug_initialize.
	* elf/dl-load.c (_dl_map_object_from_fd): Likewise.
	* elf/dl-open.c (_dl_open): Likewise.
	* elf/rtld.c (dl_main): Likewise.
	* sysdeps/generic/ldsodefs.h (struct link_namespaces): Add _ns_debug
	member.
	(_dl_debug_initialize): Add new parameter in declaration.

	* elf/dl-close.c (_dl_close): Make sure auditing callbacks are not
	called for the auditing objects themselves.
	* elf/dl-load.c (_dl_map_object_from_fd): Likewise.

2005-01-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/powerpc/powerpc64/dl-machine.h
	(elf_machine_runtime_setup): If profile != 0 does not anymore mean
	GLRO(dl_profile) != NULL.
	* sysdeps/powerpc/powerpc64/bits/link.h (struct la_ppc64_regs): Add
	padding.
	* sysdeps/powerpc/powerpc64/dl-trampoline.S: (_dl_profile_resolve):
	Extend _dl_prof_resolve to add pass extra parameters to
	_dl_profile_fixup and set up structure with register content.

	* sysdeps/powerpc/powerpc32/dl-machine.c (__elf_machine_runtime_setup):
	If profile != 0 does not anymore mean GLRO(dl_profile) != NULL.
	* sysdeps/powerpc/powerpc32/dl-trampoline.S (_dl_prof_resolve):
	Extend _dl_prof_resolve to add pass extra parameters to
	_dl_profile_fixup and set up structure with register content.
	* sysdeps/powerpc/powerpc32/bits/link.h: Fix types of some fields in
	the register and result structures.
	* sysdeps/powerpc/powerpc64/bits/link.h: Fix types of some fields
	in the 32-bit register and result structures.

	* sysdeps/powerpc/powerpc64/dl-trampoline.S: Use register names.

	* sysdeps/powerpc/powerpc32/dl-trampoline.S: New file.
	* sysdeps/powerpc/powerpc32/dl-machine.h: Remove trampoline code here.
	Define ARCH_LA_PLTENTER and ARCH_LA_PLTEXIT.
	* sysdeps/generic/ldsodefs.h (struct audit_ifaces): Add ppc32 variants.
	* elf/tst-auditmod1.c: Add ppc32 support.
	* sysdeps/powerpc/powerpc32/bits/link.h: New file.
	* sysdeps/powerpc/powerpc64/bits/link.h: Add ppc32 definitions.

	* malloc/malloc.c (malloc_printerr): Print program name as part of
	error message.

	* misc/sys/cdefs.h (__attribute_warn_unused_result__): Define.
	* stdlib/stdlib.h: Make realloc with
	__attribute_warn_unused_result__ instead of __wur.
	* malloc/malloc.h: Add __wur and __attribute_warn_unused_result__
	markers as in <stdlib.h>.

	* libio/stdio.h: Remove __wur from rename and remove.
	* posix/unistd.h: Remove __wur from dup2.

2005-01-03  Andreas Jaeger  <aj@suse.de>

	* elf/Makefile (tests): Revert patch from 2005-01-03.

2005-01-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/init-first.c (__libc_init_first): Don't
	make __libc_init_first hidden.

	* elf/rtld.c [!DONT_USE_BOOTSTRAP_MAP] (_dl_start_final): Initialize
	l_relocated of rtld map.
	* sysdeps/powerpc/powerpc64/dl-trampoline.S: New file.
	* sysdeps/powerpc/powerpc64/dl-machine.h: Remove trampoline code here.
	Define ARCH_LA_PLTENTER and ARCH_LA_PLTEXIT.
	* sysdeps/generic/ldsodefs.h (struct audit_ifaces): Add ppc64 variants.
	* elf/tst-auditmod1.c: Add ppc64 support.
	* sysdeps/powerpc/powerpc64/bits/link.h: New file.

2005-01-06  Roland McGrath  <roland@redhat.com>

	[BZ #633]
	* sysdeps/unix/sysv/linux/futimes.c (__futimes): Catch errno values
	indicating file-name lookup errors, and return ENOSYS or EBADF instead.

2005-01-06  Ulrich Drepper  <drepper@redhat.com>

	* csu/elf-init.c (__libc_csu_fini): Don't do anything here.
	* sysdeps/generic/libc-start.c: Don't register program destructor here.

	* dlfcn/Makefile: Add rules to build dlfcn.c.
	(LDFLAGS-dl.so): Removed.
	* dlfcn/dlclose.c: _dl_close is now in ld.so, use function pointer
	table.
	* dlfcn/dlmopen.c: Likewise for _dl_open.
	* dlfcn/dlopen.c: Likewise.
	* dlfcn/dlopenold.c: Likewise.
	* elf/dl-libc.c: Likewise for _dl_open and _dl_close.
	* elf/Makefile (routines): Remove dl-open and dl-close.
	(dl-routines): Add dl-open, dl-close, and dl-trampoline.
	Add rules to build and run tst-audit1.
	* elf/tst-audit1.c: New file.
	* elf/tst-auditmod1.c: New file.
	* elf/Versions [libc]: Remove _dl_open and _dl_close.
	* elf/dl-close.c: Change for use inside ld.so instead of libc.so.
	* elf/dl-open.c: Likewise.
	* elf/dl-debug.c (_dl_debug_initialize): Allow reinitialization,
	signaled by nonzero parameter.
	* elf/dl-init.c: Fix use of r_state.
	* elf/dl-load.c: Likewise.

	* elf/dl-close.c: Add auditing checkpoints.
	* elf/dl-open.c: Likewise.
	* elf/dl-fini.c: Likewise.
	* elf/dl-load.c: Likewise.
	* elf/dl-sym.c: Likewise.
	* sysdeps/generic/libc-start.c: Likewise.
	* elf/dl-object.c: Allocate memory for auditing information.
	* elf/dl-reloc.c: Remove RESOLV.  We now always need the map.
	Correctly initialize slotinfo.
	* elf/dynamic-link.h: Adjust after removal of RESOLV.
	* sysdeps/hppa/dl-lookupcfg.h: Likewise.
	* sysdeps/ia64/dl-lookupcfg.h: Likewise.
	* sysdeps/powerpc/powerpc64/dl-lookupcfg.h: Removed.
	* elf/dl-runtime.c (_dl_fixup): Little cleanup.
	(_dl_profile_fixup): New parameters to point to register struct and
	variable for frame size.
	Add auditing checkpoints.
	(_dl_call_pltexit): New function.
	Don't define trampoline code here.
	* elf/rtld.c: Recognize LD_AUDIT.  Load modules on startup.
	Remove all the functions from _rtld_global_ro which only _dl_open
	and _dl_close needed.
	Add auditing checkpoints.
	* elf/link.h: Define symbols for auditing interfaces.
	* include/link.h: Likewise.
	* include/dlfcn.h: Define __RTLD_AUDIT.
	Remove prototypes for _dl_open and _dl_close.
	Adjust access to argc and argv in libdl.
	* dlfcn/dlfcn.c: New file.
	* sysdeps/generic/dl-lookupcfg.h: Remove all content now that RESOLVE
	is gone.
	* sysdeps/generic/ldsodefs.h: Add definitions for auditing interfaces.
	* sysdeps/generic/unsecvars.h: Add LD_AUDIT.
	* sysdeps/i386/dl-machine.h: Remove trampoline code here.
	Adjust for removal of RESOLVE.
	* sysdeps/x86_64/dl-machine.h: Likewise.
	* sysdeps/generic/dl-trampoline.c: New file.
	* sysdeps/i386/dl-trampoline.c: New file.
	* sysdeps/x86_64/dl-trampoline.c: New file.

	* sysdeps/generic/dl-tls.c: Cleanups.  Fixup for dtv_t change.
	Fix updating of DTV.
	* sysdeps/generic/libc-tls.c: Likewise.

	* sysdeps/arm/bits/link.h: Renamed to ...
	* sysdeps/arm/bits/linkmap.h: ...this.
	* sysdeps/generic/bits/link.h: Renamed to...
	* sysdeps/generic/bits/linkmap.h: ...this.
	* sysdeps/hppa/bits/link.h: Renamed to...
	* sysdeps/hppa/bits/linkmap.h: ...this.
	* sysdeps/i386/bits/link.h: Renamed to...
	* sysdeps/i386/bits/linkmap.h: ...this.
	* sysdeps/ia64/bits/link.h: Renamed to...
	* sysdeps/ia64/bits/linkmap.h: ...this.
	* sysdeps/s390/bits/link.h: Renamed to...
	* sysdeps/s390/bits/linkmap.h: ...this.
	* sysdeps/sh/bits/link.h: Renamed to...
	* sysdeps/sh/bits/linkmap.h: ...this.
	* sysdeps/x86_64/bits/link.h: Renamed to...
	* sysdeps/x86_64/bits/linkmap.h: ...this.

	* posix/unistd.h: Declare ftruncate for POSIX 2003.  [BZ #640]

2004-12-22  Steven Munroe  <sjmunroe@us.ibm.com>

	[BZ #602]
	* math/libm-test.inc (rint_test_tonearest): New test.
	(rint_test_towardzero): New test.
	(rint_test_downward): New test.
	(rint_test_upward): New test.
	* sysdeps/powerpc/powerpc32/fpu/s_ceil.S: Fix -0.0 case.
	Remove redundant const values.
	* sysdeps/powerpc/powerpc32/fpu/s_ceilf.S: Fix -0.0 case.
	Remove redundant const values.  Use float const.
	* sysdeps/powerpc/powerpc32/fpu/s_floor.S: Fix -0.0 case.
	* sysdeps/powerpc/powerpc32/fpu/s_floorf.S: Fix -0.0 case.
	Use float const.
	* sysdeps/powerpc/powerpc32/fpu/s_rint.S: Fix -0.0 case.
	* sysdeps/powerpc/powerpc32/fpu/s_rintf.S: Fix -0.0 case.
	Use float const.
	* sysdeps/powerpc/powerpc32/fpu/s_round.S: Fix -0.0 case.
	Remove redundant const values.
	* sysdeps/powerpc/powerpc32/fpu/s_roundf.S: Fix -0.0 case.
	Remove redundant const values.  Use float const.
	* sysdeps/powerpc/powerpc32/fpu/s_trunc.S: Fix -0.0 case.
	Remove redundant const values.
	* sysdeps/powerpc/powerpc32/fpu/s_truncf.S: Fix -0.0 case.
	Remove redundant const values.  Use float const.
	* sysdeps/powerpc/powerpc64/fpu/s_ceil.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Remove redundant const values.
	* sysdeps/powerpc/powerpc64/fpu/s_ceilf.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Remove redundant const values.
	Use float const.
	* sysdeps/powerpc/powerpc64/fpu/s_floor.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.
	* sysdeps/powerpc/powerpc64/fpu/s_floorf.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Use float const.
	* sysdeps/powerpc/powerpc64/fpu/s_rint.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.
	* sysdeps/powerpc/powerpc64/fpu/s_rintf.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Use float const.
	* sysdeps/powerpc/powerpc64/fpu/s_round.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Remove redundant const values.
	* sysdeps/powerpc/powerpc64/fpu/s_roundf.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Remove redundant const values.
	Use float const.
	* sysdeps/powerpc/powerpc64/fpu/s_trunc.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.
	* sysdeps/powerpc/powerpc64/fpu/s_truncf.S: Use EALIGN for Quadword
	alignment.  Fix -0.0 case.  Remove redundant const values.
	Use float const.

2005-01-06  Ulrich Drepper  <drepper@redhat.com>

	* misc/sys/cdefs.h: Define __wur.
	* libio/stdio.h: Use __wur for a number of interfaces.
	* posix/unistd.h: Likewise.
	* stdlib/stdlib.h: Likewise.

2004-12-29  Jakub Jelinek  <jakub@redhat.com>

	[BZ #592]
	* sysdeps/ia64/fpu/libm_support.h (__libm_error_support): Use
	libc_hidden_proto instead of HIDDEN_PROTO.
	* sysdeps/ia64/fpu/libm-symbols.h (HIDDEN_PROTO): Remove.
	(__libm_error_support): If ASSEMBLER and in libc, define to
	HIDDEN_JUMPTARGET(__libm_error_support).

2004-12-28  David Mosberger  <davidm@hpl.hp.com>

	[BZ #592]
	* sysdeps/ia64/fpu/Makefile (duplicated-routines): New macro.
	(sysdep_routines): Replace libm_ldexp{,f,l} and libm_scalbn{,f,l}
	with $(duplicated-routines).
	(libm-sysdep_routines): Likewise, but substitute "s_" prefix for
	"m_" prefix.

2004-12-27  David Mosberger  <davidm@hpl.hp.com>

	[BZ #592]
	* sysdeps/ia64/fpu/libm-symbols.h: Add include of <sysdep.h> and
	undefine "ret" macro.  Add __libm_error_support hidden definitions.

	[BZ #592]
	* sysdeps/ia64/fpu/e_lgamma_r.c: Remove CVS-id comment.  Add
	missing portion of copyright statement.
	* sysdeps/ia64/fpu/e_lgammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/e_lgammal_r.c: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/w_lgamma.c: Remove CVS-id comment.  Add
	missing portion of copyright statement.
	(__ieee754_lgamma): Rename from lgamma().  Make lgamma() a weak alias.
	(__ieee754_gamma): Likewise.
	* sysdeps/ia64/fpu/w_lgammaf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal.c: Likewise.

2004-12-09  H.J. Lu <hjl@lucon.org>

	[BZ #592]
	* sysdeps/ia64/fpu/s_nextafterl.c: Remove.
	* sysdeps/ia64/fpu/s_nexttoward.c: Likewise.
	* sysdeps/ia64/fpu/s_nexttowardf.c: Likewise.
	* sysdeps/ia64/fpu/e_atan2l.S: Remove (duplicate of e_atan2l.c).
	* sysdeps/ia64/fpu/e_expl.S: Likewise.
	* sysdeps/ia64/fpu/e_logl.c: Remove (conflicts with e_logl.S).

2004-11-18  David Mosberger  <davidm@hpl.hp.com>

	[BZ #592]
	* sysdeps/ia64/fpu/README: New file.
	* sysdeps/ia64/fpu/gen_import_file_list: New file.
	* sysdeps/ia64/fpu/import_check: Likewise.
	* sysdeps/ia64/fpu/import_diffs: Likewise.
	* sysdeps/ia64/fpu/import_file.awk: Likewise.
	* sysdeps/ia64/fpu/import_intel_libm: Likewise.
	* sysdeps/ia64/fpu/libm-symbols.h: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/e_acos.S: Update from Intel libm v2.1+.
	* sysdeps/ia64/fpu/e_acosf.S: Likewise.
	* sysdeps/ia64/fpu/e_acosl.S: Likewise.
	* sysdeps/ia64/fpu/e_asin.S: Likewise.
	* sysdeps/ia64/fpu/e_asinf.S: Likewise.
	* sysdeps/ia64/fpu/e_asinl.S: Likewise.
	* sysdeps/ia64/fpu/e_atan2.S: Likewise.
	* sysdeps/ia64/fpu/e_atan2f.S: Likewise.
	* sysdeps/ia64/fpu/e_cosh.S: Likewise.
	* sysdeps/ia64/fpu/e_coshf.S: Likewise.
	* sysdeps/ia64/fpu/e_coshl.S: Likewise.
	* sysdeps/ia64/fpu/e_exp.S: Likewise.
	* sysdeps/ia64/fpu/e_expf.S: Likewise.
	* sysdeps/ia64/fpu/e_fmod.S: Likewise.
	* sysdeps/ia64/fpu/e_fmodf.S: Likewise.
	* sysdeps/ia64/fpu/e_fmodl.S: Likewise.
	* sysdeps/ia64/fpu/e_hypot.S: Likewise.
	* sysdeps/ia64/fpu/e_hypotf.S: Likewise.
	* sysdeps/ia64/fpu/e_hypotl.S: Likewise.
	* sysdeps/ia64/fpu/e_log.S: Likewise.
	* sysdeps/ia64/fpu/e_log2.S: Likewise.
	* sysdeps/ia64/fpu/e_log2f.S: Likewise.
	* sysdeps/ia64/fpu/e_log2l.S: Likewise.
	* sysdeps/ia64/fpu/e_logf.S: Likewise.
	* sysdeps/ia64/fpu/e_pow.S: Likewise.
	* sysdeps/ia64/fpu/e_powf.S: Likewise.
	* sysdeps/ia64/fpu/e_powl.S: Likewise.
	* sysdeps/ia64/fpu/e_remainder.S: Likewise.
	* sysdeps/ia64/fpu/e_remainderf.S: Likewise.
	* sysdeps/ia64/fpu/e_remainderl.S: Likewise.
	* sysdeps/ia64/fpu/e_scalb.S: Likewise.
	* sysdeps/ia64/fpu/e_scalbf.S: Likewise.
	* sysdeps/ia64/fpu/e_scalbl.S: Likewise.
	* sysdeps/ia64/fpu/e_sinh.S: Likewise.
	* sysdeps/ia64/fpu/e_sinhf.S: Likewise.
	* sysdeps/ia64/fpu/e_sinhl.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrt.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrtf.S: Likewise.
	* sysdeps/ia64/fpu/e_sqrtl.S: Likewise.
	* sysdeps/ia64/fpu/libm_error.c: Likewise.
	* sysdeps/ia64/fpu/libm_reduce.c: Likewise.
	* sysdeps/ia64/fpu/libm_support.h: Likewise.
	* sysdeps/ia64/fpu/s_atan.S: Likewise.
	* sysdeps/ia64/fpu/s_atanf.S: Likewise.
	* sysdeps/ia64/fpu/s_atanl.S: Likewise.
	* sysdeps/ia64/fpu/s_cbrt.S: Likewise.
	* sysdeps/ia64/fpu/s_cbrtf.S: Likewise.
	* sysdeps/ia64/fpu/s_cbrtl.S: Likewise.
	* sysdeps/ia64/fpu/s_ceil.S: Likewise.
	* sysdeps/ia64/fpu/s_ceilf.S: Likewise.
	* sysdeps/ia64/fpu/s_ceill.S: Likewise.
	* sysdeps/ia64/fpu/s_cos.S: Likewise.
	* sysdeps/ia64/fpu/s_cosf.S: Likewise.
	* sysdeps/ia64/fpu/s_cosl.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1f.S: Likewise.
	* sysdeps/ia64/fpu/s_expm1l.S: Likewise.
	* sysdeps/ia64/fpu/s_fabs.S: Likewise.
	* sysdeps/ia64/fpu/s_fabsf.S: Likewise.
	* sysdeps/ia64/fpu/s_fabsl.S: Likewise.
	* sysdeps/ia64/fpu/s_floor.S: Likewise.
	* sysdeps/ia64/fpu/s_floorf.S: Likewise.
	* sysdeps/ia64/fpu/s_floorl.S: Likewise.
	* sysdeps/ia64/fpu/s_frexp.c: Likewise.
	* sysdeps/ia64/fpu/s_frexpf.c: Likewise.
	* sysdeps/ia64/fpu/s_frexpl.c: Likewise.
	* sysdeps/ia64/fpu/s_ilogb.S: Likewise.
	* sysdeps/ia64/fpu/s_ilogbf.S: Likewise.
	* sysdeps/ia64/fpu/s_ilogbl.S: Likewise.
	* sysdeps/ia64/fpu/s_log1p.S: Likewise.
	* sysdeps/ia64/fpu/s_log1pf.S: Likewise.
	* sysdeps/ia64/fpu/s_log1pl.S: Likewise.
	* sysdeps/ia64/fpu/s_logb.S: Likewise.
	* sysdeps/ia64/fpu/s_logbf.S: Likewise.
	* sysdeps/ia64/fpu/s_logbl.S: Likewise.
	* sysdeps/ia64/fpu/s_modf.S: Likewise.
	* sysdeps/ia64/fpu/s_modff.S: Likewise.
	* sysdeps/ia64/fpu/s_modfl.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyint.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyintf.S: Likewise.
	* sysdeps/ia64/fpu/s_nearbyintl.S: Likewise.
	* sysdeps/ia64/fpu/s_rint.S: Likewise.
	* sysdeps/ia64/fpu/s_rintf.S: Likewise.
	* sysdeps/ia64/fpu/s_rintl.S: Likewise.
	* sysdeps/ia64/fpu/s_round.S: Likewise.
	* sysdeps/ia64/fpu/s_roundf.S: Likewise.
	* sysdeps/ia64/fpu/s_roundl.S: Likewise.
	* sysdeps/ia64/fpu/s_significand.S: Likewise.
	* sysdeps/ia64/fpu/s_significandf.S: Likewise.
	* sysdeps/ia64/fpu/s_significandl.S: Likewise.
	* sysdeps/ia64/fpu/s_tan.S: Likewise.
	* sysdeps/ia64/fpu/s_tanf.S: Likewise.
	* sysdeps/ia64/fpu/s_tanl.S: Likewise.
	* sysdeps/ia64/fpu/s_trunc.S: Likewise.
	* sysdeps/ia64/fpu/s_truncf.S: Likewise.
	* sysdeps/ia64/fpu/s_truncl.S: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/e_acosh.S: New file from Intel libm v2.1+.
	* sysdeps/ia64/fpu/e_acoshf.S: Likewise.
	* sysdeps/ia64/fpu/e_acoshl.S: Likewise.
	* sysdeps/ia64/fpu/e_atanh.S: Likewise.
	* sysdeps/ia64/fpu/e_atanhf.S: Likewise.
	* sysdeps/ia64/fpu/e_atanhl.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10f.S: Likewise.
	* sysdeps/ia64/fpu/e_exp10l.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2f.S: Likewise.
	* sysdeps/ia64/fpu/e_exp2l.S: Likewise.
	* sysdeps/ia64/fpu/e_lgamma_r.S: Likewise.
	* sysdeps/ia64/fpu/e_lgammaf_r.S: Likewise.
	* sysdeps/ia64/fpu/e_lgammal_r.S: Likewise.
	* sysdeps/ia64/fpu/e_logl.S: Likewise.
	* sysdeps/ia64/fpu/libm_frexp.S: Likewise.
	* sysdeps/ia64/fpu/libm_frexpf.S: Likewise.
	* sysdeps/ia64/fpu/libm_frexpl.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexp.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexpf.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_ldexpl.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbn.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbnf.S: Likewise.
	* sysdeps/ia64/fpu/s_libm_scalbnl.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgamma.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgammaf.S: Likewise.
	* sysdeps/ia64/fpu/libm_lgammal.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincos.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincos_large.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincosf.S: Likewise.
	* sysdeps/ia64/fpu/libm_sincosl.S: Likewise.
	* sysdeps/ia64/fpu/libm_scalblnf.S: Likewise.
	* sysdeps/ia64/fpu/s_asinh.S: Likewise.
	* sysdeps/ia64/fpu/s_asinhf.S: Likewise.
	* sysdeps/ia64/fpu/s_asinhl.S: Likewise.
	* sysdeps/ia64/fpu/s_erf.S: Likewise.
	* sysdeps/ia64/fpu/s_erfc.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcf.S: Likewise.
	* sysdeps/ia64/fpu/s_erfcl.S: Likewise.
	* sysdeps/ia64/fpu/s_erff.S: Likewise.
	* sysdeps/ia64/fpu/s_erfl.S: Likewise.
	* sysdeps/ia64/fpu/s_fdim.S: Likewise.
	* sysdeps/ia64/fpu/s_fdimf.S: Likewise.
	* sysdeps/ia64/fpu/s_fdiml.S: Likewise.
	* sysdeps/ia64/fpu/s_fma.S: Likewise.
	* sysdeps/ia64/fpu/s_fmaf.S: Likewise.
	* sysdeps/ia64/fpu/s_fmal.S: Likewise.
	* sysdeps/ia64/fpu/s_fmax.S: Likewise.
	* sysdeps/ia64/fpu/s_fmaxf.S: Likewise.
	* sysdeps/ia64/fpu/s_fmaxl.S: Likewise.
	* sysdeps/ia64/fpu/s_ldexp.c: Likewise.
	* sysdeps/ia64/fpu/s_ldexpf.c: Likewise.
	* sysdeps/ia64/fpu/s_ldexpl.c: Likewise.
	* sysdeps/ia64/fpu/s_nextafter.S: Likewise.
	* sysdeps/ia64/fpu/s_nextafterf.S: Likewise.
	* sysdeps/ia64/fpu/s_nextafterl.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttoward.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttowardf.S: Likewise.
	* sysdeps/ia64/fpu/s_nexttowardl.S: Likewise.
	* sysdeps/ia64/fpu/s_tanh.S: Likewise.
	* sysdeps/ia64/fpu/s_tanhf.S: Likewise.
	* sysdeps/ia64/fpu/s_tanhl.S: Likewise.
	* sysdeps/ia64/fpu/s_scalblnf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgamma.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammaf.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal.c: Likewise.
	* sysdeps/ia64/fpu/w_tgamma.S: Likewise.
	* sysdeps/ia64/fpu/w_tgammaf.S: Likewise.
	* sysdeps/ia64/fpu/w_tgammal.S: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/e_gamma_r.c: New empty dummy-file.
	* sysdeps/ia64/fpu/e_gammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/e_gammal_r.c: Likewise.
	* sysdeps/ia64/fpu/w_acosh.c: Likewise.
	* sysdeps/ia64/fpu/w_acoshf.c: Likewise.
	* sysdeps/ia64/fpu/w_acoshl.c: Likewise.
	* sysdeps/ia64/fpu/w_atanh.c: Likewise.
	* sysdeps/ia64/fpu/w_atanhf.c: Likewise.
	* sysdeps/ia64/fpu/w_atanhl.c: Likewise.
	* sysdeps/ia64/fpu/w_exp10.c: Likewise.
	* sysdeps/ia64/fpu/w_exp10f.c: Likewise.
	* sysdeps/ia64/fpu/w_exp10l.c: Likewise.
	* sysdeps/ia64/fpu/w_exp2.c: Likewise.
	* sysdeps/ia64/fpu/w_exp2f.c: Likewise.
	* sysdeps/ia64/fpu/w_exp2l.c: Likewise.
	* sysdeps/ia64/fpu/w_expl.c: Likewise.
	* sysdeps/ia64/fpu/e_expl.S: Likewise.
	* sysdeps/ia64/fpu/w_lgamma_r.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammaf_r.c: Likewise.
	* sysdeps/ia64/fpu/w_lgammal_r.c: Likewise.
	* sysdeps/ia64/fpu/w_log2.c: Likewise.
	* sysdeps/ia64/fpu/w_log2f.c: Likewise.
	* sysdeps/ia64/fpu/w_log2l.c: Likewise.
	* sysdeps/ia64/fpu/w_sinh.c: Likewise.
	* sysdeps/ia64/fpu/w_sinhf.c: Likewise.
	* sysdeps/ia64/fpu/w_sinhl.c: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/libm_atan2_reg.S: Remove.
	* sysdeps/ia64/fpu/s_ldexp.S: Likewise.
	* sysdeps/ia64/fpu/s_ldexpf.S: Likewise.
	* sysdeps/ia64/fpu/s_ldexpl.S: Likewise.
	* sysdeps/ia64/fpu/s_scalbn.S: Likewise.
	* sysdeps/ia64/fpu/s_scalbnf.S: Likewise.
	* sysdeps/ia64/fpu/s_scalbnl.S: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/s_sincos.c: Make it an empty dummy-file.
	* sysdeps/ia64/fpu/s_sincosf.c: Likewise.
	* sysdeps/ia64/fpu/s_sincosl.c: Likewise.

	[BZ #592]
	* sysdeps/ia64/fpu/e_atan2l.S: Add "Not needed" comment.

	[BZ #592]
	* sysdeps/ia64/fpu/s_copysign.S: Add __libm_copysign{,f,l}
	alias for use by libm_error.c

	[BZ #592]
	* sysdeps/ia64/fpu/Makefile (libm-sysdep_routines): Remove
	libm_atan2_reg, libm_tan, libm_frexp4{f,l}.
	Mention s_erfc{,f,l}, libm_frexp{,f,l}, libm_ldexp{,f,l},
	libm_sincos{,f,l}, libm_sincos_large, libm_lgamma{,f,l},
	libm_scalbn{,f,l}, libm_scalblnf.
	(sysdep_routines): Remove libm_frexp4{,f,l}.
	Mention libm_frexp{,f,l}, libm_ldexp{,f,l}, and libm_scalbn{,f,l}.
	(sysdep-CPPFLAGS): Add -include libm-symbols.h, -D__POSIX__,
	_D_LIB_VERSIONIMF=_LIB_VERSION, -DSIZE_LONG_INT_64, and
	-DSIZE_LONG_LONG_INT_64.

2005-01-05  Steven Munroe  <sjmunroe@us.ibm.com>

	[BZ #729]
	* elf/rtld.c (dl_main) [NEED_DL_SYSINFO_DSO]: Insure l_map_end and
	l_text_end are set for a VDSO with a single PT_LOAD entry.

2005-01-05  Ulrich Drepper  <drepper@redhat.com>

	[BZ #730]
	* libio/iofopncook.c (_IO_cookie_seekoff): Define.  Mark offset as
	invalid to disable optimizations in fileops which won't work here.
	(_IO_cookie_jumps): Use it.
	(_IO_old_cookie_jumps): Likewise.
	* libio/fmemopen.c (fmemopen_seek): Result must be returned in *P,
	not the return value.
	* stdio-common/Makefile (tests): Add tst-fmemopen2.
	* stdio-common/tst-fmemopen2.c: New file.

	* sysdeps/unix/sysv/linux/bits/waitflags.h: Define __WNOTHREAD.

2005-01-05  Roland McGrath  <roland@redhat.com>

	* configure.in (libc_cv_cpp_asm_debuginfo): Checked moved ...
	* sysdeps/i386/configure.in: ... here.  New file.

2005-01-03  Ulrich Drepper  <drepper@redhat.com>

	[BZ #727]
	* sysdeps/generic/libc-start.c [SHARED] (__libc_start_main): Don't
	initialize __environ again.
	* stdlib/Makefile: Add rules to build and run tst-putenv.
	* stdlib/tst-putenv.c: New file.
	* stdlib/tst-putenvmod.c: New file.

	* sysdeps/unix/sysv/linux/init-first.c: Clean file up.  Don't
	define unnecessary wrappers or aliases of static functions.

2005-01-03  Andreas Jaeger  <aj@suse.de>

	* csu/Makefile (generated): Add start.os and start.ob.

	* elf/Makefile (tests): Change rule for tst-pie1 so that make
	clean works.

2004-12-29  Roland McGrath  <roland@redhat.com>

	[BZ #626]
	* sysdeps/unix/alarm.c (alarm): Round return value to nearest rather
	than always up; when nearest is zero, round up to one.

2004-12-28  Ulrich Drepper  <drepper@redhat.com>

	* po/es.po: Update from translation team.

	[BZ #726]
	* sysdeps/generic/dl-tls.c (__tls_get_addr): Fix typo.

2004-12-27  Ulrich Drepper  <drepper@redhat.com>

	[BZ #744]
	* include/signal.h: Define __sigemptyset.

2004-04-27  Paolo Bonzini  <bonzini@gnu.org>

	* posix/regex_internal.h (struct re_dfastate_t): Make
	word_trtable a pointer to the 512-item transition table.
	* posix/regexec.c (build_trtable): Fill in either state->trtable
	or state->word_trtable.  Return a boolean indicating success.
	(transit_state): Expect state->trtable to be a 256-item
	transition table.  Reorganize code to have less tests in
	the common case, and to save an indentation level.
	* posix/regex_internal.c (free_state): Free word_trtable.

2004-12-21  Jakub Jelinek  <jakub@redhat.com>

	[BZ #723]
	* sysdeps/unix/sysv/linux/i386/clone.S (__clone): Make sure %esp when
	calling fn is 16 byte aligned.
	* sysdeps/i386/tst-stack-align.h: New file.

	[BZ #725]
	* misc/efgcvt_r.c (FLOAT_MIN_10_EXP, FLOAT_MIN_10_NORM): Define.
	(ecvt_r): Special case denormals.
	* misc/qefgcvt_r.c (FLOAT_MIN_10_EXP, FLOAT_MIN_10_NORM): Define.
	* misc/tst-efgcvt.c: Include float.h.
	(ecvt_tests): Add 2 new tests.

2004-12-20  Roland McGrath  <roland@frob.com>

	* version.h (RELEASE, VERSION): development, 2.3.90
	* include/features.h (__GLIBC_MINOR__): Now 4.


See ChangeLog.15 for earlier changes.
